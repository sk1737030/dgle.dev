"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[7849],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return d}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var o=r.createContext({}),c=function(e){var t=r.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=c(e.components);return r.createElement(o.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,o=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),m=c(n),d=a,k=m["".concat(o,".").concat(d)]||m[d]||u[d]||i;return n?r.createElement(k,l(l({ref:t},p),{},{components:n})):r.createElement(k,l({ref:t},p))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,l=new Array(i);l[0]=m;var s={};for(var o in t)hasOwnProperty.call(t,o)&&(s[o]=t[o]);s.originalType=e,s.mdxType="string"==typeof e?e:a,l[1]=s;for(var c=2;c<i;c++)l[c]=n[c];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},6857:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return o},default:function(){return d},frontMatter:function(){return s},metadata:function(){return c},toc:function(){return u}});var r=n(7462),a=n(3366),i=(n(7294),n(3905)),l=["components"],s={title:"\ub808\ub514\uc2a4 Atomic Operation\uc704\ud574 multi \uc640 luascript\uc758 \ucc28\uc774",description:"What is difference Between Redis luascript and multi exec",slug:"redis-multi-lua",authors:"dongle",tags:["Redis","Luascript","transaction"],image:"https://i.imgur.com/mErPwqL.png",hide_table_of_contents:!1},o=void 0,c={permalink:"/redis-multi-lua",editUrl:"https://github.com/facebook/docusaurus/edit/main/website/blog/2022-07-18-redis-luascript-or-multiexec.md",source:"@site/blog/2022-07-18-redis-luascript-or-multiexec.md",title:"\ub808\ub514\uc2a4 Atomic Operation\uc704\ud574 multi \uc640 luascript\uc758 \ucc28\uc774",description:"What is difference Between Redis luascript and multi exec",date:"2022-07-18T00:00:00.000Z",formattedDate:"July 18, 2022",tags:[{label:"Redis",permalink:"/tags/redis"},{label:"Luascript",permalink:"/tags/luascript"},{label:"transaction",permalink:"/tags/transaction"}],readingTime:5.295,truncated:!0,authors:[{name:"Dongle",title:"Junior Backend Developer",url:"https://github.com/sk1737030",imageURL:"https://github.com/sk1737030.png",key:"dongle"}],frontMatter:{title:"\ub808\ub514\uc2a4 Atomic Operation\uc704\ud574 multi \uc640 luascript\uc758 \ucc28\uc774",description:"What is difference Between Redis luascript and multi exec",slug:"redis-multi-lua",authors:"dongle",tags:["Redis","Luascript","transaction"],image:"https://i.imgur.com/mErPwqL.png",hide_table_of_contents:!1},prevItem:{title:"Concurrent Hash Map\uc744 \uac04\ub2e8\ud558\uac8c \ub9cc\ub4e4\uc5b4\ubcf4\uc790. - 1\ud3b8",permalink:"/ConcurrentHashMap"},nextItem:{title:"\ub9cc\ub4e4\uba74\uc11c \ubc30\uc6b0\ub294 \ud074\ub9b0 \uc544\ud0a4\ud14d\ucc98 \uc815\ub9ac - 2",permalink:"/clean-arch-2"}},p={authorsImageUrls:[void 0]},u=[{value:"Multi\uc640  exec\ub97c \uc0ac\uc6a9\ud558\uba74",id:"multi\uc640--exec\ub97c-\uc0ac\uc6a9\ud558\uba74",level:2},{value:"watch\uc640 \uac19\uc774 \uc0ac\uc6a9\ud558\uba74",id:"watch\uc640-\uac19\uc774-\uc0ac\uc6a9\ud558\uba74",level:3},{value:"Luascript\ub780",id:"luascript\ub780",level:2},{value:"\ucc28\uc774\uc810",id:"\ucc28\uc774\uc810",level:2},{value:"\ubb58 \uc0ac\uc6a9\ud574\uc57c\ud560\uae4c",id:"\ubb58-\uc0ac\uc6a9\ud574\uc57c\ud560\uae4c",level:2}],m={toc:u};function d(e){var t=e.components,n=(0,a.Z)(e,l);return(0,i.kt)("wrapper",(0,r.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Redis\uc5d0\uc11c Atomic Operation\uc744 \uc704\ud574 Luascirpt\uc640 Multi Exec \uc911 \ubb58 \uc368\uc57c\ud560\uae4c?"),(0,i.kt)("h1",{id:"redis\uc5d0\uc11c-atomic-operation\uc744-\uc704\ud574-luascirpt\uc640-multi-exec-\uc911-\ubb58-\uc368\uc57c\ud560\uae4c"},"Redis\uc5d0\uc11c Atomic Operation\uc744 \uc704\ud574 Luascirpt\uc640 Multi Exec \uc911 \ubb58 \uc368\uc57c\ud560\uae4c?"),(0,i.kt)("h2",{id:"multi\uc640--exec\ub97c-\uc0ac\uc6a9\ud558\uba74"},"Multi\uc640  exec\ub97c \uc0ac\uc6a9\ud558\uba74"),(0,i.kt)("p",null,"Multi\uc640 exec\ub294 \ub808\ub514\uc2a4\uc5d0\uc11c \ud2b8\ub79c\uc7ad\uc158\uc744 \uc0ac\uc6a9\ud558\uaca0\ub2e4\ub294 \uba85\ub839\uc5b4\uc778\ub370 \uc77c\ubc18\uc801\uc778 RDB\uc640 \ub2e4\ub974\uac8c \ub864\ubc31\uae30\ub2a5\uc774\uc5c6\ub2e4. (\ub864\ubc31\uae30\ub2a5\uc774 \uc5c6\ub294 \uc774\uc720\ub294 \ub2e8\uc21c\uc131\uacfc \uc131\ub2a5\uc5d0 \uc0c1\ub2f9\ud55c \uc601\ud5a5\uc744 \ubbf8\uce58\uae30 \ub54c\ubb38\uc5d0 RDB\uc640 \ub2e4\ub974\uac8c \uc5c6\ub2e4\uace0\ud55c\ub2e4.)",(0,i.kt)("br",{parentName:"p"}),"\n","\uadf8\ub7ec\uba74 \ub808\ub514\uc2a4\ub294 \uc5b4\ub5bb\uac8c \ud2b8\ub79c\uc7ad\uc158\uc744 \ubc14\ub77c\ubcfc\uae4c? Multi\ub85c \uc120\uc5b8\ud558\uba74 multi\uc548\uc5d0 \uba85\ub839\uc5b4\ub4e4\uc774 \ubb36\uc5ec \uc21c\uc11c\ub300\ub85c \uac19\uc774 \ud050\uc5d0 \ub2f4\uae30\uac8c\ub41c\ub2e4. \uadf8\ub9ac\uace0 EXEC\ub97c \ub9cc\ub098\ub294 \uc21c\uac04 \ud050\uc5d0 \ub2f4\uae34 \uba85\ub839\uc5b4\ub4e4\uc774 \uc21c\uc11c\ub300\ub85c \ud55c \uc624\ud37c\ub808\uc774\uc158\uc5d0 \ubb36\uc5ec \uc2e4\ud589\uc774\ub418\uace0",(0,i.kt)("br",{parentName:"p"}),"\n","\ub9cc\uc57d \ud050\uc5d0 \uc313\uc778 \uba85\ub839\uc5b4\uac00 \uc911\uac04\uc5d0 \uc2e4\ud328\ud558\ub294 \uc77c\uc774 \uc0dd\uae30\uba74 \uc2e4\ud328\ud55c \ubd80\ubd84\ub9cc skip\ud558\uace0 \ub2e4\uc74c\ubd80\ubd84\uc774 \uc5f0\uc18d\uc801\uc73c\ub85c \uc2e4\ud589\ub418\uac8c\ub41c\ub2e4. "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"> MULTI\nOK\n> INCR foo\nQUEUED\n> INCR bar\nQUEUED\n> EXEC\n1) (integer) 1\n2) (integer) 1\n")),(0,i.kt)("p",null,"\uc704\uc640 \uac19\uc774, exec\uc758 \uba85\ub839\uc744 \ud55c \uc21c\uc11c\ub300\ub85c array\ud615\ud0dc\ub85c \uc751\ub2f5\uac12\uc744 \uc900\ub2e4. "),(0,i.kt)("br",null),(0,i.kt)("h3",{id:"watch\uc640-\uac19\uc774-\uc0ac\uc6a9\ud558\uba74"},"watch\uc640 \uac19\uc774 \uc0ac\uc6a9\ud558\uba74"),(0,i.kt)("p",null,"\uc6b0\ub9ac\uac00 \uc0ac\uc6a9\ud558\ub294 RDB\uc758 optimistic lock\uacfc \uac19\uc740\ub370, \ub9cc\uc57d \uc9e7\uc740\uc2dc\uac04\uc5d0 \uc5ec\ub7ec \ud074\ub77c\uc774\uc5b8\ud2b8\uac00 \ub3d9\uc2dc\uc5d0 \uc811\uadfc \ud560\uc2dc \ud754\ud788 \ub3d9\uc2dc\uc131 \ubb38\uc81c\uac00 \uc0dd\uae30\ub294\ub370 ",(0,i.kt)("inlineCode",{parentName:"p"},"watch")," \ub97c \uc0ac\uc6a9\ud558\uba74 \ud574\uacb0\uc774 \ub41c\ub2e4. "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"WATCH mykey\nval = GET mykey\nval = val + 1\nMULTI\nSET mykey $val\nEXEC\n")),(0,i.kt)("p",null,"myKey\ub77c\ub294 key\uc5d0 watch\ub97c \uc8fc\uace0(\ud0a4\ub97c \uac10\uc2dc) \uc791\uc5c5 \ud6c4\uc5d0, exec(\uc218\uc2e0 \uc804) \uc804 \ub2e4\ub978 \ud074\ub77c\uc774\uc5b8\ud2b8\uc5d0\uc11c \uba3c\uc800 val\uac12\uc744 \uc218\uc815\uc744\ud588\uc73c\uba74 \ud2b8\ub79c\uc7ad\uc158\uc740 \uc790\ub3d9\uc73c\ub85c \uc2e4\ud328\ud558\uac8c \ub41c\ub2e4.",(0,i.kt)("br",{parentName:"p"}),"\n","\uc774 \ub54c\ub294 \ud074\ub77c\uc774\uc5b8\ud2b8\uc758 \uc218\uc815\ubfd0\ub9cc \uc544\ub2c8\ub77c ttl\uc5d0 \uc758\ud55c \ud0a4\ub9cc\ub8cc \uc81c\uac70 \ub4f1\uacfc\uac19\uc774 Redis\uc5d0 \uc790\uccb4\uc5d0 \uc758\ud55c \uc218\uc815\ub3c4 \ud3ec\ud568\uc774\ub41c\ub2e4.  "),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Trasnaction \uc548\uc5d0 \uc788\ub294 \uba85\ub839\uc740 exec\uac00 \uc804\uc1a1 \ub420 \ub54c\uae4c\uc9c0 \ud050\uc5d0 \ub2f4\uaca8\uc788\uc5b4\uc11c watch\uc5d0 \ud2b8\ub9ac\uac70 \ub418\uc9c0 \uc54a\uc73c\ub2c8 \uc8fc\uc758\ud574\uc57c\ud55c\ub2e4."))),(0,i.kt)("p",null,"\ud83d\udca1\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"Discard"),"\nDiscard\ub294 \ud050\uc5d0 \ub2f4\uaca8\uc788\ub294 \uac83\ub4e4\uc744 \ubc84\ub9b0\ub2e4."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'> SET foo 1\nOK\n> MULTI\nOK\n> INCR foo\nQUEUED\n> DISCARD\nOK\n> GET foo\n"1"\n')),(0,i.kt)("br",null),(0,i.kt)("h2",{id:"luascript\ub780"},"Luascript\ub780"),(0,i.kt)("p",null,"\ub8e8\uc544\uc2a4\ud06c\ub9bd\ud2b8\ub294 Redis\uc5d0 \ub0b4\uc7a5\ub41c \uc2e4\ud589 \uc5d4\uc9c4\uc5d0 \uc758\ud574 \uc2e4\ud589\ub418\ub294\ub370. \ud604\uc7ac \ub808\ub514\uc2a4\ub294 \ub2e8\uc77c \uc2a4\ud06c\ub9bd\ud2b8 \uc5d4\uc9c4\uc778 lua 5.1 \uc778\ud130\ud53c\ub9ac\ud130\ub97c \uc9c0\uc6d0\ud55c\ub2e4. \ub610 \uc2a4\ud06c\ub9bd\ud2b8\ub294 \uc11c\ubc84\uc5d0\uc11c \uc2e4\ud589\ub418\ubbc0\ub85c \uc774\ub294 \uc790\uc5f0\uc2a4\ub7fd\uac8c \ub124\ud2b8\uc6cc\ud0b9 \ub9ac\uc18c\uc2a4\ub97c \uc808\uc57d\ud558\uac8c \ub418\uc5b4 \uc2a4\ud06c\ub9bd\ud2b8\uc5d0\uc11c \ub370\uc774\ud130\ub97c \uc77d\uace0 \uc4f0\ub294 \uac74 \ub9e4\uc6b0 \ud6a8\uc728\uc801\uc774\uac8c \uc791\ub3d9\ud55c\ub2e4. \ub610 \ub808\ub514\uc2a4\uc5d0\uc11c \ub8e8\uc544 \uc2a4\ud06c\ub9bd\ud2b8\ub97c \uc0ac\uc6a9\ud558\uba74 atomic\uc744 \ud568\uc744 \ubcf4\uc7a5\ud574\uc900\ub2e4. \ub610 \ub8e8\uc544\uc2a4\ud06c\ub9bd\ud2b8\ub97c \uc0ac\uc6a9\ud558\uba74 \uc870\uac74\uc801\uc778 update\ub97c \uc5ec\ub7ec \ud0a4\uc5d0 \uceec\uccd0 \uc9c0\uc6d0\ud574\uc8fc\uace0,  \uac1c\ubcc4\uc758 \uac01\uae30\ub2e4\ub978 \ub370\uc774\ud130 \ud0c0\uc785\uc744 \uc6d0\uc790\uc801\uc73c\ub85c \uacb0\ud569\uc774\uac00\ub2a5\ud574\uc9c4\ub2e4."),(0,i.kt)("p",null,"\uadf8\ub0e5 \ub2e8\uc21c\ud55c \uc0ac\uc6a9\uc744 \ud574\ubcf8\ub2e4\uba74 "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},">EVAL \"return redis.call('SET', KEYS[1], ARGV[1])\" 1 foo bar\nOK\n> GET foo\nbar\n")),(0,i.kt)("p",null,"\uc870\uae08 \ub354 \uc0ac\uc6a9\uc744 \ud574\ubcf8\ub2e4\uba74 "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"> EVAL \"redis.call('sadd','myset1', 'user1')\nredis.call('sadd','myset2', 'user2')\nlocal members = redis.call('keys','myset*') \nlocal results = {} \nfor index,key in ipairs(members) \ndo results[index] = redis.call('smembers',key) \nend return results\" \n")),(0,i.kt)("br",null),(0,i.kt)("h2",{id:"\ucc28\uc774\uc810"},"\ucc28\uc774\uc810"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"multi/exec")," \ub294 \ud2b8\ub79c\uc7ad\uc158 \uc751\ub2f5\uc744 array \ud615\ud0dc\ub85c \ubc1b\uc544\uc11c \uc5ec\ub7ec \uba85\ub839\uc5b4\ub97c \ud1b5\ud574 \uc608\ub97c\ub4e4\uc5b4 \uc791\uc5c5\uc740 \ubd88\uac00\ub2a5\ud558\uc9c0\ub9cc Luasript\ub294  script\ub97c \uc774\uc6a9\ud574 \uac00\ub2a5\ud558\ub2e4.",(0,i.kt)("br",{parentName:"p"}),"\n","\uc608\ub97c \ub4e4\uc5b4 lpop\uc73c\ub85c \ub2f4\uae34 userlist \ud050\uc5d0 \uc21c\uc11c\ub300\ub85c \uaebc\ub0b4\uc11c \uadf8 \ud0a4\uac12\uc73c\ub85c user\uc758 \uc810\uc218\ub97c \uc62c\ub9b0\ub2e4\uace0\ud55c\ub2e4\uba74 luascript\ub97c \uc0ac\uc6a9\ud558\uba74 \ud3b8\ud558\ub2e4."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"> lpush userList user1 user2 user3\n> EVAL \"\nlocal user = redis.call('LPOP', 'userList')\nlocal result = redis.call('INCRBY', user, 1);\n\nreturn result \" \n")),(0,i.kt)("br",null),(0,i.kt)("h2",{id:"\ubb58-\uc0ac\uc6a9\ud574\uc57c\ud560\uae4c"},"\ubb58 \uc0ac\uc6a9\ud574\uc57c\ud560\uae4c"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"multi"),"\ub97c \uc0ac\uc6a9\ud558\ub358 ",(0,i.kt)("inlineCode",{parentName:"p"},"luascript")," \ub97c \uc0ac\uc6a9\ud558\ub358 \ub458\ub2e4 atomic\ud558\uac8c \ud55c \uc624\ud37c\ub808\uc774\uc158\uc5d0 \uba85\ub839\ub4e4\uc744 \ud55c \ubc88\uc5d0 \uac19\uc774 \ubcf4\ub0bc \uc218 \uc788\uc9c0\ub9cc \ud2b9\uc815 \uc0c1\ud669\uc5d0\uc11c\ub294 ",(0,i.kt)("inlineCode",{parentName:"p"},"multi/exec"),"\ub85c\ub294 \uad6c\ud604\uc774 \ud798\ub4e4 \ub54c\uac00\uc788\uc73c\ub2c8 \uc774\ub54c luascript \uc0ac\uc6a9\uc774 \ub300\uc548\uc774 \ub420 \uc218 \uc788\ub2e4."),(0,i.kt)("br",null),(0,i.kt)("p",null,"\ucc38\uace0",(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("a",{parentName:"p",href:"https://redis.io/docs/manual/programmability/eval-intro/"},"https://redis.io/docs/manual/programmability/eval-intro/"),(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("a",{parentName:"p",href:"https://stackoverflow.com/questions/62970603/lua-scripts-vs-multi-exec-in-redis"},"https://stackoverflow.com/questions/62970603/lua-scripts-vs-multi-exec-in-redis"),(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("a",{parentName:"p",href:"https://redis.io/docs/manual/transactions/"},"redisTransaction"),(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("a",{parentName:"p",href:"https://redis.io/commands/eval/"},"https://redis.io/commands/eval/"),(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("a",{parentName:"p",href:"https://scalegrid.io/blog/redis-transactions-long-running-lua-scripts/"},"https://scalegrid.io/blog/redis-transactions-long-running-lua-scripts/"),(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("a",{parentName:"p",href:"https://engineering.linecorp.com/ko/blog/atomic-cache-stampede-redis-lua-script/"},"https://engineering.linecorp.com/ko/blog/atomic-cache-stampede-redis-lua-script/"),(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("a",{parentName:"p",href:"https://javamana.com/2022/195/202207141451441296.html"},"lua script limits to solve the problem of inaccurate high concurrency counts")))}d.isMDXComponent=!0}}]);