"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9450],{6029:function(e){e.exports=JSON.parse('{"blogPosts":[{"id":"kafkashutodwn","metadata":{"permalink":"/kafkashutodwn","editUrl":"https://github.com/facebook/docusaurus/edit/main/website/blog/2022-06-20-spring-kafka-graceful-shutdown.md","source":"@site/blog/2022-06-20-spring-kafka-graceful-shutdown.md","title":"Spring Kafka Graceful Shutdown","description":"Spring kafka\ub294 Graceful shutdown\ud558\uac8c \uc798 \uc8fd\uc744\uae4c?","date":"2022-06-20T00:00:00.000Z","formattedDate":"June 20, 2022","tags":[{"label":"SpringBoot","permalink":"/tags/spring-boot"},{"label":"Kafka","permalink":"/tags/kafka"},{"label":"Graceful","permalink":"/tags/graceful"},{"label":"Shutdown","permalink":"/tags/shutdown"}],"readingTime":5.815,"truncated":true,"authors":[{"name":"Dongle","title":"Junior Backend Developer","url":"https://github.com/sk1737030","imageURL":"https://github.com/sk1737030.png","key":"dongle"}],"frontMatter":{"title":"Spring Kafka Graceful Shutdown","description":"Spring kafka\ub294 Graceful shutdown\ud558\uac8c \uc798 \uc8fd\uc744\uae4c?","slug":"kafkashutodwn","authors":"dongle","tags":["SpringBoot","Kafka","Graceful","Shutdown"],"image":"https://i.imgur.com/mErPwqL.png","hide_table_of_contents":false},"nextItem":{"title":"\ub0b4\uac00 \uacaa\uc740 N + 1 \ubb38\uc81c","permalink":"/my_n+1"}},"content":"Consumer\uac00 \uba54\uc138\uc9c0\ub97c \ucc98\ub9ac\uc911\uc5d0 Spring Boot \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0\uc11c shutdown event\uac00 \uc77c\uc5b4 \ub0ac\uc744 \ub54c \uacfc\uc5f0 \uc798 Shutdown Graceful\ud558\uac8c  \uc885\ub8cc\uac00 \ub418\ub294\uc9c0\uac00 \uad81\uae08\ud574\uc11c \ud574\ubcf4\ub294 \uc2e4\ud5d8. \\n\x3c!--truncate--\x3e\\n\\n[\ubaa8\ub4e0 \uc18c\uc2a4\ub294 \uc774\uacf3](https://github.com/sk1737030/til/tree/master/spring-kafka-graceful-shutdown)\uc5d0\uc11c \ud655\uc778 \uac00\ub2a5\ud569\ub2c8\ub2e4 :)\\n\\n# Spring Boot Kafka Grace full Shutdown\\n\\nConsumer\uac00 \uba54\uc138\uc9c0\ub97c \ucc98\ub9ac\uc911\uc5d0 Spring Boot \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0\uc11c shutdown event\uac00 \uc77c\uc5b4 \ub0ac\uc744 \ub54c \uacfc\uc5f0 \uc798 Shutdown Graceful\ud558\uac8c  \uc885\ub8cc\uac00 \ub418\ub294\uc9c0\uac00 \uad81\uae08\ud574\uc11c \ud574\ubcf4\ub294 \uc2e4\ud5d8. \\n\\n## \ubb34\uc5c7\uc744 \ud14c\uc2a4\ud2b8\ud558\ub0d0\\n\\nConsumer\uac00 \ucee8\uc298 \ud6c4 \ub370\uc774\ud130\ub97c \uc798 commit\ud558\ub294\uc9c0 Conusmer info \uad00\ucc30 \\n\\n`shutdownTimeout` : defualt 30\ucd08 \\n\\n`Kafka version`: 2.7.1\\n\\n`SpringBootVersion`: v2.5.6\\n\\n## \ubc29\ubc95\\n\\n1. `shutdownTimeout`  \ub0b4 \uc815\uc0c1\uc801\uc73c\ub85c \ubaa8\ub4e0 \uba54\uc138\uc9c0\uac00 \uc798 \ucc98\ub9ac \ub418\ub3c4\ub85d\\n    1. Spring Boot Kafka \uba54\uc138\uc9c0\ub97c 10\uac1c \uc0dd\uc131\\n    2. Consume \ud560 \ub54c \ucc98\ub9ac \uc2dc\uac04\uc774 \uac1c\ub2f9 1\ucd08\uac00 \uac78\ub9ac\ub3c4\ub85d \uc2e4\ud5d8 \\n    3. \ubaa8\ub4e0 \uba54\uc138\uc9c0\ub97c \uc18c\ube44 \ud560 \ub54c\uae4c\uc9c0 \ucd5c\uc18c 10\ucd08\uc758 \uc2dc\uac04\uc774 \ud544\uc694\ud55c \uc791\uc5c5\uc73c\ub85c \uc124\uc815\\n    4. \ucee8\uc288\uba38 \ucee4\ubc0b\uc774 \uc5b4\ub5bb\uac8c \ub418\ub294\uc9c0 \ud655\uc778\\n2. `shutdownTimeout`\uc744 \ub118\uc5b4\uc11c\ub3c4\ub85d \uc124\uc815 \\n    1. Spring Boot Kafka \uba54\uc138\uc9c0\ub97c 10\uac1c \uc0dd\uc131\\n    2. Consume \ud560 \ub54c \ucc98\ub9ac \uc2dc\uac04\uc774 \uac1c\ub2f9 10\ucd08\uac00 \uac78\ub9ac\ub3c4\ub85d \uc2e4\ud5d8 \\n    3. \ubaa8\ub4e0 \uba54\uc138\uc9c0\ub97c \uc18c\ube44 \ud560 \ub54c\uae4c\uc9c0 \ucd5c\uc18c 100\ucd08\uc758 \uc2dc\uac04\uc774 \ud544\uc694\ud55c \uc791\uc5c5\uc73c\ub85c \uc124\uc815 \\n    4. \ucee8\uc288\uba38 \ucee4\ubc0b\uc774 \uc5b4\ub5bb\uac8c \ub418\ub294\uc9c0 \ud655\uc778\\n\\n`Shutdown Signal`\uc740 \ub2e8\uc21c\ud558\uac8c 2\ub85c \ud14c\uc2a4\ud2b8\ud560 \uc608\uc815\uc774\ub2e4.\\n\\nlinux\uc758 shutdow number \ud655\uc778\\n\\n![[https://linuxhint.com/kill-signal-numbers-linux/](https://linuxhint.com/kill-signal-numbers-linux/)](./2022-06-20/Untitled.png)  \\n\\n[https://linuxhint.com/kill-signal-numbers-linux/](https://linuxhint.com/kill-signal-numbers-linux/)\\n\\n- **SIGKILL (9)**: SIGKILL signal \uc740 \ud504\ub85c\uc138\uc2a4\ub97c \uc989\uac01 \uc885\ub8cc \ud560 \ub54c \uc0ac\uc6a9\ud55c\ub2e4.\\n- **SIGINT(2)**: \uc0ac\uc6a9\uc790\uc758 \uc694\uccad\uc73c\ub85c \uc911\ub2e8\uc774 \ub420 \ub54c \uc0ac\uc6a9\ud55c\ub2e4. (e.g., Ctrl+C).\\n- S**IGTERM(15)**: SIGTERM signal \uc885\ub8cc \uc694\uccad\uc744 \ubcf4\ub0b8\ub2e4, \uc694\uccad\uc744 \ubcf4\ub0bc \ubfd0 SIGKILL\uc740 \uc544\ub2c8\ub2e4.\\n\\n:::noteaSigterm\\n\uc548\uc804\ud558\uac8c \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uc885\ub8cc\ud558\uace0 \uc2f6\uc73c\uba74 `SIGINT`\ub098 `SIGTEMR`\uc73c\ub85c \uc694\uccad\uc744 \ucd94\ucc9c\ud55c\ub2e4.\\n:::note\\n\\n## \uc2e4\ud5d8 \ubc0f \uacb0\uacfc\\n\\n\uac01\uc885 \uc124\uc815\uc740 default\ub85c \uc124\uc815\ud558\uace0 \uc9c4\ud589\ud55c\ub2e4.\\n\\n```\\nfetch.max.bytes = 52428800\\nfetch.max.wait.ms = 500\\nfetch.min.bytes = 1\\nauto.commit.interval.ms = 5000\\n```\\n\\n### 1\ubc88\\n\\nConsumer test.offset.1\uc758  offset \ud655\uc778  \\n\\n![Untitled](./2022-06-20/Untitled%201.png)  \\n- `current-offset`: 36\\n- `Lag`: 9\\n\\n\uc5b4\ud50c\ub9ac\ucf00\uc774\uc158 \uc885\ub8cc `signal 2: SIGINT`  \\n\\n```\\n2022-06-08 16:45:18.347 DEBUG 11696 --- [ionShutdownHook] s.c.a.AnnotationConfigApplicationContext : Closing org.springframework.context.annotation.AnnotationConfigApplicationContext@34d046b6, started on Wed Jun 08 16:45:09 KST 2022\\n2022-06-08 16:45:18.347 DEBUG 11696 --- [ionShutdownHook] ySourcesPropertyResolver$DefaultResolver : Found key \'spring.liveBeansView.mbeanDomain\' in PropertySource \'systemProperties\' with value of type String\\n2022-06-08 16:45:18.348 DEBUG 11696 --- [ionShutdownHook] o.s.c.support.DefaultLifecycleProcessor  : Stopping beans in phase 2147483547\\n```\\n\\nDebug\ub85c \ub85c\uadf8 \ud655\uc778  \\n\\n```\\nessageListenerContainer$ListenerConsumer : Commit list: {test-0=OffsetAndMetadata{offset=45, leaderEpoch=null, metadata=\'\'}}\\nessageListenerContainer$ListenerConsumer : Committing: {test-0=OffsetAndMetadata{offset=45, leaderEpoch=null, metadata=\'\'}}\\norg.apache.kafka.clients.NetworkClient   : [Consumer clientId=consumer-test.offset.1-1, groupId=test.offset.1] Sending OFFSET_COMMIT request with header RequestHeader(apiKey=OFFSET_COMMIT, apiVersion=7, clientId=consumer-test.offset.1-1, correlationId=17) and timeout 30000 to node 2147483646: {group_id=test.offset.1,generation_id=5,member_id=consumer-test.offset.1-1-0fd44995-c1a6-451a-9987-ab35edab9f74,group_instance_id=null,topics=[{name=test,partitions=[{partition_index=0,committed_offset=45,committed_leader_epoch=-1,committed_metadata=}]}]}\\norg.apache.kafka.clients.NetworkClient   : [Consumer clientId=consumer-test.offset.1-1, groupId=test.offset.1] Received OFFSET_COMMIT response from node 2147483646 for request with header RequestHeader(apiKey=OFFSET_COMMIT, apiVersion=7, clientId=consumer-test.offset.1-1, correlationId=17): OffsetCommitResponseData(throttleTimeMs=0, topics=[OffsetCommitResponseTopic(name=\'test\', partitions=[OffsetCommitResponsePartition(partitionIndex=0, errorCode=0)])])\\no.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-test.offset.1-1, groupId=test.offset.1] Committed offset 45 for partition test-0\\no.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-test.offset.1-1, groupId=test.offset.1] Executing onLeavePrepare with generation Generation{generationId=5, memberId=\'consumer-test.offset.1-1-0fd44995-c1a6-451a-9987-ab35edab9f74\', protocol=\'range\'} and memberId consumer-test.offset.1-1-0fd44995-c1a6-451a-9987-ab35edab9f74\\no.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-test.offset.1-1, groupId=test.offset.1] Revoke previously assigned partitions test-0\\no.s.k.l.KafkaMessageListenerContainer    : test.offset.1: partitions revoked: [test-0]\\nessageListenerContainer$ListenerConsumer : Commit list: {}\\no.a.k.c.c.internals.AbstractCoordinator  : [Consumer clientId=consumer-test.offset.1-1, groupId=test.offset.1] Member consumer-test.offset.1-1-0fd44995-c1a6-451a-9987-ab35edab9f74 sending LeaveGroup request to coordinator localhost:9092 (id: 2147483646 rack: null) due to the consumer unsubscribed from all topics\\norg.apache.kafka.clients.NetworkClient   : [Consumer clientId=consumer-test.offset.1-1, groupId=test.offset.1] Sending LEAVE_GROUP request with header RequestHeader(apiKey=LEAVE_GROUP, apiVersion=2, clientId=consumer-test.offset.1-1, correlationId=18) and timeout 30000 to node 2147483646: {group_id=test.offset.1,member_id=consumer-test.offset.1-1-0fd44995-c1a6-451a-9987-ab35edab9f74}\\no.a.k.c.c.internals.AbstractCoordinator  : [Consumer clientId=consumer-test.offset.1-1, groupId=test.offset.1] Resetting generation due to consumer pro-actively leaving the group\\no.a.k.clients.consumer.KafkaConsumer     : [Consumer clientId=consumer-test.offset.1-1, groupId=test.offset.1] Unsubscribed all topics or patterns and assigned partitions\\no.s.s.c.ThreadPoolTaskScheduler          : Shutting down ExecutorService\\no.a.k.c.c.internals.AbstractCoordinator  : [Consumer clientId=consumer-test.offset.1-1, groupId=test.offset.1] Heartbeat thread has closed\\no.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-test.offset.1-1, groupId=test.offset.1] Executing onLeavePrepare with generation Generation{generationId=-1, memberId=\'\', protocol=\'null\'} and memberId\\no.a.k.c.c.internals.AbstractCoordinator  : [Consumer clientId=consumer-test.offset.1-1, groupId=test.offset.1] Resetting generation due to consumer pro-actively leaving the group\\norg.apache.kafka.clients.NetworkClient   : [Consumer clientId=consumer-test.offset.1-1, groupId=test.offset.1] Received LEAVE_GROUP response from node 2147483646 for request with header RequestHeader(apiKey=LEAVE_GROUP, apiVersion=2, clientId=consumer-test.offset.1-1, correlationId=18): LeaveGroupResponseData(throttleTimeMs=0, errorCode=0, members=[])\\no.a.k.c.c.internals.AbstractCoordinator  : [Consumer clientId=consumer-test.offset.1-1, groupId=test.offset.1] LeaveGroup response with Generation{generationId=5, memberId=\'consumer-test.offset.1-1-0fd44995-c1a6-451a-9987-ab35edab9f74\', protocol=\'range\'} returned successfully: ClientResponse(receivedTimeMs=1655698563052, latencyMs=12, disconnected=false, requestHeader=RequestHeader(apiKey=LEAVE_GROUP, apiVersion=2, clientId=consumer-test.offset.1-1, correlationId=18), responseBody=LeaveGroupResponseData(throttleTimeMs=0, errorCode=0, members=[]))\\n```\\n\\n\ud765\ubbf8\ub85c\uc6b4 \ub85c\uadf8\uac00 \uba87 \uac1c \ubcf4\uc778\ub2e4. \\n\\n1. OFFSET_COMMIT  \\n2. Revoke Listener\uac00 \uc791\ub3d9\uc744 \ud558\uace0  \\n3. LeaveGroup Request  \\n4. Thread Shutodnw Event\uac00 \uc2dc\uc791\uc744 \ud558\uace0   \\n5. HeaerBeat thread\uac00 \uc885\ub8cc \ub418\uace0   \\n6. LeaveGroup\uc744 \ubc1b\ub294\ub2e4.  \\n\\ntopic\uc758 offset \ud655\uc778   \\n![Untitled](./2022-06-20/Untitled%202.png)  \\n\\n- `current-offset`:45\\n- `lag`: 0\\n\\n### 2\ubc88\\n\\nConsumer test.offset.1\uc758  offset \ud655\uc778 \\n\\n![Untitled](./2022-06-20/Untitled%201.png)\\n\\n- current-offset: 36\\n- Lag: 9\\n\\n\uc5b4\ud50c\ub9ac\ucf00\uc774\uc158 \uc885\ub8cc `signal 2: SIGINT`\\n\\n```\\n2022-06-08 16:45:18.347 DEBUG 11696 --- [ionShutdownHook] s.c.a.AnnotationConfigApplicationContext : Closing org.springframework.context.annotation.AnnotationConfigApplicationContext@34d046b6, started on Wed Jun 08 16:45:09 KST 2022\\n2022-06-08 16:45:18.347 DEBUG 11696 --- [ionShutdownHook] ySourcesPropertyResolver$DefaultResolver : Found key \'spring.liveBeansView.mbeanDomain\' in PropertySource \'systemProperties\' with value of type String\\n2022-06-08 16:45:18.348 DEBUG 11696 --- [ionShutdownHook] o.s.c.support.DefaultLifecycleProcessor  : Stopping beans in phase 2147483547\\n```\\n\\nShout down TimeOut \uc774\ud6c4 \ub85c\uadf8\ub97c \ubcf8\ub2e4\uba74\\n\\n```\\n2022-06-03 18:16:35.861  INFO 9116 --- [ionShutdownHook] o.s.c.support.DefaultLifecycleProcessor  :\\n **Failed to shut down 1 bean with phase value 2147483547 within timeout of 30000ms:** \\n[org.springframework.kafka.config.internalKafkaListenerEndpointRegistry]\\n```\\n\\nOffset \ud655\uc778\\n\\n![Untitled](./2022-06-20/Untitled%203.png)\\n\\n`shutdown timeout`\uc73c\ub85c \uc778\ud574 Commit\uc774 \uc815\uc0c1\uc801\uc73c\ub85c \uc548\ub41c \uc0c1\ud0dc\uc774\ub2e4.\\n\\n### \uacb0\ub860\\n\\nTimeout \uc774\ub0b4\uc5d0 \uba54\uc2dc\uc9c0\ub294 \uc798 `Graceful`\ud558\uac8c \ucc98\ub9ac\ud55c\ub2e4. \uadf8\ub7ec\ub098 \ub9cc\uc57d timeout \ub0b4\uc5d0 \ucc98\ub9ac\ub97c \ubabb \ud55c\ub2e4\uba74 \uba54\uc2dc\uc9c0\ub97c \uc911\ubcf5\uc73c\ub85c \ucc98\ub9ac\ud558\ub294 \uc0c1\ud669\uc774 \ub098\ud0c0\ub0a0 \uc218 \uc788\uc73c\ub2c8, \uc801\uc808\ud55c \ubc29\uc5b4 \ub85c\uc9c1\uacfc \uc218\ub3d9 commit\uc73c\ub85c \ud480\uc5b4\uc11c \ucc98\ub9ac\ub97c\ud558\uac70\ub098 timeout\uc744 \uc54c\ub9de\uac8c \uc124\uc815\ud574\uc57c \ud560 \uac70 \uac19\ub2e4.\\n\\n### \ucc38\uace0  \\n[https://docs.spring.io/spring-kafka/docs/2.5.17.RELEASE/reference/html/](https://docs.spring.io/spring-kafka/docs/2.5.17.RELEASE/reference/html/)  \\n[https://bravenamme.github.io/2020/10/06/graceful-shutdown/](https://bravenamme.github.io/2020/10/06/graceful-shutdown/)  \\n[https://docs.confluent.io/confluent-cli/current/overview.html](https://docs.confluent.io/confluent-cli/current/overview.html)  \\n[https://kafka.apache.org/documentation/](https://kafka.apache.org/documentation/)  \\n[signum \ubc88\ud638 \uc124\uba85](https://linuxhint.com/kill-signal-numbers-linux/) \\n[zoe kafka cli](https://github.com/adevinta/zoe)  \\n[consume Config \uc124\uba85](https://docs.confluent.io/platform/current/installation/configuration/consumer-configs.html)"},{"id":"my_n+1","metadata":{"permalink":"/my_n+1","editUrl":"https://github.com/facebook/docusaurus/edit/main/website/blog/2022-05-28-jpaN+1.md","source":"@site/blog/2022-05-28-jpaN+1.md","title":"\ub0b4\uac00 \uacaa\uc740 N + 1 \ubb38\uc81c","description":"Spring Boot N+1 JPA","date":"2022-05-28T00:00:00.000Z","formattedDate":"May 28, 2022","tags":[{"label":"SpringBoot","permalink":"/tags/spring-boot"},{"label":"JPA","permalink":"/tags/jpa"},{"label":"N+1","permalink":"/tags/n-1"},{"label":"Hibernate","permalink":"/tags/hibernate"}],"readingTime":7.395,"truncated":true,"authors":[{"name":"Dongle","title":"Junior Backend Developer","url":"https://github.com/sk1737030","imageURL":"https://github.com/sk1737030.png","key":"dongle"}],"frontMatter":{"title":"\ub0b4\uac00 \uacaa\uc740 N + 1 \ubb38\uc81c","description":"Spring Boot N+1 JPA","slug":"my_n+1","authors":"dongle","tags":["SpringBoot","JPA","N+1","Hibernate"],"image":"https://i.imgur.com/mErPwqL.png","hide_table_of_contents":false},"prevItem":{"title":"Spring Kafka Graceful Shutdown","permalink":"/kafkashutodwn"},"nextItem":{"title":"DB transaction Isolation\uc5d0 \ub300\ud574\uc11c \uc54c\uc544\ubcf4\uc790","permalink":"/db-isolation"}},"content":"JPA\ub97c \uc4f0\uba74\uc11c \uc6b0\ub9ac\uac00 \uc77c\ubc18\uc801\uc73c\ub85c \ubc1c\uc0dd\ud558\uc5ec\uc11c \ud574\ubcfc \uac74 \ub2e4 \ud574\ubd10\ub3c4 \uc548\ub410\uc5c8\ub358 N+1 \ubb38\uc81c \\n\x3c!--truncate--\x3e\\n\\n\\n[\ubaa8\ub4e0 \uc18c\uc2a4\ub294 \uc774\uacf3](https://github.com/sk1737030/til/tree/master/til-jpa)\uc5d0\uc11c \ud655\uc778 \uac00\ub2a5\ud569\ub2c8\ub2e4 :)\\n\\n## N + 1 \ubb38\uc81c\\nJPA\ub97c \uc4f0\uba74\uc11c \uc6b0\ub9ac\uac00 \uc77c\ubc18\uc801\uc73c\ub85c \ubc1c\uc0dd\ud558\uc5ec\uc11c \ud574\ubcfc \uac74 \ub2e4 \ud574\ubd10\ub3c4 \uc548\ub410\uc5c8\ub358 N+1 \ubb38\uc81c  \\n\uc77c\ubc18\uc801\uc73c\ub85c \uc6b0\ub9ac\uac00 \ud754\ud788 N+1\ubb38\uc81c\uac00 \ubc1c\uc0dd\uc744 \ud560 \uc218 \uc788\ub294\ub370 \uc774\ubbf8 \ub9ce\uc740 \uc0ac\ub78c\uc774 \uc54c\uaca0\uc9c0\ub9cc \ud0b9\uac13\uc601\ud658\ub2d8\uc758 \ucc45\uc744 \ubcf4\uac70\ub098 \uac15\uc758\ub97c \ubcf4\uba74 \uc9c4\uc9dc \ub2e4 \ud574\uacb0\uc774 \uac00\ub2a5\ud588\ub294\ub370  \\n\ub0b4\uac00 \ub9c8\uc8fc\ud55c \ubb38\uc81c\ub294 \ud574\uacb0\uc774 \uc548 \ub410\uc5c8\ub2e4. \uc77c\ubc18\uc801\uc73c\ub85c \ud574\uacb0\uc744 \uc704\ud574 \uadf8\uc5d0 \uc0c1\ud669\ub9c8\ub2e4 \ub2e4\ub974\uaca0\uc9c0\ub9cc \ud754\ud558\uac8c \uac00\uc7a5 \uba3c\uc800 lazy\ub85c \ubcc0\uacbd, fetch join, fetch size\uc870\uc815 \ub4f1 \uc5ec\ub7ec \uc791\uc5c5\uc744 \ud588\ub294\ub370  \\n\ud574\uacb0\uc774 \uc548 \ub410\uc5c8\ub2e4.\\n\\n\\n\ucf54\ub4dc\uac00 \ub9ce\uc774 \ub2e4\ub974\uace0 \ub3c4\uba54\uc778\ub3c4 \ub2e4\ub974\uc9c0\ub9cc \uadf8\ub098\ub9c8 \ube44\uc2b7\ud558\uac8c \ucf54\ub4dc\ub97c \uc7ac\ud604 \ud574\ubcf4\uc790\uba74\\n\\n\\n```java\\n@Entity\\n@NoArgsConstructor(access = AccessLevel.PROTECTED)\\n@AllArgsConstructor(access = AccessLevel.PROTECTED)\\n@Getter\\npublic class Member  {\\n\\t@Id\\n  @Column(name = \\"member_id\\")\\n  private Long id;\\n\\t\\n\\tprivate String memberEmail;\\n\\n\\t@OneToMany(mappedBy = \\"Member\\", cascacde = CascadeType.ALL, orphanRemoval = true)\\n\\tprivate\\tSet<Order>\\torders = LinkedHashSet<>();\\n\\n\\t...\\n}\\n\\n@Entity\\n@NoArgsConstructor(access = AccessLevel.PROTECTED)\\n@AllArgsConstructor(access = AccessLevel.PROTECTED)\\n@Getter\\npublic class Order  {\\n\\t@ID\\n\\t@Column(name = \\"order_id\\")\\n\\tpriate Long id;\\n\\t\\n\\t@ManyToOne(fetch = FetchType.LAZY)\\n  @JoinColumn(name = \\"memberEmail\\", referencedColumnName = \\"memberEmail\\", nullable = false, updatable = false)\\n\\tprivate\\tSet<Order>\\torder = LinkedHashSet<>();\\n\\n\\t...\\n}\\n\\n```\\n\\n\uc774\ub7f0 \ub290\ub08c\uc758 Entity\uc600\ub2e4.  \\n\uc774\ub54c\uc758 \ub098 \ube7c\uace0 \uc5d4\ud2f0\ud2f0\uac00 \uc5b4\ub5a4 \ubb38\uc81c\uac00 \uc788\ub294\uc9c0 \uc54c\uaca0\uc9c0\ub9cc \uc774\ub54c\uae4c\uc9c0\ub294 \ub098\ub294 \uafc8\uc5d0\ub3c4 \ubab0\ub790\ub2e4. ~~5\uc2dc\uac04\uc744 \ubc84\ub9b4 \uc904\uc740 \ubab0\ub790\ub2e4!~~  \\n\\n\uae30\ud68d: \ud68c\uc6d0\uc73c\ub85c \uc8fc\ubb38 \uc815\ubcf4\ub97c \ubcfc \uc218 \uc788\uac8c \ud574\uc8fc\uc138\uc694  \\n\ub098: members \uae30\uc900\uc73c\ub85c Order\ub97c \ub2e4 \uac00\uc838\uc624\uba74 \ub418\uaca0\uad6c\ub098! \uc74c \uadf8\ub7ec\uba74 \uac00\uc838\uc62c \ub54c \uc18d\ub3c4\ub97c \uc704\ud574 fetch join \ud574\uc11c \uac00\uc838\uc640\uc57c\uc9c0!    \\n![Untitled](./2022-05-28/Untitled.png)\\n\\n\uadf8\ub807\uac8c \ub2e4\uc12f\uc2dc\uac04\uc744 \uc7a1\uc544\uba39\uc744 \uc904\uc740 \ubab0\ub790\uc5c8\ub2e4.    \\n\uc544\ub2c8 \uc9c4\uc9dc \ud551\uacc4\ub97c \ub300\uc790\uba74 \uc774\ub807\uac8c \uc5d4\ud2f0\ud2f0\ub97c \uad6c\uc131\ud55c \uac74 \ub0b4\uac00 \uc544\ub2c8\ub77c \uae30\uc874 \ucf54\ub4dc\ub97c \uac00\uc9c0\uace0 \ub2e4\ub978 \uacf3\uc5d0\uc11c \uc4f0\ub2e4\uac00 \uc774\ub807\uace0 \uc800\ub807\uace0.. \uad6c\uad6c\uc808\uc808 ~~**\ud560\ub9d0\ud558\uc548**~~\\n\\n![Untitled](./2022-05-28/Untitled%201.png)\\n\\n### \ub0b4\uac00 \uadf8\ub9b0 \uadf8\ub9b0 \ucffc\ub9ac\\n\\n```sql\\nselect a.*, b.*\\nfrom member m \\ninner join order o on m.memberEmail = o.memberEmail;\\n```\\n\\n\uc774\ub7f0 \ub290\ub08c\uc758 (~~\ub108\ub3c4 \ud55c\ubc29 \ub098\ub3c4\ud55c\ubc29~~)\ucffc\ub9ac\ub97c \uc6d0\ud574\uc11c\\n\\n### Fetch\ub97c \uc4f0\uc790\\n\\n```java\\n\\npublic interface ProblemRepository extends JpaRepository<Member, Long> {\\n\\t\\tprivate final JPAQueryFactory queryFactory;\\n\\n\\t\\t@Query(\\"SELECT distinct m FROM Member m join fetch m.orders\\")\\n    List<Member> findAllFetch();\\n}\\n```\\n\\n\uc774\ub807\uac8c \uc870\ud68c\ub97c \ud588\ub294\ub370 \\n\\n```java\\n@Test\\nvoid save() {\\n\\t   // Given\\n\\n    for (int i = 0; i < 2; i++) {\\n        Member memFixture = new Member( i + \\"@naver.com\\");\\n        Order orderFixture = new Order(i + \\"delivery\\");\\n        memFixture.addOrder(orderFixture);\\n        problemRepository.save(memFixture);\\n        em.flush();\\n        em.clear();\\n    }\\n\\n    List<Member> members = problemRepository.findAllFetch();\\n\\n    assertThat(members.size()).isEqualTo(2);\\n    assertThat(members.get(0).getOrders().size()).isEqualTo(1);\\n    assertThat(members.get(1).getOrders().size()).isEqualTo(1);\\n}\\n```\\n\\n\ud3b8\uc758\ub97c \uc704\ud574\uc11c \ub300\ucda9 \uc774\ub807\uac8c \ud588\ub2e4 \uac00\uc815\ud558\uace0..  \ud14c\uc2a4\ud2b8\ub97c \ub3cc\ub824\uc11c \ud655\uc778\ud574\ubcf4\ub2c8  \\n\\n```yaml\\nHibernate: \\n\\nselect\\n  distinct member0_.member_id as member_i1_0_0_,\\n  orders1_.order_id as order_id1_1_1_,\\n  member0_.member_email as member_e2_0_0_,\\n  orders1_.member_email as member_e3_1_1_,\\n  orders1_.order_status as order_st2_1_1_,\\n  orders1_.member_email as member_e3_1_0__,\\n  orders1_.order_id as order_id1_1_0__ \\nfrom\\n  t_member member0_ \\ninner join\\n  t_order orders1_ \\n      on member0_.member_email=orders1_.member_email\\n```\\n\\n\uc74c .. \uc608\uc0c1\ud55c \ucffc\ub9ac\ub124 \\n\\n```yaml\\nHibernate: \\n    /* load com.example.tiljpa.problem.Member */ select\\n        member0_.member_id as member_i1_0_0_,\\n        member0_.member_email as member_e2_0_0_ \\n    from\\n        t_member member0_ \\n    where\\n        member0_.member_email=?\\nHibernate: \\n    /* load com.example.tiljpa.problem.Member */ select\\n        member0_.member_id as member_i1_0_0_,\\n        member0_.member_email as member_e2_0_0_ \\n    from\\n        t_member member0_ \\n    where\\n        member0_.member_email=?\\n```\\n\\n?????? \uc774\ub7f0 \ucffc\ub9ac\ub4e4\uc774 \uc870\ud68c\ud55c \uba64\ubc84 \uc218\ub9cc\ud07c \ub2e4\uc2dc \ucffc\ub9ac\uac00 \ucad8\ub77c\ub77c\ub77c\ub77c\ub77c\ub77c\ub77c\ub77c\ub77c\ub77c\ub77c\ub77c\ub77c\ub77d \ub098\uac00\ubc84\ub838\ub2e4..\\n\\n\uc774\ub54c \uc5e5..? \uc65c fetch join\uc744 \ud558\uace0 \ucffc\ub9ac\ub97c \uac00\uc838\uc654\ub294\ub370 \ub2e4\uc2dc member\ucffc\ub9ac\uac00 \ub098\uac00\uc9c0?? \\n\\n\uc774\ub584\ubd80\ud130 \uba58\ubd95\uc758 \uc2dc\uc791\uc774\uc600\ub2e4.\\n\\n### \ub514\ubc84\uae45\ud558\uba74\uc11c\uc758 \ucd94\uce21\\n\\n1. \uc77c\ub2e8 fetch mode\ub97c eager\ub85c \ubc14\uafd4\ubcf4\uc790.. \\n    - \uc2e4\ud328\\n2. querydsl\ub85c join\uc744 \ud558\uba74 \ub2e4\ub97c\uae4c? \\n    - \uc2e4\ud328\\n3. equals\ub791 hashcode\ub97c \ub123\uc5b4\ubcf4\uc790\\n    - \uc2e4\ud328\\n4. \uc544 \uc774\uac74\uc544\ub2cc\uac70\uac19\uc740\ub370 yml\uc5d0 batch size\ub97c \ub123\uc5b4\ubcf4\uc790 \\n    - \ub2f9\uc5f0\ud788 \uc2e4\ud328\\n5. transacton(readonly=true) \ub54c\ubb38\uc5d0 \uc601\uc18d\uc131 \ucee8\ud14d\uc2a4\ud2b8\uac00 \uc77c\uc744 \uc548\ud558\ub098? \uc88b\uc544 transaction\uc73c\ub85c\ub9cc \ud558\uc790 \\n    - \uc2e4\ud328\\n6. \uc544 \uc88b\uc544 \uc77c\ub2e8 \ub514\ubc84\uae45\uc744 \ud574\ubcf4\uc790 \\n    - \ub514\ubc84\uae45 \ud558\uba74\uc11c \ubcf4\ub2e4\ubcf4\ub2c8 \ucd5c\ucd08 fetch\ub85c \ubc1b\uc740 member \uac1d\uccb4\uc758 \uc8fc\uc18c\uc640 order\uac00 \uac00\uc9c0\uace0 \uc788\ub294 member\uac1d\uccb4\uc758 \uc8fc\uc18c\uac00 \ud655\uc5f0\ud788 \ub2ec\ub790\ub2e4.  \\n    ![Untitled](./2022-05-28/Untitled%202.png)          \\n\uc5b4 \ubb50\uc57c \uc65c\ub2ec\ub77c... \uc774\ub584\ubd80\ud130 \ubb34\ud55c \ucc57\ubc14\ud034 \ub3cc\ub4ef \uadf8\ub7ec\uba74 order\uc758 mode\ub97c eager\ub85c \ubc14\uafb8\uc790! (\uc0ac\uc2e4 \uc774\ubbf8 \ud574\ubd24\ub358\uac70\uc600\ub2e4) \ub2f9\uc5f0\ud788 \uc2e4\ud328  \\n![Untitled](./2022-05-28/Untitled%203.png)\\n\\n\ub3c4\uc800\ud788 \uc88b\uc740 \uc0dd\uac01\uc774 \ub5a0\uc624\ub974\uc9c0 \uc54a\uc544 \uc0b0\ucc45\uc744\ud558\uace0 \uc628 \ud6c4 \\n\\n### \ubb38\ub4dd\\n\\n\ubb38\ub4dd \uc6b0\ub9ac\uac00 join\uc744 \ud558\uba74 rdb\uc5d0\uc11c \ub2f9\uc5f0\ud788 \uc5ec\ub7ec \uac1c \ub098\uc624\ub294 \ubb38\uc81c\ub97c \uc6b0\ub9ac\ub294 \ud754\ud788 distnct\ub97c \ud558\ub294\ub370 \uc774\ub54c jpa\uc5d0\uc11c\ub294 **`Entity\uc758 @Id`**\ub85c \uc911\ubcf5\uc744 \uc81c\uac70\ud558\ub294 \uac8c \uc0dd\uac01\uc774 \uc9c0\ub098\uac00\ub294\ub370 \uc544 \uadf8\ub7ec\uba74 **fetchjoin**\ud55c \uc774\ud6c4 \uac00\uc838\uc654\uc5c8\uc744 \ub54c \uc601\uc18d\uc131 \ucee8\ud14c\uc2a4\ud2b8\uc5d0\uc11c `**@Id`** \ub85c \uad6c\ubd84\uc744 \ud55c\ub2e4\uace0 \uc0dd\uac01\uc774 \ub4e4\uc5b4 \uae30\uc874 `JoinColumn\uc5d0 member_email`\ub85c \ub418\uc5b4\uc788\ub294 \ucf54\ub4dc\ub97c `member_id`\ub85c \ubcc0\uacbd\ud588\ub2e4. \\n\\n```java\\n\\n@Entity\\n@NoArgsConstructor(access = AccessLevel.PROTECTED)\\n@AllArgsConstructor(access = AccessLevel.PROTECTED)\\n@Getter\\npublic class Order  {\\n\\t@ID\\n\\t@Column(name = \\"order_id\\")\\n\\tpriate Long id;\\n\\t\\n\\t@ManyToOne(fetch = FetchType.LAZY)\\n  @JoinColumn(name = \\"member_id\\", referencedColumnName = \\"member_id\\", nullable = false, updatable = false)\\n\\tprivate\\tSet<Member> members = LinkedHashSet<>();\\n\\n\\t...\\n}\\n\\n```\\n\\n\ub208 \uc218\uc220 \ud6c4 \uac74\uc870\ud55c \ub208 \ub54c\ubb38\uc5d0 \ub208\uc744 \uac1c\uc2a4\uce20\ub984\ud55c \ub208\ube5b\uc73c\ub85c \ubaa8\ub2c8\ud130\ub97c \ub6ab\uc5b4\uc9c0\uac8c \ubcf4\uba70 \uc0dd\uac01 \uc911\uc5d0 \uc2a4\uccd0 \uac00\ub294 \uc0dd\uac01\uc774 \uc788\uc5c8\ub294\ub370, Hibernate \uc785\uc7a5\uc5d0\uc11c \uc0dd\uac01(\ub1cc \ucf54\ub529)\uc744 \ud574\ubcf8\ub2e4\uba74 \ub2f9\uc5f0 \ud560 \uc218 \ubc16\uc5d0 \uc5c6\uad6c\ub098\ub77c\ub294 \uc0dd\uac01\uc774 \ub4e4\uc5c8\ub2e4.  \\n\ucffc\ub9ac\ub97c jqpl\ub85c \ub0a0\ub824 \ubcf4\ub0b4\uace0 \uc628 \ud6c4\uc5d0 **\uc601\uc18d\uc131 \ucee8\ud14d\uc2a4\ud2b8\uc5d0 \uce5c\uad6c\ub97c memberId\ub97c \uae30\uc900\uc73c\ub85c \ucee8\ud14d\uc2a4\ud2b8 \ud14c\uc774\ube14\uc5d0 \uac12\uc744 \ub123\uc5b4\ub193\uace0,** order\ub97c \ubcf4\ub294\ub370 \uc548\uc5d0 Lazy\uac00 \ub5a1\ud558\ub2c8 \uc120\uc5b8\ub418\uc5b4 \uc788\ub294 \uac78 \ubcf4\uace0 \ud5c8\uac81\uc9c0\uac81 \ub2e4\uc2dc \ucc3e\uc73c\ub824\uace0 \ucee8\ud14d\uc2a4\ud2b8\uc5d0\uc11c \ucc3e\uc558\ub294\ub370 \uc548\ubcf4\uc600\ub358 \uac83\uc774\ub2e4.  \\n\uadf8\ub798\uc11c 1\ucc28 \uce90\uc2dc\uc5d0 \uc5c6\ub124(Joincolumn\uc5d0 \uc120\uc5b8\ub41c member_email\uc744 \uac00\uc9c0\uace0 key\ub97c \ucc3e\ub2e4 \ubcf4\ub2c8 \uc2e4\uc81c\ub85c\ub294 fetchjoin\uc73c\ub85c \ub123\uc5c8\ub358 key\ub294 memberId\uc774\uc600\uc5b4\uc11c) \uadf8\ub7ec\uba74 db\uc5d0\uc11c \uc870\ud68c\ud574\uc57c\uaca0\ub2e4\uace0 \ud310\ub2e8\ud558\uace0 \ub2e4\uc2dc lazy\uc870\uc778\uc744 \ub0a0\ub824 \ubc1c\uc0dd\ud55c \ubb38\uc81c\uc778 \uac70\uc9c0 \uc54a\uc744\uae4c?\\n\\n\ucc38\uace0  \\n[Inflearn \uc601\ud658\ub2d8 \uac15\uc758](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8-JPA-API%EA%B0%9C%EB%B0%9C-%EC%84%B1%EB%8A%A5%EC%B5%9C%EC%A0%81%ED%99%94/)  \\n[JPA \ud504\ub85c\uadf8\ub798\ubc0d](http://www.kyobobook.co.kr/product/detailViewKor.laf?mallGb=KOR&ejkGb=KOR&barcode=9788960777330)\\n[docs](https://docs.spring.io/spring-data/jpa/docs/2.5.11/reference/html/)"},{"id":"db-isolation","metadata":{"permalink":"/db-isolation","editUrl":"https://github.com/facebook/docusaurus/edit/main/website/blog/2022-05-24-db-transaction-isolation.md","source":"@site/blog/2022-05-24-db-transaction-isolation.md","title":"DB transaction Isolation\uc5d0 \ub300\ud574\uc11c \uc54c\uc544\ubcf4\uc790","description":"Db \ud2b8\ub79c\uc7ad\uc158 Isolation","date":"2022-05-24T00:00:00.000Z","formattedDate":"May 24, 2022","tags":[{"label":"DB","permalink":"/tags/db"},{"label":"Isolation","permalink":"/tags/isolation"}],"readingTime":6.48,"truncated":true,"authors":[{"name":"Dongle","title":"Junior Backend Developer","url":"https://github.com/sk1737030","imageURL":"https://github.com/sk1737030.png","key":"dongle"}],"frontMatter":{"title":"DB transaction Isolation\uc5d0 \ub300\ud574\uc11c \uc54c\uc544\ubcf4\uc790","description":"Db \ud2b8\ub79c\uc7ad\uc158 Isolation","slug":"db-isolation","authors":"dongle","tags":["DB","Isolation"],"image":"https://i.imgur.com/mErPwqL.png","hide_table_of_contents":false},"prevItem":{"title":"\ub0b4\uac00 \uacaa\uc740 N + 1 \ubb38\uc81c","permalink":"/my_n+1"},"nextItem":{"title":"Spring Kafka Rebalancing \ucc98\ub9ac \ud574\ubcf4\uae30","permalink":"/rebalnace"}},"content":"\uc608\uc804\uc5d0 \ud55c \ubc88 \uc77d\uc5c8\ub358 RealMysql\ub97c \ub2e4\uc2dc\uae08 \uc77d\uc73c\uba74\uc11c \uc815\ub9ac\ud558\ub294 Transaction Isolation!\\n\x3c!--truncate--\x3e\\n\\n# Transaction Isolation Level\\n\\n### ACID\\nACID\ub294 \ub370\uc774\ud130\ubca0\uc774\uc2a4 \ub0b4\uc5d0\uc11c \uc77c\uc5b4\ub098\ub294 \ud558\ub098\uc758 \ud2b8\ub79c\uc7ad\uc158(transaction)\uc758 \uc548\uc804\uc131\uc744 \ubcf4\uc7a5\ud558\uae30 \uc704\ud574 \ud544\uc694\ud558\ub2e4.\\n- `Atomicity`: transaction\uc758 \uc791\uc5c5\uc774 \ubd80\ubd84\uc801\uc73c\ub85c \uc131\uacf5\ud558\ub294 \uc77c\uc774 \uc5c6\ub3c4\ub85d \ubcf4\uc7a5\ud558\ub294 \uc131\uc9c8\uc774\ub2e4. \uc1a1\uae08\ud558\ub294 \uc0ac\ub78c\uc758 \uacc4\uc88c\uc5d0\uc11c \ub3c8\uc740 \ube60\uc838\ub098\uac14\ub294\ub370 \ubc1b\ub294 \uc0ac\ub78c\uc758 \uacc4\uc88c\uc5d0 \ub3c8\uc774 \ub4e4\uc5b4\uc624\uc9c0 \uc54a\ub294 \uc77c\uc740 \uc5c6\uc5b4\uc57c \ud55c\ub2e4.  \\n- `Consistency`: transaction\uc774 \ub05d\ub0a0 \ub54c DB\uc758 \uc5ec\ub7ec \uc81c\uc57d \uc870\uac74\uc5d0 \ub9de\ub294 \uc0c1\ud0dc\ub97c \ubcf4\uc7a5\ud558\ub294 \uc131\uc9c8\uc774\ub2e4. \uc1a1\uae08\ud558\ub294 \uc0ac\ub78c\uc758 \uacc4\uc88c \uc794\uace0\uac00 0\ubcf4\ub2e4 \uc791\uc544\uc9c0\uba74 \uc548 \ub41c\ub2e4.  \\n- `Isolation`: transaction\uc774 \uc9c4\ud589\ub418\ub294 \uc911\uac04 \uc0c1\ud0dc\uc758 \ub370\uc774\ud130\ub97c \ub2e4\ub978 transaction\uc774 \ubcfc \uc218 \uc5c6\ub3c4\ub85d \ubcf4\uc7a5\ud558\ub294 \uc131\uc9c8\uc774\ub2e4. \uc1a1\uae08\ud558\ub294 \uc0ac\ub78c\uc758 \uacc4\uc88c\uc5d0\uc11c \ub3c8\uc740 \ube60\uc838\ub098\uac14\ub294\ub370 \ubc1b\ub294 \uc0ac\ub78c\uc758 \uacc4\uc88c\uc5d0 \ub3c8\uc774 \uc544\uc9c1 \ub4e4\uc5b4\uac00\uc9c0 \uc54a\uc740 DB \uc0c1\ud669\uc744 \ub2e4\ub978 transaction\uc774 \uc77d\uc73c\uba74 \uc548 \ub41c\ub2e4.  \\n- `Durability`: transaction\uc774 \uc131\uacf5\ud588\uc744 \uacbd\uc6b0 \ud574\ub2f9 \uacb0\uacfc\uac00 \uc601\uad6c\uc801\uc73c\ub85c \uc801\uc6a9\ub428\uc744 \ubcf4\uc7a5\ud558\ub294 \uc131\uc9c8\uc774\ub2e4. \ud55c \ubc88 \uc1a1\uae08\uc774 \uc131\uacf5\ud558\uba74 \uc740\ud589 \uc2dc\uc2a4\ud15c\uc5d0 \uc7a5\uc560\uac00 \ubc1c\uc0dd\ud558\ub354\ub77c\ub3c4 \uc1a1\uae08\uc774 \uc131\uacf5\ud55c \uc0c1\ud0dc\ub85c \ubcf5\uad6c\ud560 \uc218 \uc788\uc5b4\uc57c \ud55c\ub2e4.  \\n\\n:::note\ub3d9\uc2dc\uc131\\nACID\ub97c \ub192\uc774\uba74 \ub192\uc77c \uc218\ub85d \ub3d9\uc2dc\uc131\uc774 \ub5a8\uc5b4\uc9c4\ub2e4, \\n:::note\\n\\n### Read Uncommitted (Dirty Read)\\n\\n- \uc77c\ubc18\uc801\uc73c\ub85c \uac70\uc758 \uc0ac\uc6a9\ud558\uc9c0 \uc54a\ub294\ub2e4.  \\n- \ubcc0\uacbd \ub0b4\uc6a9\uc774 commit\uc774\ub098 Rollback \uc5ec\ubd80\uc5d0 \uc0c1\uad00 \uc5c6\uc774 \ub2e4\ub978 \ud2b8\ub79c\uc7ad\uc158\uc5d0\uac8c \ubcf4\uc5ec\uc900\ub2e4.  \\n- \uc5b4\ub5a4 \ud2b8\ub799\uc7ad\uc158\uc5d0\uc11c \ucc98\ub9ac\ud55c \uc791\uc5c5\uc774 \uc644\ub8cc\ub418\uc9c0 \uc54a\uc558\ub294\ub370\ub3c4 \ub2e4\ub978 \ud2b8\ub79c\uc7ad\uc158\uc5d0\uc11c \ubcfc \uc218 \uc788\uac8c \ub41c\ub2e4.  \\n- Dirty read\ub97c \uc720\ubc1c\ud55c\ub2e4.\\n\\n### Read Committed\\n\\n- Oracle Dbms\uc5d0\uc11c \uae30\ubcf8\uc801\uc73c\ub85c \uc0ac\uc6a9\ub418\uace0 \uc788\ub294 \uaca9\ub9ac \uc218\uc900(`Shared Lock`\uc744 \uc0ac\uc6a9\ud55c\ub2e4)\\n    - Shared Lock\\n        - \uc77c\ubc18\uc801\uc778 SELECT \ucffc\ub9ac\ub294 lock\uc744 \uc0ac\uc6a9\ud558\uc9c0 \uc54a\uace0 DB\ub97c \uc77d\uc5b4 \ub4e4\uc778\ub2e4. \ud558\uc9c0\ub9cc `SELECT ... FOR SHARE` \ub4f1 \uc77c\ubd80 SELECT \ucffc\ub9ac\ub294 read \uc791\uc5c5\uc744 \uc218\ud589\ud560 \ub54c DB\uac00 \uac01 row\uc5d0 Shared lock\uc744 \uac74\ub2e4.\\n- `Commit\uc774 \uc644\ub8cc\ub41c \ub370\uc774\ud130`\ub9cc \ub2e4\ub978 \ud2b8\ub79c\uc7ad\uc158\uc5d0\uc11c \uc870\ud68c \ud560 \uc218 \uc788\ub2e4.\\n- \uc5b4\ub5a4 \ud2b8\ub79c\uc7ad\uc158\uc5d0\uc11c \ucc98\ub9ac\ud55c \uc791\uc5c5\uc774 Commit\uc774 \uc548\ub418\uc5b4 \uc788\ub2e4\uba74 \ub2e4\ub978 \ud2b8\ub79c\uc7ad\uc158\uc740 undo \uc601\uc5ed\uc5d0 \uc788\ub294 \uae30\uc874 \uac12\uc744 \ucc38\uc870\ud574\uc11c \ubcf4\uc5ec\uc900\ub2e4.\\n- Non-repetable read\ub77c\ub294 \ubd80\uc815\ud569 \ubb38\uc81c \ubc1c\uc0dd \ud560 \uc218 \uc788\ub2e4.\\n    \\n:::note\\n`Repeatable read`: \ud558\ub098\uc758 \ud2b8\ub79c\uc7ad\uc158 \ub0b4\uc5d0\uc11c \ub3d9\uc77c select \ucffc\ub9ac\ub97c \uc2e4\ud589\ud588\uc744 \ub54c\ub294 \ud56d\uc0c1 \uac19\uc740 \uacb0\uacfc\uac00 \ub098\uc640\uc57c\ud55c\ub2e4\ub294 \uc815\ud569\uc131 \uc815\uc758\\n:::note>\\n\\n\ub3d9\uc77c Transaction1 \ub0b4\uc5d0\uc11c Select\ubb38\uc758 \uacb0\uacfc\uac12\uc744 \ubc1b\uace0 \uc791\uc5c5 \ub3c4\uc911 \ub9cc\uc57d \ub2e4\ub978 Transaciton2\uc5d0\uc11c insert \ub610\ub294 update\ub97c \ud588\ub2e4\uace0 \uac00\uc815 \ud588\uc744 \ub54c Transaction1\uc5d0\uc11c \uac19\uc740 select\uc5d0 \ub2e4\ub978 \uacb0\uacfc\uac12\uc774 \ubcf4\uc77c \uc218 \uc788\ub294 \ubb38\uc81c\uc774\ub2e4. \\n\\n\uae00\ub85c \uc124\uba85\ud558\uba74 \uc870\uae08 \ud587\uac08\ub9ac\ub294\ub370 \uadf8\ub9bc\uc73c\ub85c \ubcf4\uba74 \uc27d\ub2e4..\\n\\n\\n![[https://akasai.space/db/about_isolation/](https://akasai.space/db/about_isolation/)](./2022-05-24/Untitled.png)  \\n[https://akasai.space/db/about_isolation/](https://akasai.space/db/about_isolation/)\\n    \\n\\n### Repeatable Read\\n\\n- Mysql InnoDB\uc5d0\uc11c \uae30\ubcf8\uc801\uc73c\ub85c \uc0ac\uc6a9\ub418\ub294 \uaca9\ub9ac \uc218\uc900(Shared Lock\uc744 \uc0ac\uc6a9\ud55c\ub2e4)\\n- Non-repetable read\ub77c\ub294 \ubd80\uc815\ud569 \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud558\uc9c0 \uc54a\ub294\ub2e4.\\n- Undo \uacf5\uac04\uc5d0 \ubc31\uc5c5\ud574\ub450\uace0 \uc2e4\uc81c \ub808\ucf54\ub4dc \uac12\uc744 \ubcc0\uacbd\ud55c\ub2e4.\\n- \uc5b8\ub450 \uc601\uc5ed\uc5d0 \ubc31\uc5c5\ub41c \ub808\ucf54\ub4dc\uc758 \uc5ec\ub7ec \ubc84\uc804 \uac00\uc6b4\ub370 \uba87 \ubc88\uc9f8 \uc774\uc804 \ubc84\uc804\uae4c\uc9c0 \ucc3e\uc544 \ub4e4\uc5b4\uac00\uc57c \ud558\ub294\uc9c0\uc5d0 \uc788\ub2e4. Undo \uc601\uc5ed\uc5d0\uc11c \ud2b9\uc815 \ud2b8\ub79c\uc7ad\uc158 \ubc88\ud638\uc758 \uad6c\uac04 \ub0b4\uc5d0\uc11c \ubc31\uc5c5\ub41c \ub370\uc774\ud130\ub97c \ubcf4\uc5ec\uc900\ub2e4. \ud558\uc9c0\ub9cc \ud2b8\ub79c\uc7ad\uc158\uc744 \uc885\ub8cc\ud558\uc9c0 \uc54a\uc73c\uba74 \ubb34\ud55c\uc815\uc73c\ub85c \uc5b8\ub450 \uc601\uc5ed\uc774 \ucee4\uc9c8 \uc218 \uc788\uc5b4\uc11c \uc131\ub2a5 \ud558\ub77d\uc774 \ub420 \uc218 \uc788\uc74c.\\n    \\n![[https://www.cyber.pe.kr/2016/11/mysql-innodb-type.html](https://www.cyber.pe.kr/2016/11/mysql-innodb-type.html)](./2022-05-24/Untitled%201.png)  \\n[https://www.cyber.pe.kr/2016/11/mysql-innodb-type.html](https://www.cyber.pe.kr/2016/11/mysql-innodb-type.html)\\n\\n1. \uc2dc\uc2a4\ud15c \ud14c\uc774\ube14 \uc601\uc5ed\\n    - DB\uc758 \uc2dc\uc2a4\ud15c\uc774 \uc0dd\uc131\ud55c \uc601\uc5ed\uc774\ub2e4. \uc0ac\uc6a9\uc790\uac00 \uc0dd\uc131\ud55c \ub370\uc774\ud130\ubca0\uc774\uc2a4\uc640 \ud14c\uc774\ube14, \ud14c\uc774\ube14\uc5d0 \ub300\ud55c \uba54\ud0c0 \uc815\ubcf4 \ub4f1\uc744 \uc815\ub9ac\ud558\uc5ec \uad00\ub9ac\ud55c\ub2e4.\\n2. \ud2b8\ub79c\uc7ad\uc158 \uc601\uc5ed\\n    - DB\uac00 \ucffc\ub9ac\ub97c \ucc98\ub9ac\ud558\ub294 \uacfc\uc815\uc5d0\uc11c \uc2dc\uc2a4\ud15c \uc0c1\uc758 \uc624\ub958\uac00 \ubc1c\uc0dd\ud560 \uacbd\uc6b0 \uc6d0\uc0c1\ud0dc\ub85c \ubcf5\uad6c\ud558\uae30 \uc704\ud574 \ucffc\ub9ac \ucc98\ub9ac \uc774\uc804\uc758 \ub370\uc774\ud130\ub97c \ubcf4\uad00\ud558\ub294 \uc601\uc5ed\uc774\ub2e4.\\n3. \ub370\uc774\ud130 \uc601\uc5ed\\n    - \uc2e4\uc81c \ub370\uc774\ud130\uac00 \uc800\uc7a5\ub418\ub294 \uc601\uc5ed\uc73c\ub85c, DB \uc0ac\uc6a9\uc790\uac00 \uc800\uc7a5\ud55c \ubaa8\ub4e0 \ub370\uc774\ud130\ub294 \uc774 \uc601\uc5ed\uc5d0 \uc800\uc7a5\ub41c\ub2e4. \uc774 \uc601\uc5ed\uc5d0\uc11c\ub294 DB\uc758 \uc131\ub2a5\uc744 \uc720\uc9c0\ud558\uae30 \uc704\ud574 \ub370\uc774\ud130 \uc0ad\uc81c \uc2dc, \uc644\uc804 \uc0ad\uc81c \ub300\uc2e0 \ub370\uc774\ud130\uac00 \uc0ad\uc81c\ub41c \uac83\uc73c\ub85c \ud45c\uc2dc\ub9cc \ud558\uace0 \uc0ad\uc81c \uc601\uc5ed\uc5d0 \ub370\uc774\ud130\ub97c \uadf8\ub300\ub85c \uc720\uc9c0\ud55c\ub2e4. \uc774 \uac19\uc740 \ud2b9\uc9d5 \ub54c\ubb38\uc5d0 \uc0ad\uc81c\ub41c \ub370\uc774\ud130\uc758 \ubcf5\uad6c\uac00 \uac00\ub2a5\ud558\ub2e4.\\n    \\n\\n### Serializable\\n\\n- \ub3d9\uc2dc\uc131\uc774 \uc911\uc694\ud55c DB\uc5d0\uc11c\ub294 \uac70\uc758 \uc0ac\uc6a9\ud558\uc9c0 \uc54a\ub294\ub2e4.\\n- \uc77d\uae30 \uc791\uc5c5\ub3c4 \uacf5\uc720 \uc7a0\uae08\uc744 \ud68d\ub4dd \ud574\uc57c \ud558\uba70 \ub3d9\uc2dc\uc5d0 \ub2e4\ub978 \ud2b8\ub79c\uc7ad\uc158\uc740 \uadf8\ub7ec\ud55c \ub808\ucf54\ub4dc\ub97c \ubcc0\uacbd\ud558\uc9c0 \ubabb\ud55c\ub2e4.\\n- \ud55c \ud2b8\ub79c\uc7ad\uc158\uc5d0\uc11c \uc77d\uace0 \uc4f0\ub294 \ub808\ucf54\ub4dc\ub97c \ub2e4\ub978 \ud2b8\ub79c\uc7ad\uc158\uc5d0\uc11c\ub294 \uc811\uadfc \ubd88\uac00\ud558\ub2e4\\n\\n\ucc38\uace0  \\n[https://suhwan.dev/2019/06/09/transaction-isolation-level-and-lock/](https://suhwan.dev/2019/06/09/transaction-isolation-level-and-lock/) - gap lock, record lock \ub4f1 \uaca9\ub9ac \ub808\ubca8\ubcc4 \uc124\uba85\uc774 \uc790\uc138\ud558\ub2e4.  \\n[https://www.cyber.pe.kr/2016/11/mysql-innodb-type.html](https://www.cyber.pe.kr/2016/11/mysql-innodb-type.html)  \\n[RealMysql](http://www.kyobobook.co.kr/product/detailViewKor.laf?mallGb=KOR&ejkGb=KOR&barcode=9791158392703)"},{"id":"rebalnace","metadata":{"permalink":"/rebalnace","editUrl":"https://github.com/facebook/docusaurus/edit/main/website/blog/2022-05-17-Spring-Kafka-Rebalancing.md","source":"@site/blog/2022-05-17-Spring-Kafka-Rebalancing.md","title":"Spring Kafka Rebalancing \ucc98\ub9ac \ud574\ubcf4\uae30","description":"\uce74\ud504\uce74 \ub9ac\ubc38\ub7f0\uc2f1\uc774 \uc77c\uc5b4\ub098\ub294 \uacbd\uc6b0 \uc5b4\ub5bb\uac8c \ucc98\ub9ac","date":"2022-05-17T00:00:00.000Z","formattedDate":"May 17, 2022","tags":[{"label":"Kafka","permalink":"/tags/kafka"},{"label":"Spring Kafka","permalink":"/tags/spring-kafka"}],"readingTime":7.935,"truncated":true,"authors":[{"name":"Dongle","title":"Junior Backend Developer","url":"https://github.com/sk1737030","imageURL":"https://github.com/sk1737030.png","key":"dongle"}],"frontMatter":{"title":"Spring Kafka Rebalancing \ucc98\ub9ac \ud574\ubcf4\uae30","description":"\uce74\ud504\uce74 \ub9ac\ubc38\ub7f0\uc2f1\uc774 \uc77c\uc5b4\ub098\ub294 \uacbd\uc6b0 \uc5b4\ub5bb\uac8c \ucc98\ub9ac","slug":"rebalnace","authors":"dongle","tags":["Kafka","Spring Kafka"],"image":"https://i.imgur.com/mErPwqL.png","hide_table_of_contents":false},"prevItem":{"title":"DB transaction Isolation\uc5d0 \ub300\ud574\uc11c \uc54c\uc544\ubcf4\uc790","permalink":"/db-isolation"},"nextItem":{"title":"Spring Cloud Gateway Route \uc124\uc815\ud574\ubcf4\uae30","permalink":"/gateway"}},"content":"Kafka\ub97c \ud1b5\ud574 \uba54\uc2dc\uc9c0\ub97c \ubc1b\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uad6c\uc131\ud560 \ub54c \ud504\ub85c\ub355\uc158 \ud658\uacbd\uc5d0\uc11c\ub294 \uace0\ub824\ud574\uc57c \ud560 \uc5ec\ub7ec \uc0c1\ud669\uc774 \uc788\ub294\ub370 \uc9c0\uae08 \uc0dd\uac01\ub098\ub294 \ub300\ud45c\uc801\uc73c\ub85c \uba54\uc2dc\uc9c0\uc720\uc2e4, \uc911\ubcf5 \uba54\uc2dc\uc9c0 Consume, \ud655\uc7a5 \uac00\ub2a5\ud55c key \uc815\ud558\uae30, \uce74\ud504\uce74 \ub9ac\ubc38\ub7f0\uc2f1 \ub4f1 \uce74\ud504\uce74\ub97c \uc0ac\uc6a9\ud558\ub294\ub370 \ub9ce\uc740 \ud798\ub4e6\uc774 \ub9ce\uc774 \uc788\ub294\ub370, \uce74\ud504\uce74 \ub9ac\ubc38\ub7f0\uc2f1 \uc0c1\ud669\uc5d0\uc11c \uc6b0\ub9ac\uc758 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \ub2f9\ud669\ud558\uc9c0 \uc54a\uace0 \ucc98\ub9ac\ub97c \uc798 \ud560 \uc218 \uc788\ub294 \ubc29\ubc95\uc744 \uc18c\uac1c\ud574 \ubcf4\ub824\uace0 \ud55c\ub2e4.\\n\\n\x3c!--truncate--\x3e\\n\\n\\n[\ubaa8\ub4e0 \uc18c\uc2a4\ub294 \uc774\uacf3\uc5d0\uc11c](https://github.com/sk1737030/til/tree/master/kafka-repartitioning) \ud655\uc778 \uac00\ub2a5\ud569\ub2c8\ub2e4 :)\\n\\n## \uc2a4\ud504\ub9c1 \ubd80\ud2b8\uc5d0\uc11c Kafka Rebalancing \ucc98\ub9ac \ud574\ubcf4\uae30\\n\\nKafka\ub97c \ud1b5\ud574 \uba54\uc2dc\uc9c0\ub97c \ubc1b\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uad6c\uc131\ud560 \ub54c \ud504\ub85c\ub355\uc158 \ud658\uacbd\uc5d0\uc11c\ub294 \uace0\ub824\ud574\uc57c \ud560 \uc5ec\ub7ec \uc0c1\ud669\uc774 \uc788\ub294\ub370 \uc9c0\uae08 \uc0dd\uac01\ub098\ub294 \ub300\ud45c\uc801\uc73c\ub85c \uba54\uc2dc\uc9c0\uc720\uc2e4, \uc911\ubcf5 \uba54\uc2dc\uc9c0 Consume, \ud655\uc7a5 \uac00\ub2a5\ud55c key \uc815\ud558\uae30, \uce74\ud504\uce74 \ub9ac\ubc38\ub7f0\uc2f1 \ub4f1 \uce74\ud504\uce74\ub97c \uc0ac\uc6a9\ud558\ub294\ub370 \ub9ce\uc740 \ud798\ub4e6\uc774 \ub9ce\uc774 \uc788\ub294\ub370, \uce74\ud504\uce74 \ub9ac\ubc38\ub7f0\uc2f1 \uc0c1\ud669\uc5d0\uc11c \uc6b0\ub9ac\uc758 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \ub2f9\ud669\ud558\uc9c0 \uc54a\uace0 \ucc98\ub9ac\ub97c \uc798 \ud560 \uc218 \uc788\ub294 \ubc29\ubc95\uc744 \uc18c\uac1c\ud574 \ubcf4\ub824\uace0 \ud55c\ub2e4.\\n\\n\x3c!--truncate--\x3e\\n\\n### \uce74\ud504\uce74 \ub9ac\ubc38\ub7f0\uc2f1\uc774\ub780?\\n\\n\uba3c\uc800 \ub9ac\ubc38\ub7f0\uc2f1\uc774 \ubb54\uc9c0 \uc7a0\uae50 \uc54c\uc544\ubcf4\uace0 \uac04\ub2e4\uba74, Kafka \ud1a0\ud53d\uc744 \uad6c\uc131\ud560 \ub54c \ud55c \ud1a0\ud53d\uc744 \uc5ec\ub7ec \uac1c\uc758 Partitions\ub4e4\ub85c \uad6c\uc131\ud558\ub294 \uc77c\uc774 \ub9ce\uc740\ub370, \uc790\uc5f0\uc2a4\ub7fd\uac8c Consumer(`\uac19\uc740 Group.Id`)\ub3c4 \uc5ec\ub7ec \uac1c\ub85c \uad6c\uc131\uc774 \ub41c\ub2e4. \uc774\ub54c \uba54\uc2dc\uc9c0\ub97c Consume \ud558\ub294 \uc0c1\ud669\uc5d0\uc11c Consumer\uac00 \uc5ec\ub7ec \uac00\uc9c0 \uc0c1\ud669\uc73c\ub85c \uc778\ud558\uc5ec Broker\uc640 \uc5f0\uacb0\uc774 \ub04a\uc5b4\uc84c\uc744 \ub54c, \uc77c\uc5b4\ub098\ub294 \uac83\uc774 `\ub9ac\ubc38\ub7f0\uc2f1\uc778\ub370` \ubb38\uc81c\uc5c6\uc774 \uba54\uc2dc\uc9c0\ub97c \uc18c\ube44\ud558\uac8c \uc704\ud574\uc11c \ube0c\ub85c\ucee4\uac00 \uc7a5\uc560\uac00 \uc77c\uc5b4\ub0ac\ub2e4\uace0 \ud310\ub2e8\ud558\uace0 \uae30\uc874 Consumer\uc5d0 \ud560\ub2f9\ub418\uc5b4 \uc788\ub294 \ud30c\ud2f0\uc158\uc744 \ub2e4\ub978 Consumer\uc5d0 \uc7ac \ud560\ub2f9\ud558\ub294 \uac83\uc774\ub2e4. \\n\\n### \uadf8\ub807\ub2e4\uba74 \uaf2d \ub9ac\ubc38\ub7f0\uc2f1 \ucc98\ub9ac\ub97c \ud574\uc57c\ud560\uae4c?\\n\\n\uc774\uac74 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0\uc11c \uce74\ud504\uce74\ub97c \uc0ac\uc6a9\ud558\ub294 \uc774\uc720\uc5d0 \ub530\ub77c \ub2e4\ub978\ub370, \ub9cc\uc57d \ud1a0\ud53d\uc744 \ucee8\uc298 \ud560 \ub54c \ud2b9\uc815 key\ub97c \uae30\uc900\uc73c\ub85c \ucee8\uc298\uc744 \ud558\uace0 \uc788\ub2e4\uace0 \uc608\ub97c \ub4e4\uc5b4 \ubc30\ub2ec \uc8fc\ubb38\uc5d0 \ub300\ud574\uc11c \uce74\ud504\uce74\ub97c \uc0ac\uc6a9\ud55c\ub2e4\uace0 \ud558\uc600\uc744 \ub54c \ud1a0\ud53d\uc758 Key\ub97c \ud55c\uc2dd(0 \ubc88), \uc911\uc2dd(1 \ubc88), \uc591\uc2dd(2 \ubc88), \uc77c\uc2dd(3 \ubc88) \uc73c\ub85c (\uadf8\ub7f4 \ub9ac\ub294 \uc5c6\uaca0\uc9c0\ub9cc) \ud560 \uacbd\uc6b0, \ub9cc\uc57d \uc77c\uc2dd\uc744 \ucee8\uc298\ud558\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \uc5b4\ub5a0\ud55c \uc7a5\uc560\ub85c \ucee8\uc298\uc744 \ubabb\ud55c\ub2e4\uace0 \ud558\uc600\uc744 \ub54c, \uc77c\uc2dd(3 \ubc88)\uc758 \ud30c\ud2f0\uc158\uc774 \ud55c\uc2dd(0 \ubc88) \ud30c\ud2f0\uc158\uc73c\ub85c \ud560\ub2f9\ub418\uc5c8\uc744 \ub54c (\ub7f0\ud0c0\uc784\uc5d0) \ucc98\ub9ac\uac00 \ub530\ub85c \ud544\uc694\ud560 \uc218\uac00 \uc788\ub2e4. \ud55c\uc2dd\ub9cc \uac00\uc9c0\uace0 \uc788\ub294 \uba54\ub274 \uc815\ubcf4\ub97c \uc77c\uc2dd\uc744 \ud3ec\ud568\ud55c \uba54\ub274 \uc815\ubcf4\ub85c \ub2e4\uc2dc \ubd88\ub7ec\uc628\ub2e4\ub4e0\uc9c0, \uc544\ub2c8\uba74 \ub530\ub85c \uc54c\ub78c \ucc98\ub9ac\ub97c \ud55c\ub2e4\ub4e0\uc9c0 \ub0b4\ubd80 \uba54\ubaa8\ub9ac\uc5d0 \uac00\uc9c0\uace0 \uc788\ub294 \uc815\ubcf4\ub4e4\uc744 \ucd08\uae30\ud654 \uc791\uc5c5\uc774 \ud544\uc694\ud558\ub294 \ub4f1 \uc5ec\ub7ec \uac00\uc9c0 \ucc98\ub9ac\ud560 \uc218 \uc788\uae30 \ub54c\ubb38\uc5d0 \ub9ac\ubc38\ub7f0\uc2f1 \ucc98\ub9ac\ub294 \uce74\ud504\uce74\ub97c \uc0ac\uc6a9\ud558\ub294 \uc774\uc720\uc5d0 \ub530\ub77c \ub2ec\ub77c \ucc98\ub9ac \ud560 \uc218\ub3c4 \uc548 \ud574\ub3c4 \ub41c\ub2e4.\\n\\n### \ucf54\ub4dc\ub85c\\n\\n\ucf54\ub4dc\ub85c \ucc98\ub9ac\ud558\ub294 \ubd80\ubd84\uc740 \uc758\uc678\ub85c \uac04\ub2e8\ud55c\ub370 \uc77c\ub2e8 Spring Docs\uc5d0\uc11c \ud655\uc778\uc744 \ud574\ubcf8\ub2e4\uba74  \\n`Kafka\uc758 ConsumerRebalanceListener` \ub97c \uad6c\ud604\ud55c `ConsumerAwareRebalanceListener` \ub97c \uc0ac\uc6a9\ud558\uba74 \ub41c\ub2e4.\\n\\n```java\\npublic interface ConsumerAwareRebalanceListener extends ConsumerRebalanceListener {\\n ...\\n\\ndefault void onPartitionsRevokedBeforeCommit(Consumer<?, ?> consumer, Collection<TopicPartition> partitions) {\\n\\t\\ttry {\\n\\t\\t\\tonPartitionsRevoked(partitions);\\n\\t\\t}\\n\\t\\tcatch (Exception e) { // NOSONAR\\n\\t\\t\\tLOGGER.debug(e, \\"User method threw exception\\");\\n\\t\\t}\\n\\t}\\n\\n\\tdefault void onPartitionsRevokedAfterCommit(Consumer<?, ?> consumer, Collection<TopicPartition> partitions) {\\n\\t}\\n\\n\\tdefault void onPartitionsLost(Consumer<?, ?> consumer, Collection<TopicPartition> partitions) {\\n\\t\\ttry {\\n\\t\\t\\tonPartitionsLost(partitions);\\n\\t\\t}\\n\\t\\tcatch (Exception e) { // NOSONAR\\n\\t\\t\\tLOGGER.debug(e, \\"User method threw exception\\");\\n\\t\\t}\\n\\t}\\n\\n\\tdefault void onPartitionsAssigned(Consumer<?, ?> consumer, Collection<TopicPartition> partitions) {\\n\\t\\ttry {\\n\\t\\t\\tonPartitionsAssigned(partitions);\\n\\t\\t}\\n\\t\\tcatch (Exception e) { // NOSONAR\\n\\t\\t\\tLOGGER.debug(e, \\"User method threw exception\\");\\n\\t\\t}\\n\\t}\\n\\n\\t@Override\\n\\tdefault void onPartitionsRevoked(Collection<TopicPartition> partitions) {\\n\\t}\\n\\n\\t@Override\\n\\tdefault void onPartitionsAssigned(Collection<TopicPartition> partitions) {\\n\\t}\\n\\n\\t@Override\\n\\tdefault void onPartitionsLost(Collection<TopicPartition> partitions) {\\n\\t}\\n```\\n\\n`onPartitionsAssigned` \uc740 \ud30c\ud2f0\uc158 \uc7ac\ud560\ub2f9\uc774 \uc131\uacf5\uc801\uc73c\ub85c \uc644\ub8cc\ub420 \ub54c \ud638\ucd9c\ub41c\ub2e4.  \\n`onPartitionsRevoked` \uc740 \ud560\ub2f9\ub418\uc5b4 \uc788\ub358 \ud30c\ud2f0\uc158\uc774 \uc81c\uac70 \ub420 \ub54c \ud638\ucd9c\ub41c\ub2e4.  \\n`onPartitionsLost` \uc740  \uc77c\ubc18\uc801\uc778 \uc0c1\ud669\uc5d0\uc11c\ub294 \uc2e4\ud589\uc774 \uc548\ub418\ub098 \ub9cc\uc57d \ucee8\uc288\uba38\uc758 \uc138\uc158 \uc81c\ud55c \uc2dc\uac04\uc774 \ub9cc\ub8cc\ub418\uc5c8\uac70\ub098 \ucee8\uc288\uba38\uac00 \ub354 \uc774\uc0c1 \uadf8\ub8f9\uc5d0 \uc18d\ud558\uc9c0 \uc54a\uc74c\uc744 \ub098\ud0c0\ub0b4\ub294 \uce58\uba85\uc801\uc778 \uc624\ub958\uac00 \uc218\uc2e0\ub41c \uacbd\uc6b0 \ud638\ucd9c\ub41c\ub2e4.  \\n<br/>\\n\\n:::noteReBalancing\uc21c\uc11c\\n\ucc38\uace0\ub85c \uc77c\ubc18\uc801\uc778 \ud30c\ud2f0\uc158\uc774 \ud560\ub2f9\ub418\uace0 \uc798 \uc2e4\ud589\ub418\uace0 \uc788\ub294 \ub7f0\ud0c0\uc784 \ud658\uacbd\uc5d0\uc11c\ub294 \ub2f9\uc5f0\ud55c \ub9d0\uc774 \uaca0\uc9c0\ub9cc `PartitionsRevoke`\uac00 \uc2e4\ud589\ub41c \ud6c4 `PartitionsAssigned`\uac00 \uc2e4\ud589\ub41c\ub2e4. \ubc18\uba74 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \uc2e4\ud589 \ub420 \ub54c\uc5d0\ub294 `PartitionsAssigned`\ub9cc \uc2e4\ud589\ub41c\ub2e4.\\n:::note\\n\\n<br/>\\n\uc6b0\ub9ac \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0\uc11c\ub294 Spring Kaka\uc5d0\uc11c \uc798 \uac10\uc2f8\uc11c \uc900 `ConsumerAwareRebalanceListener` \uc0c1\uc18d \ubc1b\uc544\uc11c \uc0ac\uc6a9\ud558\uba74 \ub41c\ub2e4.  \\n\\n\\n```java\\n@Component\\npublic class MyListener implements ConsumerAwareRebalanceListener {\\n\\n  @Override\\n  public void onPartitionsAssigned(Consumer<?, ?> consumer, Collection<TopicPartition> partitions) {\\n      ConsumerAwareRebalanceListener.super.onPartitionsAssigned(consumer, partitions);\\n      System.out.println(\\"onPartitionsAssigned\\");\\n      partitions.forEach(topicPartition -> System.out.println(topicPartition.partition()));\\n  }\\n\\n  @Override\\n  public void onPartitionsLost(Consumer<?, ?> consumer, Collection<TopicPartition> partitions) {\\n      ConsumerAwareRebalanceListener.super.onPartitionsLost(consumer, partitions);\\n      System.out.println(\\"onPartitionsLost\\");\\n  }\\n\\n  @Override\\n  public void onPartitionsRevoked(Collection<TopicPartition> partitions) {\\n      ConsumerAwareRebalanceListener.super.onPartitionsRevoked(partitions);\\n      System.out.println(\\"onPartitionsRevoked\\");\\n  }\\n}\\n```\\n\\n`consumer` \uc5d0\ub294 `Consumer`\uc5d0  \uc5ec\ub7ec \uc815\ubcf4\ub4e4\uc744 \ubcfc \uc218 \uc788\ub2e4.  \\n`partitions` \ud30c\ub77c\ubbf8\ud130\ub85c \ud604\uc7ac \ud560\ub2f9 \ub41c \ubaa9\ub85d\uc744 \uc778\uc790\ub85c \uc900\ub2e4.  \\n\\n![Untitled](./2022-05-17/Untitled.png)\\n\\n### \ub290\ub080\uc810\\n\\n\uc9c4\uc9dc \uce74\ud504\uce74 \ub108\ubb34 \uc5b4\ub835\ub2e4. \ud2b9\ud788 \uce74\ud504\uce74\uc5d0 \uc758\uc874\uc131\uc774 \ub192\uc73c\uba74 \ub192\uc744\uc218\ub85d \ub09c\ub3c4\uac00 \uc62c\ub77c\uac00\ub294 \uac70 \uac19\ub2e4. \uc0dd\uac01 \ud574 \ubcfc \ubd80\ubd84\ub4e4\uc774 \ub9ce\uc740\ub370, \uce74\ud504\uce74\uc758 \uba54\uc2dc\uc9c0\ub97c produce\ud560 \ub54c \uc720\uc2e4\uc774 \ub098\uba74 \uc548 \ub418\ub294 \uc11c\ube44\uc2a4\uc778\ub370 \uc5b4\ub5bb\uac8c \ube60\ub974\uba74\uc11c \uba54\uc2dc\uc9c0\uac00 \uc720\uc2e4\ub418\uc9c0 \uc54a\uc744\uae4c\ub97c \uace0\ub824 \ud55c\ub2e4\ub4e0\uc9c0, \ud1a0\ud53d\uc758 key\ub97c \uc5b4\ub5a4 key\ub85c \uc124\uc815\ud558\ub0d0\uc5d0 \ud655\uc815\uc131\uc774 \uc788\uace0 \uba54\uc2dc\uc9c0\uac00 \uc798 \ubd84\ubc30 \ub420 \ub54c\ub77c\ub358\uc9c0, \ub9ac\ud30c\ud2f0\ub2c8\uc154\ub2dd \uc0c1\ud669\uc5d0\uc11c\uc758 \uc11c\ube44\uc2a4\uac00 \ubb38\uc81c\uac00 \uc5c6\uc744\uae4c \uba54\uc138\uc9c0\ub97c \uc911\ubcf5\uc73c\ub85c \uc77d\uc744 \uacbd\uc6b0\ub294 \uc5c6\uc744 \uac70\ub77c\ub4e0\uc9c0, \uc911\ubcf5\uc73c\ub85c \uba54\uc2dc\uc9c0\ub97c \ucee8\uc298 \ud560 \uacbd\uc6b0\ub3c4 \uc788\ub294\ub370 \uc774\ub54c\ub294 \uc5b4\ub5bb\uac8c \ucc98\ub9ac \ud574\uc57c \ud560\uae4c \ub4f1\ub4f1 \uc815\ub9d0 \uce74\ud504\uce74 \uc5b4\ub835\ub2e4. \uadf8\ub7f0\ub370 \ub9c9\uc0c1 \uc774\ub7f0 \uac78 \ud558\ub098\ud558\ub098 \ud574\uacb0 \ud574\uc11c \uc11c\ube44\uc2a4\uac00 \uc7a5\uc560 \uc5c6\uace0 \uc6b0\uc544\ud558\uac8c \uc798 \ub3cc\uc544\uac00\ub294 \uac78 \ud560 \uc218 \uc788\ub2e4\uba74 \uc5bc\ub9c8\ub098 \ub9db\uc774 \uc788\uc744\uae4c? \uadf8\ub7f0 \uc0c1\uc0c1\uc744 \ud558\uba74\uc11c ~~\uc57c-\uadfc\uc744 \ud55c\ub2e4.~~\\n\\n \\n\\n![Untitled](./2022-05-17/Untitled%201.png)\\n\\n\ucc38\uace0  \\n[https://developer.confluent.io/learn-kafka/apache-kafka/partitions/](https://developer.confluent.io/learn-kafka/apache-kafka/partitions/)  \\n[https://www.popit.kr/kafka-consumer-group/](https://www.popit.kr/kafka-consumer-group/)  \\n[group id\uc640 consume id \ucc28\uc774](https://stackoverflow.com/questions/34550873/difference-between-groupid-and-consumerid-in-kafka-consumer)  \\n[\uc2a4\ud504\ub9c1 Kafka Docs](https://docs.spring.io/spring-kafka/docs/2.5.17.RELEASE/reference/html/)  \\n[ConsumerRebalanceListener\uc124\uba85](https://kafka.apache.org/25/javadoc/org/apache/kafka/clients/consumer/ConsumerRebalanceListener.html#onPartitionsLost-java.util.Collection-)"},{"id":"gateway","metadata":{"permalink":"/gateway","editUrl":"https://github.com/facebook/docusaurus/edit/main/website/blog/2022-05-08-Spring-Cloud-Gateway-Route.md","source":"@site/blog/2022-05-08-Spring-Cloud-Gateway-Route.md","title":"Spring Cloud Gateway Route \uc124\uc815\ud574\ubcf4\uae30","description":"\uc2a4\ud504\ub9c1 \uac8c\uc774\ud2b8\uc6e8\uc774 Route \uae4c\ubcf4\uae30","date":"2022-05-08T00:00:00.000Z","formattedDate":"May 8, 2022","tags":[{"label":"SCG","permalink":"/tags/scg"},{"label":"Spring Cloud Gateway","permalink":"/tags/spring-cloud-gateway"},{"label":"Route","permalink":"/tags/route"}],"readingTime":6.34,"truncated":true,"authors":[{"name":"Dongle","title":"Junior Backend Developer","url":"https://github.com/sk1737030","imageURL":"https://github.com/sk1737030.png","key":"dongle"}],"frontMatter":{"title":"Spring Cloud Gateway Route \uc124\uc815\ud574\ubcf4\uae30","description":"\uc2a4\ud504\ub9c1 \uac8c\uc774\ud2b8\uc6e8\uc774 Route \uae4c\ubcf4\uae30","slug":"gateway","authors":"dongle","tags":["SCG","Spring Cloud Gateway","Route"],"image":"https://i.imgur.com/mErPwqL.png","hide_table_of_contents":false},"prevItem":{"title":"Spring Kafka Rebalancing \ucc98\ub9ac \ud574\ubcf4\uae30","permalink":"/rebalnace"},"nextItem":{"title":"\uae4c\uba39\uc5b4\uc11c \ub2e4\uc2dc \ubcf4\ub294 Generic","permalink":"/generic"}},"content":"Spring gateway\uc744 \uc0ac\uc6a9\ud560 \ub54c \uc77c\ubc18\uc801\uc73c\ub85c 2\uac00\uc9c0 \ubc29\uc2dd\uc73c\ub85c route \uc124\uc815\uc744 \ud560 \uc218 \uc788\ub294\ub370 \uc5b4\ub5a4\uac8c \ub354 \uc88b\uc744\uae4c?\\n\x3c!--truncate--\x3e\\n\ubaa8\ub4e0 \uc18c\uc2a4\ub294 [\uc774\uacf3](https://github.com/sk1737030/til/tree/master/spring-cloud-gateway)\uc5d0\uc11c \ud655\uc778 \uac00\ub2a5\ud569\ub2c8\ub2e4:)\\n\\n## Spring Gateway Route\\nSpring gateway\uc744 \uc0ac\uc6a9\ud560 \ub54c \uc77c\ubc18\uc801\uc73c\ub85c 2\uac00\uc9c0 \ubc29\uc2dd\uc73c\ub85c route \uc124\uc815\uc744 \ud560 \uc218 \uc788\ub2e4.\\n\\n\\n### Yaml\\n\\n```yaml\\nspring: \\n\\tcloud:\\n    gateway:\\n      globalcors:\\n        corsConfigurations:\\n          \'[/**]\':\\n            allowedOrigins: \'*\'\\n            allowedMethods:\\n              - POST\\n              - GET\\n              - PUT\\n              - OPTIONS\\n              - DELETE\\n      routes:\\n        - id: a-service\\n          uri: http://localhost:18081\\n          predicates:\\n            - Path=/aservice/**\\n        - id: b-service\\n          uri: http://localhost:18082\\n          predicates:\\n            - Path=/bservice/**\\n```\\n\\n```verilog\\n2022-02-19 18:07:46.827 DEBUG 33218 --- [  restartedMain] o.s.c.gateway.config.GatewayProperties   : Routes supplied from Gateway Properties: [RouteDefinition{id=\'a-service\', predicates=[PredicateDefinition{name=\'Path\', args={_genkey_0=/aservice/**}}], filters=[], uri=http://localhost:18081, order=0, metadata={}}, RouteDefinition{id=\'b-service\', predicates=[PredicateDefinition{name=\'Path\', args={_genkey_0=/bservice/**}}], filters=[], uri=http://localhost:18082, order=0, metadata={}}]\\n```\\n\\n### Java\\n\\n```java\\nimport org.springframework.cloud.gateway.route.RouteLocator;\\nimport org.springframework.cloud.gateway.route.builder.RouteLocatorBuilder;\\nimport org.springframework.context.annotation.Bean;\\nimport org.springframework.context.annotation.Configuration;\\n\\n@Configuration\\npublic class RouteConfig {\\n\\n    @Bean\\n    public RouteLocator bRoue(RouteLocatorBuilder builder) {\\n        return builder.routes()\\n            .route(\\"q-service\\", r -> r.path(\\"/q-service/**\\")\\n                .uri(\\"http://localhost:18081\\"))\\n            .route(\\"q-service\\", r -> r.path(\\"/w-service/**\\")\\n                .uri(\\"http://localhost:18080\\"))\\n            .build();\\n    }\\n\\n    @Bean\\n    public RouteLocator cRoute(RouteLocatorBuilder builder) {\\n        return builder.routes()\\n            .route(\\"c-service\\", r -> r.path(\\"/c-service/**\\")\\n                .uri(\\"http://localhost:18081\\"))\\n            .route(\\"d-service\\", r -> r.path(\\"/d-service/**\\")\\n                .uri(\\"http://localhost:18080\\"))\\n            .build();\\n    }\\n}\\n```\\n\\n\ub77c\uc6b0\ud2b8\ub4e4\uc744 \ub098\ub220\uc11c \uc124\uc815\ud560 \uc218 \uc788\ub2e4. \uadf8\ub807\ub2e4\uba74 \ub530\ub85c \uc124\uc815\ud55c \ub77c\uc6b0\ud130\ub4e4\uc774 \uc5b4\ub5bb\uac8c \uac19\uc774 \ud569\uccd0\uc838\uc11c \uc791\ub3d9\ud558\ub294 \uac83 \uc77c\uae4c?\\n\\nRoute \uad6c\uc131\ub3c4  \\n![[https://zhuanlan.zhihu.com/p/359523303](https://zhuanlan.zhihu.com/p/359523303)](2022-05-08/Untitled.png)  \\n\\n[https://zhuanlan.zhihu.com/p/359523303](https://zhuanlan.zhihu.com/p/359523303)  \\n\\n\uc77c\ub2e8 \uba3c\uc800 \ubd10\uc57c\ud560 \uac83\uc740 `RouteDefinationLocator`\uc774\ub2e4.\\n\\n### RouteDefinationLocator\\n```java\\npublic interface RouteDefinitionLocator {\\n\\tFlux<RouteDefinition> getRouteDefinitions();\\n}\\n```\\n\\n`RouteDefinationLocator`\uc744 \uad6c\ud604\ud55c \uac1d\uccb4\ub4e4\uc740 5\uac1c\uac00 \uc788\ub2e4.  \\n1. `CachingRouteDefinitionLocator`\\n2. `CompositeRouteDefinitionLocator`\\n3. `DiscoveryClientRouteDefinitionLocator`\\n4. `PropertiesRouteDefinitionLocator` \\n5. `RouteDefinitionRepository`\\n\\n### DiscoveryClientRouteDefinitionLocator\\nService Discovery(Netflix Eureka, Consul, or Zookeeper)\uc640 \uc5f0\ub3d9\ud558\uc5ec \ub4f1\ub85d\ub41c \uc11c\ube44\uc2a4\ub4e4\uc744 \uae30\uc900\uc73c\ub85c \uacbd\ub85c\ub97c \ub9cc\ub4e0\ub2e4.\\n\\n### PropertiesRouteDefinitionLocator  \\nYaml\uc5d0 \uc124\uc815\ud55c property value\ub4e4\uc774 **GateWayProperty** \uc9c1\ub82c\ud654\ub418\uc5b4 \uac12\uc774 \ub4e4\uc5b4\uac00\uace0  \\n\\n```java\\npublic class PropertiesRouteDefinitionLocator implements RouteDefinitionLocator {\\n\\n\\tprivate final GatewayProperties properties;\\n\\n\\tpublic PropertiesRouteDefinitionLocator(GatewayProperties properties) {\\n\\t\\tthis.properties = properties;\\n\\t}\\n\\n\\t@Override\\n\\tpublic Flux<RouteDefinition> getRouteDefinitions() {\\n\\t\\treturn Flux.fromIterable(this.properties.getRoutes());\\n\\t}\\n\\n}\\n```\\n\\n![Untitled](2022-05-08/Untitled%201.png)\\n\\nGatewayProperty \uac12\uc740 **PropertiesRouteDefinitionLocator \uc5d0 \uc4f0\uc774\uac8c \ub41c\ub2e4.**  \\n\\n![Untitled](2022-05-08/Untitled%202.png)\\n\\n### **CompositeRouteDefinitionLocator**\\n[\uc790\ubc14 DSL](https://docs.spring.io/spring-integration/reference/html/dsl.html)(\ud3b8\ub9ac\ud558\uac8c fluent API\ub97c \uc9c0\uc6d0)\ub85c \uc124\uc815\ud55c \ub77c\uc6b0\ud130\ub4e4\uc758 \uac12\uc774 \ub4e4\uc5b4\uac00 \uc788\uace0  \\n\\n![Untitled](2022-05-08/Untitled%203.png)  \\n\\n`CompositeRouteDefinitionLocator`\uc5d0\uc11c **PropertiesRouteDefinitionLocator\uc5d0\uc11c** \uc124\uc815\ud55c \ub77c\uc6b0\ud130\ub4e4\uc5d0 id\uac00 \uc5c6\uc744 \uacbd\uc6b0 randid\uac00 \ub4e4\uc5b4\uac00\uac8c \ub41c\ub2e4.  \\n\\n```java\\npublic class CompositeRouteDefinitionLocator implements RouteDefinitionLocator {\\n...\\n\\t@Override\\n\\tpublic Flux<RouteDefinition> getRouteDefinitions() {\\n\\t\\treturn this.delegates.flatMapSequential(RouteDefinitionLocator::getRouteDefinitions)\\n\\t\\t\\t\\t.flatMap(routeDefinition -> {\\n\\t\\t\\t\\t\\tif (routeDefinition.getId() == null) {\\n\\t\\t\\t\\t\\t\\treturn randomId().map(id -> {\\n\\t\\t\\t\\t\\t\\t\\trouteDefinition.setId(id);\\n\\t\\t\\t\\t\\t\\t\\tif (log.isDebugEnabled()) {\\n\\t\\t\\t\\t\\t\\t\\t\\tlog.debug(\\"Id set on route definition: \\" + routeDefinition);\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t\\treturn routeDefinition;\\n\\t\\t\\t\\t\\t\\t});\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\treturn Mono.just(routeDefinition);\\n\\t\\t\\t\\t});\\n\\t}\\n}\\n```\\n\\n### RouteDefinitionRouteLocator\\n\\nRoute\ub4e4\uc744 key\ub97c \uae30\uc900\uc73c\ub85c \ud655\uc778 \ud6c4\uc5d0 `RoutePredicateFactory`\uc5d0 \uc9d1\uc5b4\ub123\ub294\ub2e4.  \\n\\n```java\\npublic class RouteDefinitionRouteLocator implements RouteLocator {\\n\\t\\n\\t...\\n\\n\\tpublic RouteDefinitionRouteLocator(RouteDefinitionLocator routeDefinitionLocator,\\n\\t\\t\\tList<RoutePredicateFactory> predicates, List<GatewayFilterFactory> gatewayFilterFactories,\\n\\t\\t\\tGatewayProperties gatewayProperties, ConfigurationService configurationService) {\\n\\t\\tthis.routeDefinitionLocator = routeDefinitionLocator;\\n\\t\\tthis.configurationService = configurationService;\\n\\t\\tinitFactories(predicates);\\n\\t\\tgatewayFilterFactories.forEach(factory -> this.gatewayFilterFactories.put(factory.name(), factory));\\n\\t\\tthis.gatewayProperties = gatewayProperties;\\n\\t}\\n\\n\\t// RoutePredicateFactory \uac80\uc0ac\\n\\tprivate void initFactories(List<RoutePredicateFactory> predicates) {\\n\\t\\tpredicates.forEach(factory -> {\\n\\t\\t\\tString key = factory.name();\\n\\t\\t\\tif (this.predicates.containsKey(key)) {\\n\\t\\t\\t\\tthis.logger.warn(\\"A RoutePredicateFactory named \\" + key + \\" already exists, class: \\"\\n\\t\\t\\t\\t\\t\\t+ this.predicates.get(key) + \\". It will be overwritten.\\");\\n\\t\\t\\t}\\n\\t\\t\\tthis.predicates.put(key, factory);\\n\\t\\t\\tif (logger.isInfoEnabled()) {\\n\\t\\t\\t\\tlogger.info(\\"Loaded RoutePredicateFactory [\\" + key + \\"]\\");\\n\\t\\t\\t}\\n\\t\\t});\\n\\t}\\n\\n\\tpublic Flux<Route> getRoutes() {\\n\\t\\tFlux<Route> routes = this.routeDefinitionLocator.getRouteDefinitions().map(this::convertToRoute);\\n\\n\\t\\tif (!gatewayProperties.isFailOnRouteDefinitionError()) {\\n\\t\\t\\t// instead of letting error bubble up, continue\\n\\t\\t\\troutes = routes.onErrorContinue((error, obj) -> {\\n\\t\\t\\t\\tif (logger.isWarnEnabled()) {\\n\\t\\t\\t\\t\\tlogger.warn(\\"RouteDefinition id \\" + ((RouteDefinition) obj).getId()\\n\\t\\t\\t\\t\\t\\t\\t+ \\" will be ignored. Definition has invalid configs, \\" + error.getMessage());\\n\\t\\t\\t\\t}\\n\\t\\t\\t});\\n\\t\\t}\\n\\n\\t\\treturn routes.map(route -> {\\n\\t\\t\\tif (logger.isDebugEnabled()) {\\n\\t\\t\\t\\tlogger.debug(\\"RouteDefinition matched: \\" + route.getId());\\n\\t\\t\\t}\\n\\t\\t\\treturn route;\\n\\t\\t});\\n\\t}\\n  ...\\n}\\n```\\n\\n### CompositeRouteLocator\\n\\n\uc5ec\ub7ec \uac1c\uc758 `RouteLocator` \ub4e4\uc740 delegates\ub97c \uac00\uc9c0\uace0, \uac01 RouteLocator\ub4e4\uc774 \uac00\uc9c0\uace0 \uc788\ub294 Route\ub4e4\uc744 \ud558\ub098\ub85c \ud569\uce5c\ub2e4.\\n\\n```java\\npublic class CompositeRouteLocator implements RouteLocator {\\n\\n\\tprivate final Flux<RouteLocator> delegates;\\n\\n\\tpublic CompositeRouteLocator(Flux<RouteLocator> delegates) {\\n\\t\\tthis.delegates = delegates;\\n\\t}\\n\\n\\t@Override\\n\\tpublic Flux<Route> getRoutes() {\\n\\t\\treturn this.delegates.flatMapSequential(RouteLocator::getRoutes);\\n\\t}\\n```\\n\\n![this.deligates \uc548\uc5d0 \uc124\uc815\ud55c route\ub4e4\uc774 \ub2f4\uaca8\uc788\ub294 \uac83\uc744 \ubcfc \uc218 \uc788\ub2e4.](2022-05-08/Untitled%204.png)\\n\\nthis.deligates \uc548\uc5d0 \uc124\uc815\ud55c route\ub4e4\uc774 \ub2f4\uaca8\uc788\ub294 \uac83\uc744 \ubcfc \uc218 \uc788\ub2e4.\\n\\n### CachingRouteLocator\\n\\ndeletgate\ub4e4\uc744 \ubc1b\uc544 \uce90\uc2dc\uc5d0 \uc800\uc7a5\ud574\uc11c route\ub4e4\uc744 \uac00\uc9c4\ub2e4.\\n\\n```java\\npublic class CachingRouteLocator implements Ordered, RouteLocator, ApplicationListener<RefreshRoutesEvent>, ApplicationEventPublisherAware {\\n\\n\\tprivate final Map<String, List> cache = new ConcurrentHashMap<>();\\n\\n\\tpublic CachingRouteLocator(RouteLocator delegate) {\\n\\t\\tthis.delegate = delegate;\\n\\t\\troutes = CacheFlux.lookup(cache, CACHE_KEY, Route.class).onCacheMissResume(this::fetch);\\n\\t}\\n\\n\\tprivate Flux<Route> fetch() {\\n\\t\\treturn this.delegate.getRoutes().sort(AnnotationAwareOrderComparator.INSTANCE);\\n\\t}\\n  \\n}\\n```\\n\\nCache\uc5d0 Route\ub4e4\uc774 \ub2f4\uae30\uac8c \ub41c\ub2e4.\\n\\n![Untitled](2022-05-08/Untitled%205.png)\\n\\n \\n\\n### \uadf8\ub9ac\uace0 \ub9c8\uc9c0\ub9c9\uc73c\ub85c \ucd5c\ucd08 \uc2dc\uc791\uc810\uc778 GatewayAutoConfiguration\\n\\nGateway\uc758 Route \ub4f1 \uac01\uc885 config\ub4e4\uc744 \uc124\uc815\ud55c\ub2e4.\\n\\n```java\\n@Configuration(proxyBeanMethods = false)\\n@ConditionalOnProperty(name = \\"spring.cloud.gateway.enabled\\", matchIfMissing = true)\\n@EnableConfigurationProperties\\n@AutoConfigureBefore({ HttpHandlerAutoConfiguration.class, WebFluxAutoConfiguration.class })\\n@AutoConfigureAfter({ GatewayReactiveLoadBalancerClientAutoConfiguration.class,\\n\\t\\tGatewayClassPathWarningAutoConfiguration.class })\\n@ConditionalOnClass(DispatcherHandler.class)\\npublic class GatewayAutoConfiguration {\\n   \\n  ...\\n\\t\\n\\n\\t@Bean\\n\\t@Primary\\n\\t@ConditionalOnMissingBean(name = \\"cachedCompositeRouteLocator\\")\\n\\tpublic RouteLocator cachedCompositeRouteLocator(List<RouteLocator> routeLocators) {\\n\\t\\treturn new **CachingRouteLocator**(new CompositeRouteLocator(Flux.fromIterable(routeLocators)));\\n\\t}\\n   ...\\n}\\n```\\n\\n`cachedCompositeRouteLocator` \uc124\uc815\ud55c roteLocator(java, yaml)\ub4e4\uc774 \ub2f4\uae30\uac8c \ub41c\ub2e4. \\n\\n![Untitled](2022-05-08/Untitled%206.png)\\n\\n### \uacb0\ub860  \\n\uac1c\uc778\uc801\uc73c\ub85c\ub294 yaml\uc73c\ub85c \uc124\uc815\ud558\uae30\ubcf4\ub2e4\ub294 **Java Config**\ub85c \uc124\uc815\ud558\ub294 \uac8c \uc88b\ub2e4\uace0 \ubd05\ub2c8\ub2e4.  \\nYaml \uc124\uc815\ud558\uba74 \uac04\ub2e8\ud558\uac8c \uc124\uc815 \ud560 \uc218 \uc788\ub294 \ubc18\uba74\uc5d0, IDE\uc758 \ub3c4\uc6c0\uc744 \ubc1b\uae30 \ud798\ub4e4\uace0, \uc624\ud0c0, yaml \ub77c\uc778\uc774 \ub2e4\ub978 \uacbd\uc6b0\ub098 yaml \ubb38\ubc95 \uc5d0\ub7ec \ubc1c\uc0dd \ub4f1 \uc815\ub9d0 \ub204\uad6c\ub098 \ud560 \uc218 \uc788\ub294 \uc2e4\uc218\uc778\ub370, \ub9cc\uc57d \uc778\uc9c0\ub97c \ubabb\ud558\uace0 Product\ub85c \ubc30\ud3ec\uac00 \ub418\uba74 \uc7a5\uc560\uac00 \ubc1c\uc0dd\ud569\ub2c8\ub2e4.  \\n\ub610\ud55c \uac8c\uc774\ud2b8\uc6e8\uc774\ub2e4\ubcf4 \ub2c8 \uac8c\uc774\ud2b8\uc6e8\uc774 \ub4a4\ub85c \ud750\ub974\ub294 \ubaa8\ub4e0 application\ub4e4\uc774 \ud750\ub97c \uc218 \uc5c6\uac8c \ub418\uc5b4 \uce58\uba85\uc801\uc778 \uc7a5\uc560\uac00 \ubc1c\uc0dd\ud560 \uc218 \uc788\uc73c\ub2c8 Production \ud658\uacbd\uc5d0\uc11c\ub294 Java Config\ub85c \uc124\uc815\uc744 \ud558\ub294 \uac78 \ucd94\ucc9c\ub4dc\ub9bd\ub2c8\ub2e4.  \\n\\n### \ud6c4\uae30  \\n\uc694\uc998 \ub0b4\ubd80 \uad6c\ud604\uc744 \ub9ce\uc774 \uae4c \ubcf4\uba74\uc11c, \ub0b4\uac00 \ud544\uc694\ud55c \ubd80\ubd84\ub4e4\uc744 \ub530\ub85c \ube7c\uc11c \ucee4\uc2a4\ud140\ud574\uc11c \uc4f0\ub294 \uc77c\uc774 \uba87 \ubc88 \ud558\ub2e4\ubcf4\ub2c8, \uc9c0\uae08\ub3c4 \ub9c8\ucc2c\uac00\uc9c0\uc9c0\ub9cc \uc608\uc804\uc5d0\ub294 \uc9c4\uc9dc \ub9c9 \uc37c\uc5c8\uad6c\ub098\ub77c\uace0 \ub2e4\uc2dc\uae08 \ub9ce\uc774 \ub290\ub07c\uace0 \uadf8\ub7ec\uba74\uc11c \uc694\uc998  \uc2a4\ud504\ub9c1\uacfc 1cm \uc815\ub3c4 \uac70\ub9ac\uac00 \uac00\uae4c\uc6cc\uc84c\ub2e4\ub294 \uac78 \ub290\ub07c\uba74\uc11c ~~\ubb3c\ub860 \uadf8\ub7ec\uba74\uc11c \uba38\ub9ac\uac00 \ube60\uc9c4...~~ \uac1c\uc778\uc801\uc73c\ub85c **\uc131\uc7a5**\ud558\uace0 \uc788\ub294 \uac78 \ub9ce\uc774 \ub290\ub07c\uace0 \uc788\ub2e4.\\n\\n\ucc38\uace0  \\n[https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/](https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/)  \\n[https://blog.jungbin.kim/spring/2021/02/27/spring-cloud-gateway-route-locator.html](https://blog.jungbin.kim/spring/2021/02/27/spring-cloud-gateway-route-locator.html)  \\n[https://www.baeldung.com/spring-cloud-gateway#spring-cloud-discoveryclient-support](https://www.baeldung.com/spring-cloud-gateway#spring-cloud-discoveryclient-support)  \\n[https://dlsrb6342.github.io/2019/05/14/spring-cloud-gateway-\uad6c\uc870/](https://dlsrb6342.github.io/2019/05/14/spring-cloud-gateway-%EA%B5%AC%EC%A1%B0/)"},{"id":"generic","metadata":{"permalink":"/generic","editUrl":"https://github.com/facebook/docusaurus/edit/main/website/blog/2022-05-07-Java-Generic.md","source":"@site/blog/2022-05-07-Java-Generic.md","title":"\uae4c\uba39\uc5b4\uc11c \ub2e4\uc2dc \ubcf4\ub294 Generic","description":"\uae4c\uba39\uc5b4\uc11c \ub2e4\uc2dc \ucc3e\uc544\ubcf4\ub294 \uc81c\ub124\ub9ad","date":"2022-05-07T00:00:00.000Z","formattedDate":"May 7, 2022","tags":[{"label":"Java","permalink":"/tags/java"}],"readingTime":8.115,"truncated":true,"authors":[{"name":"Dongle","title":"Junior Backend Developer","url":"https://github.com/sk1737030","imageURL":"https://github.com/sk1737030.png","key":"dongle"}],"frontMatter":{"title":"\uae4c\uba39\uc5b4\uc11c \ub2e4\uc2dc \ubcf4\ub294 Generic","description":"\uae4c\uba39\uc5b4\uc11c \ub2e4\uc2dc \ucc3e\uc544\ubcf4\ub294 \uc81c\ub124\ub9ad","slug":"generic","authors":"dongle","tags":["Java"],"image":"https://i.imgur.com/mErPwqL.png","hide_table_of_contents":false},"prevItem":{"title":"Spring Cloud Gateway Route \uc124\uc815\ud574\ubcf4\uae30","permalink":"/gateway"},"nextItem":{"title":"Container \ud658\uacbd\uc5d0\uc11c\uc758 JVM GC","permalink":"/container-gc"}},"content":"\uc81c\ub124\ub9ad\uc744 \uc0ac\uc6a9\ud558\ub294\ub370, \ud5f7\uac08\ub824\uc11c \ub2e4\uc2dc \uacf5\ubd80 \ud560 \uacb8 \uc815\ub9ac\\n\x3c!--truncate--\x3e\\n\\n\ubaa8\ub4e0 \uc18c\uc2a4\ub294 [\uc774\uacf3\uc5d0\uc11c](https://github.com/sk1737030/til/tree/master/til-generic/src) \ud655\uc778 \uac00\ub2a5 \ud569\ub2c8\ub2e4!\\n\\n## Generic \uc81c\ub124\ub9ad \uc9c0\ub124\ub9ad \uc934\ub124\ub9ad \\n\\n\x3c!--truncate--\x3e\\n\\n### \uc81c\ub124\ub9ad\uc774\ub780???\\n\\nJDK 1.5\uc5d0 \ub3c4\uc785\ub41c `\ucef4\ud30c\uc77c` \uc2dc\uc5d0 \ubbf8\ub9ac \ud0c0\uc785\uc744 \uc9c0\uc815\ud574\uc11c, \ub7f0\ud0c0\uc784\uc2dc\uc5d0 \uc624\ub958\ub97c \uc904\uc774\uace0 \ud0c0\uc785 \uac80\uc0ac\ub098 \ud0c0\uc785 \ubcc0\ud658\uacfc \uac19\uc740 \ubc88\uac70\ub85c\uc6b4 \uc791\uc5c5\uc744 \uc0dd\ub7b5\ud560 \uc218 \uc788\ub294 \ud0c0\uc785 \uac80\uc0ac\ub97c \ub3c4\uc640\uc8fc\ub294 **\uac13\uac13\ubb38\ubc95**\uc774\ub2e4.\\n\\n### \uadf8\ub807\ub2e4\uba74 \uc65c \ub098\uc654\uc744\uae4c??\\n\\n```java\\n// \ubb38\uc81c\uc758 \ucf54\ub4dc\\nList<Object> list = new ArrayList<>();\\nbefore.add(\\"pub\\");\\nbefore.add(\\"dog\\");\\nbefore.add(1);\\n\\nfor (Object o : before) {\\n    String substring = ((String) o).substring(0, 1); // Runtime Error\\n    System.out.println(substring);\\n}\\n```\\n\\nlist \uc548\uc5d0 \uc5b4\ub5a0\ud55c \ud0c0\uc785\uc774\ub77c\ub3c4 \ub4e4\uc5b4\uac08 \uc218 \uc788\uac8c \ub3fc\uc11c, \ucef4\ud30c\uc77c \uc2dc\uc5d0 \uc5d0\ub7ec\ub97c \uc54c \uc218\uac00 \uc5c6\uace0, \uadf8\ub7ec\ub2e4 \ubcf4\ub2c8 \ub7f0\ud0c0\uc784\uc2dc\uc5d0 \uc5d0\ub7ec\uac00 \ubc1c\uc0dd\uc744 \ud558\uac8c \ub418\uace0, \uac1c\ubc1c \ud560 \ub54c\uc5d0\ub3c4 \ub354\uc6b1 \ubd88\ud3b8\ud55c \uac74 \ud56d\uc0c1 \ud0c0\uc785\uccb4\ud06c\ub97c \ud558\uace0 casting\uc744 \ud574\uc57c \uc5ec\ub7ec \uba54\uc18c\ub4dc\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\uac8c \ub41c\ub2e4. \\n\\n### \ud754\ud55c  Generic \uc0ac\uc6a9\\n\\n```java\\npublic class Main {\\n\\n    public static void main(String[] args) {\\n\\n        List<String> list = new ArrayList<>(); // 1.7 \uc774\ud6c4\uc5d0\uc11c\ub294 \ud0c0\uc785 \ucd94\ub860\uc774 \uac00\ub2a5\ud574\uc11c \ub4a4\uc5d0 \ud0c0\uc785\uc740 \uc0dd\ub7b5\uc774 \uac00\ub2a5\ud558\ub2e4.\\n        list.add(\\"pub\\");\\n        list.add(\\"dog\\");\\n        list.add(1); // Complie Error\\n\\n\\t\\t\\t\\tfor (String s : list) {\\n            String substring = s.substring(0, 1);\\n            System.out.println(substring);\\n        }\\n    }\\n}\\n```\\n\\n\ud0c0\uc785\uc744 `\uccb4\ud06c`\ud560 \ud544\uc694\ub3c4 \uc5c6\uace0 `\uce90\uc2a4\ud305` \ud560 \ud544\uc694\ub3c4 \uc5c6\uc5b4\uc9c4\ub2e4.\\n\\n### \uc870\uae08 \ub354\\n\\nDog Sitter(\uc9d1\uc0ac) \uac15\uc544\uc9c0 \uc9d1\uc0ac\uac00 \uac04\uc2dd\uc744 \uc900\ub2e4\uace0 \ud588\uc744 \ub54c \\n\\n```java\\npublic class Animal{}\\npublic class Dog extends Animal{}\\npublic class Pug extends Dog{}\\npublic class Siba extends Dog{}\\n```\\n\\n```java\\npublic class Sitter {\\n\\n\\tpublic void giveSnack(House<Dog> house, Snack snack) {\\n\\t\\t...\\n  }\\n}\\n\\n```\\n\\n\ucef4\ud30c\uc77c \uc5d0\ub7ec\ub098\ub294 \uc0c1\ud669  \\n\\n```java\\nPug pug = new Pug();\\nDog dog = pug;\\n\\nSystem.out.println(pug.getClass()); // class generic.animal.Pug\\nSystem.out.println(dog.getClass()); // class generic.animal.Pug\\n\\nSitter sitter = new Sitter();\\nHouse<Pug> pugHouse = new House<>();\\nsitter.giveSnack(pugHouse, new Snack()); // \ucef4\ud30c\uc77c error!\\n```\\n\\n- \ub9e4\uc6b0.. \ud5f7\uac08\ub9ac\uc9c0\ub9cc \uc870\uae08 \ub354 \uc0dd\uac01\ud574\ubcf4\uba74 \ucef4\ud30c\uc77c \uc5d0\ub7ec\uac00 \ub098\ub294 \uc774\uc720\ub294 \ub2f9\uc5f0\ud558\ub2e4. \ub9cc\uc57d \ucef4\ud30c\uc77c \uc5d0\ub7ec\uac00 \uc548 \ub09c\ub2e4\uace0 \uac00\uc815\uc744 \ud574\ubcf4\uba74\\n\\nif \ucef4\ud30c\uc77c error\uac00 \uc544\ub2c8\ub77c\uba74 !\\n\\n```java\\nSitter sitter = new Sitter();\\nHouse<Pug> pugHouse = new House<>();\\nHouse<Siba> sibaHouse = new House<>();\\nsitter.giveSnack(pugHouse, new Snack()); // \ucef4\ud30c\uc77c error\uac00 \uc544\ub2c8\ub77c\uba74!\\nsitter.giveSnack(sibaHouse, new Snack()); // \ucef4\ud30c\uc77c error\uac00 \uc544\ub2c8\ub77c\uba74!\\n```\\n\\n- \uc774\ub807\uac8c Dog\uc744 \uc0c1\uc18d\ud588\uc9c0\ub9cc \ub450 \uac00\uc9c0\uc758 \ub2e4\ub978 \ud0c0\uc785\uc774 \ub4e4\uc5b4\uac08 \uc218 \uc788\uac8c \ub418\ub294 \uc0c1\ud669\uc774 \ubc1c\uc0dd\ud55c\ub2e4.\\n    \\n    **\uc5b4 \uc544\ub2c8? \uadf8\ub798\uc11c \ubb50\uac00 \ubb38\uc81c\uc57c Dog\ub97c \uc0c1\uc18d\ud55c pug\uc640 siba \uac00\uc559\uc9c0\ub4e4\uc774 \ub4e4\uc5b4 \uac08 \uc218 \uc788\ub294\uac70 \uc544\ub2c8\uc57c!????** \\n    \\n\\n![Untitled](2022-05-0/../2022-05-07/Untitled.png)  \\n\\n\ub9cc\uc57d \uc800\uac8c \ud5c8\uc6a9\uc774 \ub41c\ub2e4\uace0 \uac00\uc815 \ud588\uc744 \ub54c\uc758 \ubb38\uc81c\uac00 \ub418\ub294 \ubd80\ubd84\uc744 \ucf54\ub4dc\ub85c \ubcf8\ub2e4\uba74 \\n\\n```java\\npublic class House<T> implements Iterable {\\n \\n    List<T> lists = new ArrayList<>();\\n\\n    public void add(T t) {\\n        lists.add(t);\\n    }\\n\\n    public T get(int i) {\\n        return lists.get(i);\\n    }\\n\\n\\t\\t@Override\\n    public Iterator iterator() {\\n        return lists.iterator();\\n    }\\n\\n    @Override\\n    public void forEach(Consumer action) {\\n        Iterable.super.forEach(action);\\n    }\\n\\n    @Override\\n    public Spliterator spliterator() {\\n        return Iterable.super.spliterator();\\n    }\\n}\\n```\\n\\n```java\\nHouse<Pug> pugHouse = new House<>();\\nHouse<Siba> sibaHouse = new House<>();\\n\\nHouse<Dog> dogHouse = new House<>();\\ndogHouse.add(pugHouse); // Compile Error\\ndogHouse.add(sibaHouse); // Compile Error\\n\\nfor(Dog dog: dogHouse) {\\n    ...\\n}\\n```\\n\\n\uc544\uae4c 1.5 \uc774\uc804\uc5d0 \ubcf4\uc558\ub358 \ube44\uc2b7\ud55c \ubb38\uc81c\uac00 \uc624\ub978\ucabd\uc758 \ucf54\ub4dc\uc5d0\uc11c \uc0dd\uae30\uac8c \ub41c\ub2e4. \\n\\n:::note\uadf8\ub807\ub2e4\uba74 \uc65c \uc790\ubc14\ub294  raw type\uc744 \ud5c8\uc6a9\ud588\uc744\uae4c?\\n`List list = new ArrayList<>()`\uac00 \ub418\ub294 \uc774\uc720\ub294 \ud638\ud658\uc131 \ub54c\ubb38\uc774\ub2e4. \uc790\ubc14\uac00 \uc81c\ub124\ub9ad\uc744 \ubc1b\uc544\ub4e4\uc774\uae30\uae4c\uc9c0 \uac70\uc758 10\ub144\uc774 \uac78\ub9b0 \ud0d3\uc5d0 \uc81c\ub124\ub9ad \uc5c6\uc774 \uc9e0 \ucf54\ub4dc\uac00 \uc774\ubbf8 \uc138\uc0c1\uc744 \ub4a4\ub36e\uc5b4 \ubc84\ub838\ub2e4. \uadf8\ub798\uc11c \uae30\uc874 \ucf54\ub4dc\ub97c \ubaa8\ub450 \uc218\uc6a9\ud558\uba74\uc11c \uc81c\ub124\ub9ad\uc744 \uc0ac\uc6a9\ud558\ub294 \uc0c8\ub85c\uc6b4 \ucf54\ub4dc\uc640\ub3c4 \ub9de\ubb3c\ub824 \ub3cc\uc544\uac00\uac8c \ud574\uc57c\ub9cc \ud588\ub2e4. raw \ud0c0\uc785\uc744 \uc0ac\uc6a9\ud558\ub294 \uba54\uc11c\ub4dc\uc5d0 \ub9e4\uac1c \ubcc0\uc218\ud654 \ud0c0\uc785\uc758 \uc778\uc2a4\ud134\uc2a4\ub97c \ub118\uaca8\ub3c4 \ub3d9\uc791\ud574\uc57c\ub9cc \ud588\ub358 \uac83\uc774\ub2e4.\\n:::note\\n\\n### [\ubb34\ubcc0\uc131 (invariant)](https://stackoverflow.com/questions/8902331/what-is-a-class-invariant-in-java)\\n\\nA\uac00 B\uc758 \uc0c1\uc704 \ud0c0\uc785\uc77c \ub54c `GenericType<A>`\uac00 `GenericType<B>` \uc758 \uc0c1\uc704 \ud0c0\uc785\uc774 \uc544\ub2c8\uba74 \ubcc0\uc131\uc774 \uc5c6\ub2e4.\\n\ub2e4\ub978 \ucf54\ub4dc\ub4e4\uc774 \ubb58 \ud558\ub4e0 \uac04\uc5d0, \ud074\ub798\uc2a4\uc758 \ubaa8\ub4e0 \uc778\uc2a4\ud134\uc2a4\uc5d0 \ub300\ud574 \uc720\uc9c0\ub418\ub294 \uc18d\uc131\uc774\ub2e4.  \\n\\n```java\\nAnimal animal = new Pug();\\nHouse<Animal> dogHouse = new House<Dog>(); // Compile Error \\n```\\n\\n`House<Animal>` \uc740 `House<Dog>` \uc758 \uc0c1\uc704 \ud0c0\uc785\uc774 \uc544\ub2c8\ub2e4. \uc544\ub2c8\ub2c8\uae4c \uc18d\uc131\uc774 \uc720\uc9c0\ub420 \uc218 \uc5c6\ub2e4.\\n\\n### **[\uacf5\ubcc0 (covariant)](https://www.javatpoint.com/covariant-return-type)**\\n\\n\uc6b0\ub9ac\uac00 ~~(\uadf8\ub098\ub9c8 \ub098\uc5d0\uac8c)~~ \uac00\uc7a5 \ud754\ud558\uac8c \uc4f0\ub294 \ud615\ud0dc\uc774\uc9c0 \uc54a\uc744\uae4c \uc2f6\ub2e4. \uc0c1\uc704\ud0c0\uc785\uc5d0\uc11c \ubb3c \ud750\ub974\ub4ef\uc774 \ud558\uc704\ud0c0\uc785\uc758 \ubc29\ud5a5\uc73c\ub85c \ucf54\ub4dc\ub97c \uc0ac\uc6a9\ud560 \ub54c\uc774\ub2e4.  \\n\\n- A\uac00 B\uc758 \uc0c1\uc704 \ud0c0\uc785\uc774\uace0 `T<A>`\uac00 `T<B>`\uc758 \uc0c1\uc704 \ud0c0\uc785\uc774\uba74 \uacf5\ubcc0\uc774\ub77c \ud55c\ub2e4.\\n\\n    ```java\\n    public class Sitter {\\n\\n        public void giveSnack(House<? extends Dog> dog, \\n                Snack snack) {\\n            List<? extends Dog> all = dog.getAll();\\n        }\\n    }\\n    ```\\n\\n    ```java\\n    // \uacf5\ubcc0\\n    Sitter covariant = new Sitter();\\n    House<Pug> pug2 = new House<>();\\n    covariant.giveSnack(pug2, new Snack());\\n\\n    House<Siba> siba2 = new House<>();\\n    covariant.giveSnack(siba2, new Snack());\\n    ```\\n\\n- \ubb38\uc81c\uc810\\n    ```java\\n    House<Pug> pug = new House<>();\\n    House<? extends Dog> dogHouse = pug;\\n    // dogHouse.push(new Pug()); // Compile Error\\n    ```\\n\\n    ```java\\n    public class House<T> implements Iterable{\\n\\n            ...\\n\\n        List<T> lists = new ArrayList<>();\\n            \\n        public void push(T pug) {\\n            lists.add(pug);\\n        }\\n    }\\n    ```\\n\\n### [\ubc18\uacf5\ubcc0(contravariant)](https://codechacha.com/ko/java-covariance-and-contravariance/)  \\n\\n- A\uac00 B\uc758 \uc0c1\uc704 \ud0c0\uc785\uc774\uace0 `T<A>`\uac00 `T<B>`\uc758 \ud558\uc704 \ud0c0\uc785\uc774\uba74 \ubc18\uacf5\ubcc0\uc774\ub77c\ud55c\ub2e4.  \\n    \\n    ```java\\n    // \ubc18\uacf5\ubcc0\\n    House<Pug> pug = new House<>();\\n    House<? super Pug> pugh = pug;\\n    \\n    House<Dog> dog = new House<>();\\n    House<? super Pug> pughh = dog;\\n    ```\\n    \\n-  \ubc18\uacf5\ubcc0\uc740 \ubc18\ub300\ub85c Get\uc744 \ud560 \ub54c \ucef4\ud30c\uc77c \uc5d0\ub7ec\uac00 \ubc1c\uc0dd\ud55c\ub2e4.  \\n\\n    ```java\\n    // \ubc18\uacf5\ubcc0\\n    House<Dog> dog = new House<>();\\n    House<? super Dog> pugh = dog;\\n    pugh.push(new Pug());\\n    pugh.push(new Dog());\\n    // Pug housePug = pugh.get(0); // Compile Error\\n\\n    House<Pug> pug = new House<>();\\n    House<? super Pug> pugh2 = pug;\\n    pugh2.push(new Pug());\\n    // pugh2.push(new Dog()); // Compile Error\\n    // Pug housePug = pugh2.get(0); // Compile Error\\n    ```\\n\\n\uc5d0\ub7ec\uac00 \ubc1c\uc0dd\ud558\ub294 \uc774\uc720\ub294 \ub2f9\uc5f0\ud55c\ub370 \uc870\uae08\ub9cc \ub354 \uacf0\uacf0\uc774 \uc0dd\uac01\ud574\ubcf4\uba74, ~~\uc0ac\uc2e4 \uc0dd\uac01\ud574\ubd10\ub3c4 \uc5b4\ub835\ub2e4~~ get\uc73c\ub85c \uac00\uc838\uc62c \ub54c return \uac12\uc774 Pug\uc77c \uc218\ub3c4 \uc788\uace0, Pug \uc704\uc5d0 \uc0c1\uc704\uac1d\uccb4\uac00 \uc62c \uc218 \uc788\uc5b4\uc11c \uc5d0\ub7ec\uac00 \ub0a0 \uc218\ubc16\uc5d0 \uc5c6\ub2e4.\\n\\n### Java \ucf54\ub4dc\uc5d0 \ubc18\uacf5\ubcc0 \ubcfc \uc218 \uc788\ub294 \uacf3\\n\\n```java\\npublic class Collecitons  {\\n\\tpublic static <T> void copy(List<? super T> dest, List<? extends T> src) {\\n\\t\\t...\\n\\t}\\n}\\n```\\n\\n```java\\nList<Integer> src = new ArrayList<>();\\nList<Number> dest = new ArrayList<>();\\n\\nCollections.copy(dest, src);\\n```\\n\\n![Untitled](2022-05-07/Untitled%201.png)\\n\\n### \ud0c0\uc785 \uc81c\uac70 \uc2dc\uae30\\n\\n\uc790\ubc14 \ucf54\ub4dc\uc5d0\uc11c \uc120\uc5b8\ub418\uace0 \uc0ac\uc6a9\ub41c \uc81c\ub124\ub9ad \ud0c0\uc785\uc740 \ucef4\ud30c\uc77c \uc2dc \ucef4\ud30c\uc77c\ub7ec\uc5d0 \uc758\ud574 \uc790\ub3d9\uc73c\ub85c \uac80\uc0ac\ub418\uc5b4 \ud0c0\uc785 \ubcc0\ud658\ub41c\ub2e4. \uadf8 \ud6c4\uc5d0 \ucf54\ub4dc \ub0b4\uc758 \ubaa8\ub4e0\xa0\uc81c\ub124\ub9ad \ud0c0\uc785\uc740 \uc81c\uac70\ub418\uc5b4, \ucef4\ud30c\uc77c\ub41c class \ud30c\uc77c\uc5d0\ub294 \uc5b4\ub5a0\ud55c \uc81c\ub124\ub9ad \ud0c0\uc785\ub3c4 \ud3ec\ud568\ub418\uc9c0 \uc54a\uac8c \ub41c\ub2e4. \uc774\ub7f0 \uc2dd\uc73c\ub85c \ub3d9\uc791\ud558\ub294 \uc774\uc720\ub294\xa0\uc81c\ub124\ub9ad\uc744 \uc0ac\uc6a9\ud558\uc9c0 \uc54a\ub294 \ucf54\ub4dc\uc640\uc758 \ud638\ud658\uc131\uc744 \uc720\uc9c0\ud558\uae30 \uc704\ud574\uc11c\uc774\ub2e4.  \\n\\n\\n\\n\ucd9c\ucc98  \\n[https://docs.oracle.com/javase/tutorial/java/generics/types.html](https://docs.oracle.com/javase/tutorial/java/generics/types.html)  \\n[http://www.tcpschool.com/java/java_generic_concept](http://www.tcpschool.com/java/java_generic_concept)  \\n[https://www.youtube.com/watch?v=PtM44sO-A6g](https://www.youtube.com/watch?v=PtM44sO-A6g)  \\n[Effective Java](http://www.yes24.com/Product/Goods/65551284)  \\n[https://stackoverflow.com/questions/8902331/what-is-a-class-invariant-in-java](https://stackoverflow.com/questions/8902331/what-is-a-class-invariant-in-java) \ubb34\ubcc0\uc131\uc774\ub780  \\n[https://codechacha.com/ko/java-covariance-and-contravariance/](https://codechacha.com/ko/java-covariance-and-contravariance/)"},{"id":"container-gc","metadata":{"permalink":"/container-gc","editUrl":"https://github.com/facebook/docusaurus/edit/main/website/blog/2022-05-02-JVM-GC-IN-KUBERNATE.md","source":"@site/blog/2022-05-02-JVM-GC-IN-KUBERNATE.md","title":"Container \ud658\uacbd\uc5d0\uc11c\uc758 JVM GC","description":"\ucee8\ud14c\uc774\ub108 \ud658\uacbd\uc5d0\uc11c\uc758 JVM GC\ub294 \ubb34\uc5c7\uc774 \uc120\ud0dd\ub420\uae4c?","date":"2022-05-02T00:00:00.000Z","formattedDate":"May 2, 2022","tags":[{"label":"Kubernate","permalink":"/tags/kubernate"},{"label":"Container","permalink":"/tags/container"},{"label":"JVM","permalink":"/tags/jvm"},{"label":"Java","permalink":"/tags/java"}],"readingTime":7.58,"truncated":true,"authors":[{"name":"Dongle","title":"Junior Backend Developer","url":"https://github.com/sk1737030","imageURL":"https://github.com/sk1737030.png","key":"dongle"}],"frontMatter":{"title":"Container \ud658\uacbd\uc5d0\uc11c\uc758 JVM GC","description":"\ucee8\ud14c\uc774\ub108 \ud658\uacbd\uc5d0\uc11c\uc758 JVM GC\ub294 \ubb34\uc5c7\uc774 \uc120\ud0dd\ub420\uae4c?","slug":"container-gc","authors":"dongle","tags":["Kubernate","Container","JVM","Java"],"image":"https://i.imgur.com/mErPwqL.png","hide_table_of_contents":false},"prevItem":{"title":"\uae4c\uba39\uc5b4\uc11c \ub2e4\uc2dc \ubcf4\ub294 Generic","permalink":"/generic"},"nextItem":{"title":"Request Rate Limiter\ub97c \ub9cc\ub4e4\uc5b4\ubcf4\uc790! 2\ud3b8","permalink":"/RateLimiter2"}},"content":"\ub2f9\uc5f0\ud788 \uc6b0\ub9ac\uc758 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 GC\ub294 \ub2f9\uc5f0\ud788 G1GC\ub97c \uc4f0\uace0 \uc788\uaca0\uc9c0\ub77c\uace0 \ud55c\uce58\uc758 \uc758\uc2ec \uc5c6\uc774 \uc0dd\uac01\uc744 \ud588\uc5c8\ub2e4. \uc544\ub2c8 \uc801\uc5b4\ub3c4 Jdk 11\uc744 \uc0ac\uc6a9\ud558\uba74\uc11c GC\ub97c zgc vs g1gc\ub97c \ubb58 \uc368\uc57c \ub354 \uc88b\uc744\uae4c \uc774\ub7f0 \uc0dd\uac01\ub9cc \ud588\uc5c8\uc9c0 \uc124\ub9c8 **G1GC vs Serial\xa0Collector**\ub97c \uace0\ubbfc\uc744 \ud558\uace0 \uc788\uc744 \uc904\uc774\uc57c! \uafc8\uc5d0\uc11c\ub3c4 \uc0dd\uac01\uc744 \ubabb\ud588\ub2e4. \uacb0\ub860\ubd80\ud130 \ub9d0\ud558\uc790\uba74 Container \ud658\uacbd\uc5d0\uc11c Cpu\uc640 \uba54\ubaa8\ub9ac\uc5d0 \ub530\ub77c\uc11c GC\uc120\ud0dd\uc774 g1gc\uac00 \ub420 \uc218\ub3c4 \uc788\uace0 \uc544\ub2d0 \uc218\ub3c4 \uc788\ub2e4.\\n\x3c!--truncate--\x3e\\n\\n## Jdk 11\uc758 GC\ub294 \ubb34\uc870\uac74 G1GC\uc8e0!\\n\\n\ub2f9\uc5f0\ud788 \uc6b0\ub9ac\uc758 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 GC\ub294 \ub2f9\uc5f0\ud788 G1GC\ub97c \uc4f0\uace0 \uc788\uaca0\uc9c0\ub77c\uace0 \ud55c\uce58\uc758 \uc758\uc2ec \uc5c6\uc774 \uc0dd\uac01\uc744 \ud588\uc5c8\ub2e4. \uc544\ub2c8 \uc801\uc5b4\ub3c4 Jdk 11\uc744 \uc0ac\uc6a9\ud558\uba74\uc11c GC\ub97c zgc vs g1gc\ub97c \ubb58 \uc368\uc57c \ub354 \uc88b\uc744\uae4c \uc774\ub7f0 \uc0dd\uac01\ub9cc \ud588\uc5c8\uc9c0 \uc124\ub9c8 **G1GC vs Serial\xa0Collector**\ub97c \uace0\ubbfc\uc744 \ud558\uace0 \uc788\uc744 \uc904\uc774\uc57c! \uafc8\uc5d0\uc11c\ub3c4 \uc0dd\uac01\uc744 \ubabb\ud588\ub2e4. \uacb0\ub860\ubd80\ud130 \ub9d0\ud558\uc790\uba74 Container \ud658\uacbd\uc5d0\uc11c Cpu\uc640 \uba54\ubaa8\ub9ac\uc5d0 \ub530\ub77c\uc11c GC\uc120\ud0dd\uc774 g1gc\uac00 \ub420 \uc218\ub3c4 \uc788\uace0 \uc544\ub2d0 \uc218\ub3c4 \uc788\ub2e4.\\n\\n\\n### \ubc1c\ub2e8\\n\\n\uc77c\ub2e8 \uc6b0\ub9ac\ub294 \ud754\ud558\ub514 \ud754\ud55c `Kubernate`\uc758 \uba4b\uc788\ub294 \uc624\ucf00\uc2a4\ud2b8\ub77c\ub97c \uc5f0\uc8fc\ub97c \ud558\uba70 `Container`\ud658\uacbd\uc5d0\uc11c app\uc744 \ubc30\ud3ec\ud558\uace0 \uad00\ub9ac\ud558\uace0 \uc788\ub2e4. \uc5b4\ub290\ub0a0 Slack\uc5d0 \ud06c\ub8e8 \uc911 \ub204\uad70\uac00\uac00 \uc6b0\ub9ac \ub2f9\uc5f0\ud788 g1gc \uc4f0\uace0 \uc788\uc8e0? \ub77c\uace0 \uc62c\ub77c\uc640\uc11c \ub098\ub294 \uc5e5? \ub2f9\uc5f0\ud55c \uac70 \uc544\ub2cc\uac00\ub77c\uace0 \uc0dd\uac01\uc744 \ud558\uace0 \ub2e4\ub978 \uc77c\uc744 \ud588\ub294\ub370 \ub2e4\ub978 \ud06c\ub8e8\uac00 \uc6b0\ub9ac **Serial\xa0Collector** \uc778 \uac70 \uac19\uc740\ub370\uc694??? \ub77c\uace0 \ub2f5\uc7a5\uc744 \ub2ec\uc558\ub2e4.  \\n\\n![\uc544\ub2c8 \uc774\uac8c \ubb54 \uac1c \uc18c\ub9ac\uc57c!](2022-05-02/Untitled.png)  \\n\\n\\n### \uc815\ub9d0\uc77c\uae4c?\\n\\n\ub098\ub294 \uc6b0\ub9ac jdk11 \ubc84\uc804 \uc4f0\ub294\ub370? \uadf8\ub7f4 \ub9ac\uac00 \uc788\uc5b4? \uc5d0\uc774 \uc798\ubabb \ubd24\uaca0\uc9c0\ub77c\uace0 \uc0dd\uac01\uc744 \ud558\uace0 \uc88b\uc544 \ub0b4 \ub208\uc73c\ub85c \ud655\uc778\uc744 \ud574\ubd10\uc57c\uc9c0\ub77c\uba70 container\uc5d0  \ub4e4\uc5b4\uac00\uc11c \ud655\uc778\uc744 \ud574 \ubd24\ub294\ub370\\n\\n```bash\\n> java -XX:+PrintCommandLineFlags -version\\n\\nPicked up JAVA_TOOL_OPTIONS:\\n...\\n-XX:+SegmentedCodeCache \\n-XX:+UseCompressedClassPointers \\n-XX:+UseCompressedOops \\n**-XX:+UseSerialGC** \\n\\nopenjdk version \\"11.0.13\\" 2021-10-19\\nOpenJDK Runtime Environment (build 11.0.13+8-post-Debian-1deb11u1)\\nOpenJDK 64-Bit Server VM (build 11.0.13+8-post-Debian-1deb11u1, mixed mode)\\n```\\n\\n\uc77c\ub2e8 \ub2e4\ub978 Java_Tool Option\uc774 \uc788\uc5c8\uc9c0\ub9cc \ub2e4 \uc0dd\ub7b5\ud558\uace0 \uba3c\uc800 OpenJdk \uc0ac\uc6a9 \uc911\uc774\uace0 Version\uc740 11.0.13\uc744 \uc0ac\uc6a9\ud558\ub294 \uac78 \ud655\uc778\ud558\uace0, \uc635\uc158\uc744 \ubd24\ub294\ub370 `-XX:+UseSerialGC`  (~~\uc544\ub2c8 \ud615\uc774 \uc65c \uc694\uae30\uc11c \ub098\uc640~~)  \\n\\n### \uc758\uc2ec\\n\\n\ub108\ubb34 \ub180\ub77c\uc11c, \uc9c0\uae08 \uc0dd\uac01\ud574\ubcf4\uba74 \ub9d0\ub3c4 \uc548 \ub418\ub294 \uc5ec\ub7ec \uc758\uc2ec\ub4e4\uc744 \ud588\ub294\ub370 \\n\\n1. \uc800 JDK \ubc84\uc804\uc774 \ubb38\uc81c\uac00 \uc788\uc5b4\uc11c \ubb34\uc870\uac74 SerialGC\ub97c \uc8fc\uc785 \ud560 \uac83\uc774\ub2e4.\\n    - \ub77c\uace0 \uc0dd\uac01\uc744 \ud588\uc9c0\ub9cc, \uc0ac\uc2e4 \ub9d0\ub3c4 \uc548 \ub41c\ub2e4 \ubb34\uc2a8 \ub3d9\ub124 OpenJdk\ub3c4 \uc544\ub2c8\uace0 \uc774 \uc0dd\uac01\uc740 \uae08\ubc29 \ub118\uc5b4\uac14\ub2e4\\n2. \ub204\uad70\uac00\uac00 \uc8fc\uc785\uc744 \ud588\uc744 \uac83\uc774\ub2e4.\\n    - \ub204\uad70\uac00\uac00 build\ub97c \ud560 \ub54c \uc8fc\uc785\uc744 \ud574\ub1a8\uc744 \uac70\ub77c\uace0 \uc0dd\uac01\uc744 \ud558\uace0 build\ubd80\ubd84\uc744 \uc720\uc2ec\ud788 \ubd24\uc9c0\ub9cc SerialGC\uc758 S\ub3c4 \ucc3e\uc544\ubcfc \uc218 \uc5c6\uc5c8\ub2e4.\\n3. \uc800 \uc635\uc158\uc774 \ubcf4\uc5ec\uc8fc\ub294 \uac74 \uac00\uc9dc\uc57c!\\n\\n\ub4f1\ub4f1 \uc9c4\uc9dc \ub9d0\ub3c4 \uc548 \ub418\ub294 \uc758\uc2ec\ub4e4\uc744 \ud558\uae30 \uc2dc\uc791\ud588\ub2e4.\\n\\n### \uce68\ucc29\\n\\n\uc0ac\uc2e4 \uc704\uc5d0 \uc800\ub7f0 \uc758\uc2ec \ub9d0\uace0\ub3c4 \uc5ec\ub7ec \uac00\uc815\uacfc \uc218\ub9ce\uc740 \uc758\uc2ec\ub4e4\uc744 \ud588\uc5c8\ub2e4. \uadf8\ub7ec\ub2e4\uac00 \ud604\uc2e4\uc744 \ubc1b\uc544\ub4e4\uc774\uace0 \uc65c SerialGC\ub97c \uc0ac\uc6a9\ud558\uac8c \ub418\uc5c8\uc744\uae4c\ub77c\uace0 \uc0dd\uac01\uc744 \ud588\ub2e4. \uc0ac\uc2e4 \ub09c \ub098\ubcf4\ub2e4 Kube\ud658\uacbd\uc5d0\uc11c\uc758 Container\uac00 \uc790\ub3d9\uc73c\ub85c **\uc800\ub807\uac8c \uc124\uc815\ud55c \uc774\uc720\uac00 \uc788\uaca0\uc9c0\ub77c\uace0** \ub354 \ubbff\uae30 \ub54c\ubb38\uc5d0 \uc624\ub79c\ub9cc\uc5d0 SeraliGC\uc640 G1GC\ub97c \ub2e4\uc2dc \ud655\uc778\ud574 \ubcf4\uae30\ub85c \ud588\ub2e4.\\n\\n### Serail Collector\\n\\nThe serial collector uses a single thread to perform all garbage collection work, which makes it relatively efficient because there is no communication overhead between threads.\\n\\nIt\'s best-suited to single processor machines because it can\'t take advantage of multiprocessor hardware, although it can be useful on multiprocessors for applications with small data sets (up to approximately 100 MB). The serial collector is selected by default on certain hardware and operating system configurations, or can be explicitly enabled with the option\xa0`-XX:+UseSerialGC`.\\n\\n\uac00\uc7a5 \uc911\uc694\ud55c \ud575\uc2ec\uc740 **Single processor** \uc77c \ub54c Best Suite\uc774\ub2e4. \ubb3c\ub860 \uc791\uc740 \uba54\ubaa8\ub9ac \ub370\uc774\ud130\uc14b(up to approximately 100 MB)\uc744 \uc0ac\uc6a9\ud558\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0\uc11c\ub294 \uba40\ud2f0 \ud504\ub85c\uc138\uc11c\uc77c \uacbd\uc6b0 \uc4f8\ub9cc\ud558\uae34 \ud558\ub098 \ubcc4\ub85c \uc0ac\uc6a9\uc744 \uc548 \ud55c\ub2e4.\\n\\n### G1GC\\n\\njava 9 \ubd80\ud130 \ucc44\ud0dd\ud55c default GC\uc774\ub2e4. \\n\\nThe Garbage-First (G1) garbage collector is targeted for **multiprocessor machines** **with a large amount of memory**. It attempts to meet garbage collection pause-time goals with high probability while achieving high throughput with little need for configuration. G1 aims to provide the best balance between latency and throughput using current target applications and environments whose features include:\\n\u3139\ub9d0\ub3c4\\n\uac00\uc7a5 \uc911\uc694\ud55c \ud575\uc2ec\uc740 Gabage First GC\uc740 \ub192\uc740 \uba54\ubaa8\ub9ac \ub7c9\uacfc \ub2e4\uc911 \ud504\ub85c\uc138\uc11c\ub97c \ud0c0\uae43\uc73c\ub85c \uc0bc\uace0, \ube60\ub978 \ucc98\ub9ac\ub97c \uc9c0\uc6d0\ud558\uc5ec STW\ub97c \uc904\uc778\ub2e4\ub294 \uac83\uc774\ub2e4.\\n\\n### \uc6d0\uc778\\n\\n\uc6d0\uc778\uc740 [RedHat\ubb38\uc11c](https://developers.redhat.com/articles/2022/04/19/java-17-whats-new-openjdks-container-awareness#tuning_defaults_for_containers)\uc5d0\uc11c \ucc3e\uc744 \uc218 \uc788\uc5c8\ub294\ub370\\n\\n:::noteJava 11GC In Container\\nFor Java 11+ it\'s also useful to know which GC is being used, and you can display this information via\xa0-Xlog:gc=info. For example, when container limits allow only a single CPU to be active, the Serial GC will be selected. `If more than one CPU is active and sufficient memory (at least 2GB) is allocated to the container, the G1 GC will be selected in Java 11 and later versions:`\\n:::note\\n\\nContainer\ud658\uacbd\uc5d0\uc11c\ub294 CPU Core\ub97c 2\uac1c \uc774\uc0c1 \uc0ac\uc6a9\ud558\uba74\uc11c Memory\uac00 2G \uc774\uc0c1\uc774\uc5ec\uc57c G1GC\uac00 \ucc44\ud0dd\ub41c\ub2e4\ub294 \uac83\uc774\ub2e4.\\n\\n[\uc544\ub9c8\ub3c4  \ucf54\ub4dc\uc5d0\uc11c\ub294 \uc774\ub7f0 \ub290\ub08c\uc774\uc9c0 \uc54a\uc744\uae4c](https://developers.redhat.com/articles/2022/04/19/best-practices-java-single-core-containers#the_jvm_as_a_dynamic_execution_platform)\\n\\n```bash\\nvoid GCConfig::select_gc_ergonomically() {\\n  if (os::is_server_class_machine()) {\\n#if INCLUDE_G1GC\\n    FLAG_SET_ERGO_IF_DEFAULT(UseG1GC, true);\\n#elif INCLUDE_PARALLELGC\\n    FLAG_SET_ERGO_IF_DEFAULT(UseParallelGC, true);\\n#elif INCLUDE_SERIALGC\\n    FLAG_SET_ERGO_IF_DEFAULT(UseSerialGC, true);\\n#endif\\n  } else {\\n#if INCLUDE_SERIALGC\\n    FLAG_SET_ERGO_IF_DEFAULT(UseSerialGC, true);\\n#endif\\n  }\\n}\\n\\n// This is the working definition of a server class machine:\\n// >= 2 physical CPU\'s and >=2GB of memory\\n```\\n\\n### \ubcc0\uacbd\\n\\n\uc6d0\uc778\uc740 \uc77c\ub2e8 \uc54c\uc558\uc73c\ub2c8\uae4c \uae30\uc874\uc5d0 \ub530\ub85c \uc9c0\uc815\uc744 \uc548 \ud588\ub358 CPU processor\ub97c \ub298\ub9ac\uace0 \uba54\ubaa8\ub9ac\ub3c4 \uc99d\uac00\ub97c \uc2dc\ud0a8 \uacb0\uacfc  \\n\\n```bash\\n/ # java -XX:+PrintCommandLineFlags -version\\nPicked up JAVA_TOOL_OPTIONS: -javaagent:/opt/agent/apm-agent.jar\\n-XX:G1ConcRefinementThreads=2 -XX:GCDrainStackTargetSize=64 \\n...\\n-XX:+UseCompressedOops \\n**-XX:+UseG1GC** \\nopenjdk version \\"11.0.13\\" 2021-10-19\\n\\nOpenJDK 64-Bit Server VM (build 11.0.13+8-post-Debian-1deb11u1, mixed mode)\\n```\\n\\n\uadf8 \ud6c4 \uba70\uce60 \uac04\uaca9\uc73c\ub85c \ubaa8\ub2c8\ud130\ub9c1\uc744 \ud574\ubcf8 \uacb0\uacfc \\n\\n\uae30\uc874 SerialGC \uc0ac\uc6a9\ud560 \ub54c\uc5d0\ub294 GC\uac00 \uc77c\uc5b4\ub0a0 \ub54c \uc804\ubc18\uc801\uc73c\ub85c pause time\uc774 \uae38\uc5c8\uc2b5\ub2c8\ub2e4. 100ms \\n\\n![Untitled](2022-05-02/Untitled%201.png)  \\n\\n\ubcc0\uacbd \ud6c4  \\n\\n![Untitled](2022-05-02/Untitled%202.png)  \\n\\n\ub354 \ubaa8\ub2c8\ud130\ub9c1\uc744 \ud574 \ubd10\uc57c\uaca0\uc9c0\ub9cc \ub2e4\uc18c 150ms\ub098 \uba39\uc5c8\ub358 Major GC\ubd80\ubd84\uc774 heap size \ubcc0\uacbd \ubc0f cpu processor\uc99d\uac00 GC \ubcc0\uacbd \ud6c4\uc5d0 \uc544\uc9c1 \uc77c\uc5b4\ub098\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4.\\n\\n\ucc38\uc870  \\n[https://docs.oracle.com/javase/9/gctuning/available-collectors.htm#GUID-45794DA6-AB96-4856-A96D-FDE5F7DEE498](https://docs.oracle.com/javase/9/gctuning/available-collectors.htm#GUID-45794DA6-AB96-4856-A96D-FDE5F7DEE498)  \\n[https://johngrib.github.io/wiki/java-gc-tuning/#serial-collector](https://johngrib.github.io/wiki/java-gc-tuning/#serial-collector)  \\n[https://d2.naver.com/helloworld/1329](https://d2.naver.com/helloworld/1329) - Naver\uc758 GC\uc815\ub9ac\ub294 \ub098\ub9cc \uc77d\uace0 \uc2f6\uc740 Docs \uc911 \ud558\ub098  \\n[https://docs.oracle.com/javase/9/gctuning/garbage-first-garbage-collector.htm#JSGCT-GUID-0394E76A-1A8F-425E-A0D0-B48A3DC82B42](https://docs.oracle.com/javase/9/gctuning/garbage-first-garbage-collector.htm#JSGCT-GUID-0394E76A-1A8F-425E-A0D0-B48A3DC82B42)  \\n[https://www.oracle.com/technetwork/tutorials/tutorials-1876574.html](https://www.oracle.com/technetwork/tutorials/tutorials-1876574.html) g1gc"},{"id":"RateLimiter2","metadata":{"permalink":"/RateLimiter2","editUrl":"https://github.com/facebook/docusaurus/edit/main/website/blog/2022-05-01-02-Spring-cloud-gateway-2.md","source":"@site/blog/2022-05-01-02-Spring-cloud-gateway-2.md","title":"Request Rate Limiter\ub97c \ub9cc\ub4e4\uc5b4\ubcf4\uc790! 2\ud3b8","description":"Make Custom Rate Limiter With Spring Cloud Gateway 2","date":"2022-05-01T00:00:00.000Z","formattedDate":"May 1, 2022","tags":[{"label":"SCG","permalink":"/tags/scg"},{"label":"Spring Cloud Gateway","permalink":"/tags/spring-cloud-gateway"},{"label":"Rate Limiter","permalink":"/tags/rate-limiter"}],"readingTime":7.98,"truncated":true,"authors":[{"name":"Dongle","title":"Junior Backend Developer","url":"https://github.com/sk1737030","imageURL":"https://github.com/sk1737030.png","key":"dongle"}],"frontMatter":{"title":"Request Rate Limiter\ub97c \ub9cc\ub4e4\uc5b4\ubcf4\uc790! 2\ud3b8","description":"Make Custom Rate Limiter With Spring Cloud Gateway 2","slug":"RateLimiter2","authors":"dongle","tags":["SCG","Spring Cloud Gateway","Rate Limiter"],"image":"https://i.imgur.com/mErPwqL.png","hide_table_of_contents":false},"prevItem":{"title":"Container \ud658\uacbd\uc5d0\uc11c\uc758 JVM GC","permalink":"/container-gc"},"nextItem":{"title":"Request Rate Limiter\ub97c \ub9cc\ub4e4\uc5b4\ubcf4\uc790! 1\ud3b8","permalink":"/RateLimiter1"}},"content":"Rate Limiter\ub97c \ub9cc\ub4e4\uc5b4\ubcf4\uc790! 2\ud3b8\\n\x3c!--truncate--\x3e\\n\\n[\ubaa8\ub4e0 \uc18c\uc2a4](https://github.com/sk1737030/til/tree/master/./2022-05-01/spring-cloud-gateway-late-limiter)\ub294 \uc694\uae30\uc11c \ud655\uc778\uac00\ub2a5\ud569\ub2c8\ub2e4. :)  \\n\\n# Spring Cloud Gateway\ub97c \uc0ac\uc6a9\ud574\uc11c API Limiter \uad6c\ud604\uc744 \ud574\ubcf4\uc790! 2\ud3b8\\n\\n\uc55e\uc11c 1\ud3b8\uc5d0\uc11c \ubcf4\uc558\ub358 \uae30\ubcf8\ub3c4 \uc798 \uc4f8 \uc218 \uc788\uc73c\ub098, \uc870\uae08 \ub354 \ub098\uac00\uc11c ~~\uc544\uad6c\ubaac\uc774 \uc9c4\ud654\ud574\uc11c \uadf8\ub808\uc774\ubaac\uc774 \ub418\ub4ef\uc774~~ Custom\uc744 \uc870\uae08\ub9cc \ub354 \ud574\uc8fc\uba74 \ub098\ub984 \uad1c\ucc2e\uc740 RateLimiter\uac00 \ub420 \uc218 \uc788\ub2e4. \\n\\n## Custom Redis limiter\\n\uc55e\uc5d0\uc11c \uc0ac\uc6a9\ud588\ub358 Default Redis Limiter\ub294 \uc544\ub798 \uc694\uad6c\uc0ac\ud56d\uc744 \uad6c\ud604\ud558\uae30\uac00 \ud798\ub4e0\ub370\\n\\n1. \ud2b9\uc815 \uc0ac\uc6a9\uc790\uc758 \uc8fc\uc2dd \uc870\ud68c \uc694\uccad\uc744 \ubd84\ub2f9 1\ubc88\uc73c\ub85c \uc124\uc815\uc744 \ud558\uace0 \uc8fc\uc2dd \uc8fc\ubb38\uc744 \ucd08\ub2f9 1\ubc88\ub9cc \uac00\ub2a5\ud558\ub2e4\ub358\uc9c0 \\n2. \uc18d\ub3c4 \ubb38\uc81c\ub85c \ubcf5\uc7a1\ud558\uace0 \ub9ac\uc18c\uc2a4\uac00 \ub9ce\uc774 \ub4dc\ub294 \uc694\uccad\uc77c \uacbd\uc6b0 \ubd84\ub2f9 1\ubc88\ub9cc \uc694\uccad\ud558\uac8c \ud55c\ub2e4\ub358\uc9c0 \\n3. \uc9c0\uae08 redis\uc5d0\ub294 timestamp\uc640 tokenKey 2\uac1c\ub9cc \ub4e4\uc5b4\uac00 \uc788\ub294\ub370 \ub2e4\ub978 \ucd94\uac00\uc801\uc778 \uc815\ubcf4\ub3c4 \ub123\uace0 \uc2f6\ub2e4\ub4e0\uc9c0\\n4. Redis TTL\ub97c \ub354 \uae38\uac8c \uc7a1\ub294\ub2e4\ub4e0\uc9c0\\n5. User \ubcc4\ub85c \uc694\uccad\ub7c9\uc744 \ub2e4\ub974\uac8c \ud558\uace0 \uc2f6\ub2e4\ub4e0\uc9c0\\n   \\n\uc774\ub7ec\ud55c \uc694\uad6c\uc0ac\ud56d\ub4e4\uc744 \ub4e4\uc5b4\uc8fc\ub294 API Limiter\ub97c \ub2e8\uc21c\ud558\uba74\uc11c \uac04\ub2e8\ud558\uac8c(~~\ud3c9\ubc94\ud558\uba74\uc11c\ub3c4 \uc6b0\uc544\ud558\ub77c\uace0 \uc6b0\ub9ac\ub124 \ud074\ub77c\uc774\uc5b8\ud2b8\uac00 \uc2e4\uc81c\ub85c \ub4e4\uc740 \ub9d0~~) \uad6c\ud604\uc744 \ud55c \ubc88 \ud574\ubcf4\uc790. \\n\\n### Custom\\n\\n\uba3c\uc800 \uc6b0\ub9ac\ub294 \uc798 \uad6c\ud604\ub418\uc5b4\uc788\ub294`RedisRateLimiter`\ub97c \uc0c1\uc18d\ubc1b\uc544\uc11c \uc0ac\uc6a9\ud55c\ub2e4.\\n\\n```java title=\\"CustomRedisRateLimiter.java\\"\\n@Configuration\\n@Slf4j\\npublic class CustomRedisRateLimiter extends RedisRateLimiter {\\n\\t...\\n}\\n```\\n\\n\ub9cc\uc57d **User** \ubcc4\ub85c \uc694\uccad\ub7c9\uc744 \ub2e4\ub974\uac8c \ud55c\ub2e4\uba74 \uc6b0\ub9ac\ub294 \uc218\uc815\ud574\uc57c \ud560 \uba54\uc11c\ub4dc\uac00 \ud06c\uac8c \ub450 \uac1c\uac00 \uc788\ub294\ub370  \\n\uba3c\uc800 **isAllowed**, **loadConfiguration** \uc774 \ub450 \uac1c\uc758 \uba54\uc11c\ub4dc\ub97c \uc218\uc815\ud574\uc57c \ud55c\ub2e4.\\n\\n```java title=\\"CustomRedisRateLimiter.java\\"\\n@Configuration\\n@Slf4j\\npublic class CustomRedisRateLimiter extends RedisRateLimiter {\\n    ...\\n    \\n    private final Config userAConfig = new Config().setBurstCapacity(10).setReplenishRate(1).setRequestedTokens(1);\\n    private final Config commonUserConfig = new Config().setBurstCapacity(1).setReplenishRate(1).setRequestedTokens(1);\\n\\n    @Override\\n    public Mono<Response> isAllowed(String routeId, String id) {\\n        Config routeConfig = loadConfiguration(routeId, id);\\n\\n        int replenishRate = routeConfig.getReplenishRate();\\n        int burstCapacity = routeConfig.getBurstCapacity();\\n        int requestedTokens = routeConfig.getRequestedTokens();\\n\\n        try {\\n            List<String> keys = getKeys(id);\\n\\n            List<String> scriptArgs = Arrays.asList(replenishRate + \\"\\", burstCapacity + \\"\\", \\"\\", requestedTokens + \\"\\");\\n            Flux<List<Long>> flux = redisTemplate.execute(this.script, keys, scriptArgs);\\n            return flux.onErrorResume(throwable -> {\\n                if (log.isDebugEnabled()) {\\n                    log.debug(\\"Error calling rate limiter lua\\", throwable);\\n                }\\n                return Flux.just(Arrays.asList(1L, -1L));\\n            }).reduce(new ArrayList<Long>(), (longs, l) -> {\\n                longs.addAll(l);\\n                return longs;\\n            }).map(results -> {\\n                boolean allowed = results.get(0) == 1L;\\n                Long tokensLeft = results.get(1);\\n\\n                Response response = new Response(allowed, getHeaders(routeConfig, tokensLeft));\\n\\n                if (log.isDebugEnabled()) {\\n                    log.debug(\\"response: \\" + response);\\n                }\\n                return response;\\n            });\\n        } catch (Exception e) {\\n            log.error(\\"Error determining if user allowed from redis\\", e);\\n        }\\n\\n        return Mono.just(new Response(true, getHeaders(routeConfig, -1L)));\\n    }\\n\\n    Config loadConfiguration(String routeId, String key) {\\n        if (key.equals(\\"demo1234\\")) {\\n            return getConfig().getOrDefault(routeId + key, userAConfig);\\n        }\\n        return getConfig().getOrDefault(routeId, commonUserConfig);\\n\\n    }\\n}\\n```\\n\\n\uc6b0\ub9ac\uac00 \uc55e\uc5d0\uc11c `UserKeyResolver`\uc5d0\uc11c \uc124\uc815\ud55c `key`\uac00 \ub4e4\uc5b4\uc624\uac8c \ub418\ub294\ub370, \uc774 \ud0a4\ub97c \uac00\uc9c0\uace0 \uc81c\ud55c\ud558\uace0\uc790 \ud558\ub294 \uc694\uccad\ub7c9\uc744 \uba3c\uc800 Config\ub97c \uc8fc\uc785\ud558\uba74 \ub05d\uc774\ub2e4.\\n\\n\\n```java title=\\"CustomRedisRateLimiter.java\\"\\n@Configuration\\n@Slf4j\\npublic class CustomRedisRateLimiter extends RedisRateLimiter {\\n\\n    private final Config userAConfig = new Config().setBurstCapacity(10).setReplenishRate(1).setRequestedTokens(1);\\n    private final Config commonUserConfig = new Config().setBurstCapacity(1).setReplenishRate(1).setRequestedTokens(1);\\n    private ReactiveStringRedisTemplate redisTemplate;\\n\\n    private RedisScript<List<Long>> script;\\n\\n    @Autowired\\n    public CustomRedisRateLimiter(ReactiveStringRedisTemplate redisTemplate, RedisScript<List<Long>> script,\\n        ConfigurationService configurationService) {\\n        super(redisTemplate, script, configurationService);\\n        this.redisTemplate = redisTemplate;\\n        this.script = script;\\n    }\\n\\n    public CustomRedisRateLimiter(int defaultReplenishRate, int defaultBurstCapacity) {\\n        super(defaultReplenishRate, defaultBurstCapacity);\\n    }\\n\\n    public CustomRedisRateLimiter(int defaultReplenishRate, int defaultBurstCapacity, int defaultRequestedTokens) {\\n        super(defaultReplenishRate, defaultBurstCapacity, defaultRequestedTokens);\\n    }\\n\\n    static List<String> getKeys(String id) {\\n        String prefix = \\"request_rate_limiter.{\\" + id;\\n        String tokenKey = prefix + \\"}.tokens\\";\\n        String timestampKey = prefix + \\"}.timestamp\\";\\n        return Arrays.asList(tokenKey, timestampKey);\\n    }\\n\\n    @Override\\n    public Mono<Response> isAllowed(String routeId, String id) {\\n        Config routeConfig = loadConfiguration(routeId, id);\\n\\n        int replenishRate = routeConfig.getReplenishRate();\\n        int burstCapacity = routeConfig.getBurstCapacity();\\n        int requestedTokens = routeConfig.getRequestedTokens();\\n\\n        try {\\n            List<String> keys = getKeys(id);\\n\\n            List<String> scriptArgs = Arrays.asList(replenishRate + \\"\\", burstCapacity + \\"\\", \\"\\", requestedTokens + \\"\\");\\n            Flux<List<Long>> flux = redisTemplate.execute(this.script, keys, scriptArgs);\\n            return flux.onErrorResume(throwable -> {\\n                if (log.isDebugEnabled()) {\\n                    log.debug(\\"Error calling rate limiter lua\\", throwable);\\n                }\\n                return Flux.just(Arrays.asList(1L, -1L));\\n            }).reduce(new ArrayList<Long>(), (longs, l) -> {\\n                longs.addAll(l);\\n                return longs;\\n            }).map(results -> {\\n                boolean allowed = results.get(0) == 1L;\\n                Long tokensLeft = results.get(1);\\n\\n                Response response = new Response(allowed, getHeaders(routeConfig, tokensLeft));\\n\\n                if (log.isDebugEnabled()) {\\n                    log.debug(\\"response: \\" + response);\\n                }\\n                return response;\\n            });\\n        } catch (Exception e) {\\n            log.error(\\"Error determining if user allowed from redis\\", e);\\n        }\\n\\n        return Mono.just(new Response(true, getHeaders(routeConfig, -1L)));\\n    }\\n\\n    Config loadConfiguration(String routeId, String key) {\\n        if (key.equals(\\"demo1234\\")) {\\n            return getConfig().getOrDefault(routeId + key, userAConfig);\\n        }\\n        return getConfig().getOrDefault(routeId, commonUserConfig);\\n\\n    }\\n}\\n```\\n\\n\uadf8\ub9ac\uace0 `application.yml` \ud30c\uc77c\uc5d0 `rate-limitter` `customRedisRateLimiter`\ub97c \ucd94\uac00\ud574\uc900\ub2e4.\\n\\n```yml title=\\"application.yaml\\"\\nspring:\\n...\\n- name: RequestRateLimiter\\n    args:\\n        rate-limitter: \\"#{@customRedisRateLimiter}\\"\\n        key-resolver: \\"#{@apiKeyResolve}\\"\\n```\\n\\n### \uacb0\uacfc\\n\\n`Get localhost:18080/demo?userId=demo1234` \\n\\n![Untitled](./2022-05-01/spring-cloud-gateway/Untitled%206.png)\\n\\nRequest \uc694\uccad \uc2dc \uc704\uc5d0 \uc124\uc815\ud55c userAConfig\uc5d0 \ub9de\uac8c \uc751\ub2f5 \uac12\uc774 \ub3cc\uc544\uc624\uac8c \ub41c\ub2e4.\\n\\n`Get localhost:18080/demo?userId=test` \\n\\n![Untitled](./2022-05-01/spring-cloud-gateway/Untitled%207.png)\\n\\n `Remaining` \ubcf4\ub2e4 \uc694\uccad\uc744 \ub354 \ub9ce\uc774 \ud558\uac8c \ub418\uba74 `429 Too Many Request` \uac00 \uc751\ub2f5\uc73c\ub85c \uc624\uac8c \ub41c\ub2e4.\\n\\n![Untitled](./2022-05-01/spring-cloud-gateway/Untitled%208.png)\\n\\n\ucd94\uac00\ud574\ub3c4 \uc88b\uc744\ub9cc\ud55c \uc635\uc158\uc774 \uc788\ub294\ub370, \ub9cc\uc57d \ub2e4\uc591\ud55c \uc774\uc720\ub85c \uc694\uccad\uc744 \uac70\uc808\ud558\uace0 \uc2f6\uc744 \ub54c \uc608\ub97c \ub4e4\uc5b4 \ud5e4\ub354\uc5d0 \uc57d\uc18d\ub41c \uac12\uc774 \uc5c6\uac70\ub098 \ub4f1\\n\uadf8\ub7f4 \ub54c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \uc635\uc158\uc774 `deny-empty-key`\ub77c\ub294 \uc635\uc158\uc774\ub2e4. (default true)\uc774\ub2e4.  \\n\uc774 \uc635\uc158\uc744 \uc0ac\uc6a9\ud558\uae30 \uc704\ud574\uc11c **____EMPTY_KEY__** \uc744 \ub4a4\ub85c \ub118\uaca8\uc8fc\uac8c \ub418\uba74 `FORBIDDEN` \uc751\ub2f5\uc73c\ub85c \ub3cc\ub824\uc8fc\uac8c \ub41c\ub2e4.\\n\\n```java title=\\"UserKeyResolver.java\\"\\n@Bean\\npublic KeyResolver apiKeyResolve() {\\n    if (!exchange.getRequest().getQueryParams().containsKey(\\"userId\\")) {\\n          return Mono.just(\\"____EMPTY_KEY__\\");\\n    }\\n\\n    return Mono.just(exchange.getRequest().getQueryParams().getFirst(\\"userId\\"));\\n}\\n```\\n\\n<br/>\\n\\n![Untitled](./2022-05-01/spring-cloud-gateway/Untitled%209.png)\\n\\n### \uc815\ub9d0 \uc798 \uc791\ub3d9\ud560\uae4c?\\n\\n\uc774 \ubd80\ubd84\uc744 \ud655\uc778\ud558\uae30 \uc704\ud574\uc11c \uc9e7\uc740 \uc2dc\uac04\uc5d0 \ub9ce\uc740 \ubd80\ud558 \ud14c\uc2a4\ud2b8\ub97c \ud574 \ubcfc \uac83\uc774\ub2e4. \uac04\ub2e8\ud558\uac8c [k6](https://k6.io/) \ubd80\ud558 \ud14c\uc2a4\ud2b8 \ub3c4\uad6c\ub97c \uc774\uc6a9\ud574\uc11c  \ud14c\uc2a4\ud2b8\ub97c \ud574 \ubcfc \uac81\ub2c8\ub2e4. \\n\\n\uc870\uac74 \ucd08\ub2f9 1\ud68c \uc694\uccad\uc744 \uac00\ub2a5\ud55c\uc9c0\ub97c \ud14c\uc2a4\ud2b8\ud55c\ub2e4\uba74\\n\\nlimiter \uc124\uc815  \\n`requestedTokens` 1  \\n`burstCapacity` 1  \\n`replenishRate` 1 \\n\\nk6/loadtest.js\\n\\n```js title=\\"loadtest.js\\"\\nimport http from \'k6/http\';\\nimport { check, group, sleep } from \'k6\';\\n\\nexport const options = {\\n    duration: \'10s\',\\n    vus: \'1\',\\n};\\n\\nconst BASE_URL = \'http://localhost:18080\';\\n\\nexport default () => {\\n    const limiter = http.get(`${BASE_URL}/demo?userId=test`);\\n\\n    check(limiter, {\\n        \'success limitter \': (resp) => resp.status === 200\\n    });\\n};\\n```\\n\\n\uc815\ub9d0 \uac04\ub2e8\ud55c \uc2a4\ud06c\ub9bd\ud2b8\ub85c \ubcf4\uba74 \uc54c\uaca0\uc9c0\ub9cc  \\n10\ucd08 \ub3d9\uc548 get\uc694\uccad\uc744 \ud55c\ub2e4\ub294 \uc2a4\ud06c\ub9bd\ud2b8\uc774\uace0, \uacb0\uacfc\ub85c 200\uc77c \uacbd\uc6b0 \uc131\uacf5\uc73c\ub85c \ubcf4\uaca0\ub2e4\ub294 \uac83\uc774\ub2e4.\\n\\n### \uacb0\uacfc  \\n\\n![Untitled](./2022-05-01/spring-cloud-gateway/Untitled%2010.png)\\n\\n11\ubc88\uc758 \uc694\uccad\uc774 \uc131\uacf5\uc801\uc73c\ub85c 200\uc73c\ub85c return \ub418\uc5c8\uace0, 6045\ubc88\uc774 \uc2e4\ud328\ud55c \ub0b4\uc5ed\uc774\ub2e4.\\n\\n## \uc774\uc0c1\uc73c\ub85c\\n\\n\uc774\ub807\uac8c \uac04\ub2e8\ud558\uac8c `RateLimiter`\ub97c \uad6c\ud604\uc744 \ud574\ubcf4\uc558\ub294\ub5bc, \ucc98\uc74c\uc5d0\ub294 \uad6c\ud604\uc744 \uc5b4\ub5bb\uac8c \ud558\uc9c0\ub77c\uba70 \uace0\ubbfc\uc744 \ud558\uc600\ub294\ub370,  \\nRedis\ub97c \ub044\uc801\ub044\uc801\uc774\uba70 \uad6c\ud604 \uc911\uc5d0 (~~Watch\uc640 Multi\uc640 \ud568\uaed8\ub77c\uba74),~~  \\nSpring \uc9c4\uc601\uc5d0 \uc798 \uad6c\ud604\uc774 \ub418\uc5b4 \uc788\uc5b4\uc11c \uc27d\uac8c \uac00\uc838\uc640\uc11c \uc694\uad6c\uc0ac\ud56d\uc5d0 \ub9de\uac8c \uc0ac\uc6a9\uc744 \ud588\uc5c8\ub2e4.  \\n\uc774\ubbf8 \uc798 \ub9cc\ub4e4\uc5b4\uc838\uc11c \uc5ed\ud560\uc744 \uc798\ud558\uace0 \uc788\uc73c\uba74 \ube60\ub974\uac8c \uc798 \uc0ac\uc6a9\ud558\ub294 \uac8c \uc5b4\ub824\uc6b4 \uac70\uad6c\ub098 \ub2e4\uc2dc\uae08 \ub290\uaf08\ub2e4.\\n\\n### \ucd94\uac00\ub85c \ud55c \ubc88 \uace0\ubbfc\ud574\uc57c \ud560 \ubd80\ubd84\\n\\nGateway\uc5d0\uc11c Request body\ub97c \uc77d\uc5b4\uc11c \ubb34\uc5b8\uac00\ub97c \ucc98\ub9ac \ud55c \ud6c4\uc5d0 \ub2e4\uc74c Filter\ub85c \ub118\uaca8 \uc904 \ub54c\uc5d0\ub294 \uace0\ubbfc\uc744 \ud574\ubd10\uc57c\ud558\ub294\ub370,  \\n\uc798 \uc54c\ub2e4\uc2dc\ud53c Servlet Request Body\ub97c Filter\uc5d0\uc11c \ud55c \ubc88 \uc77d\uc73c\uba74,  \\n\ub2e4\uc2dc \ub4a4\uc5d0\uc11c body\ub97c \ubabb \uc77d\ub294\ub2e4\ub294 \ubb38\uc81c\uac00 \uc788\ub2e4.  \\n\uc774 \ubd80\ubd84\uc740 \ud55c \ubc88 \uc77d\uace0 body\ub97c \uce90\uc2f1 \ud574\uc11c \ub2e4\uc2dc body\ub97c \ub123\uc5b4\uc8fc\ub294 \ucd94\uac00 \uc791\uc5c5\uc774 \ud544\uc694\ud558\ub2e4.\\n\\n### \ucc38\uace0\\n\\n[\uac00\uc0c1 \uba74\uc811 \uc0ac\ub840\ub85c \ubc30\uc6b0\ub294 \ub300\uaddc\ubaa8 \uc2dc\uc2a4\ud15c \uc124\uacc4](http://www.yes24.com/Product/Goods/102819435)  \\n[Spring Cloud gateway Docs](https://docs.spring.io/./2022-05-01/spring-cloud-gateway/docs/current/reference/html/)  \\n[https://redis.io/docs/manual/programmability/eval-intro/](https://redis.io/docs/manual/programmability/eval-intro/)"},{"id":"RateLimiter1","metadata":{"permalink":"/RateLimiter1","editUrl":"https://github.com/facebook/docusaurus/edit/main/website/blog/2022-05-01-Spring-cloud-gateway-1.md","source":"@site/blog/2022-05-01-Spring-cloud-gateway-1.md","title":"Request Rate Limiter\ub97c \ub9cc\ub4e4\uc5b4\ubcf4\uc790! 1\ud3b8","description":"Make Custom Rate Limiter With Spring Cloud Gateway 1","date":"2022-05-01T00:00:00.000Z","formattedDate":"May 1, 2022","tags":[{"label":"SCG","permalink":"/tags/scg"},{"label":"Spring Cloud Gateway","permalink":"/tags/spring-cloud-gateway"},{"label":"Rate Limiter","permalink":"/tags/rate-limiter"}],"readingTime":7.7,"truncated":true,"authors":[{"name":"Dongle","title":"Junior Backend Developer","url":"https://github.com/sk1737030","imageURL":"https://github.com/sk1737030.png","key":"dongle"}],"frontMatter":{"title":"Request Rate Limiter\ub97c \ub9cc\ub4e4\uc5b4\ubcf4\uc790! 1\ud3b8","description":"Make Custom Rate Limiter With Spring Cloud Gateway 1","slug":"RateLimiter1","authors":"dongle","tags":["SCG","Spring Cloud Gateway","Rate Limiter"],"image":"https://i.imgur.com/mErPwqL.png","hide_table_of_contents":false},"prevItem":{"title":"Request Rate Limiter\ub97c \ub9cc\ub4e4\uc5b4\ubcf4\uc790! 2\ud3b8","permalink":"/RateLimiter2"}},"content":"SCG\uc640 \ud568\uaf10 \uac04\ub2e8\ud55c Api Limiter\ub97c \uad6c\ud604\ud574\ubcf4\uc790! 1\ud3b8\\n\x3c!--truncate--\x3e\\n\\n[\ubaa8\ub4e0 \uc18c\uc2a4](https://github.com/sk1737030/til/tree/master/./2022-05-01/spring-cloud-gateway-late-limiter)\ub294 \uc694\uae30\uc11c \ud655\uc778\uac00\ub2a5\ud569\ub2c8\ub2e4. :)  \\n\\n# Spring Cloud Gateway\ub97c \uc0ac\uc6a9\ud574\uc11c API Limiter \uad6c\ud604\uc744 \ud574\ubcf4\uc790! 1\ud3b8\\n## Api Limitier\uac00 \ud544\uc694\ud55c \uc774\uc720?\\n\\nlimiter\ub294 \uc65c \ud544\uc694\ud560\uae4c\ub97c \uba3c\uc800 \uc0dd\uac01\ud574\ubcf4\uba74 \ub2e4\uc591\ud55c \uc774\uc720\uac00 \uc788\uaca0\uc9c0\ub9cc, \uc815\ub9d0 \uac04\ub2e8\ud558\uac8c \uc0dd\uac01\ud574\ubcf4\uba74 10\ucd08 \uac78\ub9ac\ub294 \ud5e4\ube44\ud55c api\uac00 \uc788\uc744 \ub54c client\ub4e4\uc774 \uc9e7\uc740 \uc2dc\uac04\uc5d0 API\ub97c \ubb34\ubd84\ubcc4\ud558\uac8c \uc694\uccad\ud558\uac8c \ub418\uba74 \uc6b0\ub9ac\uc758 \uc11c\ubc84\ub294 ~~\ub054\ucc0d\ud55c \uacb0\ub9d0~~\uc744 \ub9de\uac8c \ub420 \uac83\uc774\ub2e4.\\n\uc800\ub7f0 \ub2e8\uc21c\ud55c \uc774\uc720\ub9d0\uace0\ub3c4 \uc0ac\uc6a9\uc790\ubcc4 \ucc28\ub4f1(A \uc0ac\uc6a9\uc790\ub294 \ucd08\ub2f9 3\ubc88 \uc694\uccad, B \uc0ac\uc6a9\uc790\ub294 \ucd08\ub2f9 30\ubc88 \uc694\uccad)\uc744 \uc904 \uc218\ub3c4 \uc788\uace0 \ub4f1\ub4f1 \uc5ec\ub7ec \uac00\uc9c0 \uc774\uc810\uc774 \uc0dd\uae34\ub2e4. ~~\uadf8\ub7ec\ubbc0\ub85c \uc815\ub9d0 \uaf2d \ud558\ub098\ucbe4\uc740 \uc774\ucc38\uc5d0 \uc7a5\ub9cc\ud558\uc2dc\ub294 \uac8c~~\\n\\n\uc5ec\ub7ec \ub2e4\ub978 \ubc29\ubc95\uc73c\ub85c\ub3c4 api limiter\ub97c apllicaiton \ub2e8\uc5d0\uc11c \uad6c\ud604\ud560 \uc218 \uc788\uaca0\uc9c0\ub9cc,  \ube60\ub974\uace0 \uc815\ud655\ud558\uace0 serializable\ud558\uac8c  Api Limiter\ub97c \uad6c\ud604\ud558\ub294 \uac74 \uc815\ub9d0 \ud558\ub098\ubd80\ud130 \uc5f4\uae4c\uc9c0 \uc0dd\uac01\ud574\uc57c \ud560 \uac8c \ub9ce\uace0 **\ub108\ubb34 \uc5b4\ub835\ub2e4**(~~\ub098\uc5d0\uac8c\ub294~~). \\n\\n\uadf8\ub807\ub2e4\uba74, \uc5b4\ub5bb\uac8c \uc870\uae08 \uc27d\uac8c \uad6c\ud604\ud560 \uc218 \uc788\ub294\uac00\ub97c \ucc3e\uc544\ubcf4\uba74!!  \\n\\n**[\uac00\uc0c1 \uba74\uc811 \uc0ac\ub840\ub85c \ubc30\uc6b0\ub294 \ub300\uaddc\ubaa8 \uc2dc\uc2a4\ud15c \uc124\uacc4 \uae30\ucd08\ub77c\ub294 \ucc45\uc5d0\uc11c](http://www.yes24.com/Product/Goods/102819435)**  \ud78c\ud2b8\ub97c \uc5bb\uc744 \uc218 \uc788\ub294\ub370, \\n\ud575\uc2ec\uc740 `Redis + Lua Script`\ub97c \uc0ac\uc6a9\ud558\uc5ec \uad6c\ud604\ud558\ub294 \uac83\uc774\ub2e4.\\n\\n\\n:::note\uc65c Lua Script\uc77c\uae4c??\\nRedis Document\uc5d0\uc11c \ucc3e\uc744 \uc218 \uc788\ub294\ub370, \ub8e8\uc544 \uc2a4\ud06c\ub9bd\ud2b8\uac00 \uc2e4\ud589\ub418\ub294 \ub3d9\uc548 \uc77c\ub2e8 \ub808\ub514\uc2a4\ub294 blocked \uc0c1\ud0dc\uac00 \ub41c\ub2e4. \uc989 \ub808\ub514\uc2a4\ub294 \ub8e8\uc544 \uc2a4\ud06c\ub9bd\ud2b8\uac00 atomic \ud558\uac8c \uc2e4\ud589\ud558\ub294 \uac78 \ubcf4\uc7a5\ud558\uae30 \ub54c\ubb38\uc5d0 RateLimite\ub97c \uad6c\ud604\ud560 \uc218 \uc788\uac8c \ub41c\ub2e4.\\n:::note\\n\\n\uadf8\ub807\ub2e4\uba74, \uc815\ub9d0 \uc870\uae08\ub9cc \ub354\uc6b1\ub354 \uc695\uc2ec\uc744 \ub0b4\uc11c \uc694\uc998\uac19\uc774 \ub300 MS \uc2dc\ub300\uc5d0 \uc5ec\ub7ec Applicaiton\uc5d0 Route \uc5ed\ud560\ub3c4 \ud558\uace0 Gateway \uc5ed\ud560\ub3c4 \ud558\uba74\uc11c \uac70\uae30\uc5d0 \ub354\ud558\uc5ec Limiter\uae4c\uc9c0 \uc9c0\uc6d0\ud55c\ub2e4\uba74 \uc5bc\ub9c8\ub098 \uc88b\uc744\uae4c? \\n\uadfc\ub370 \uadf8\ub7f0 \ud314\ubc29\ubbf8\uc778\uc758 \ubb34-\uce5c \uce90\ub9ac\uba38\uc2e0\uc774 \uc788\uc73c\ub2c8\\n\\n## [Spring Cloud Gateway](https://docs.spring.io/./2022-05-01/spring-cloud-gateway/docs/2.2.9.RELEASE/reference/html/)\\n\\nSpring Cloud Gateway\ub97c \uc815\ub9d0 \uc815-\ub9d0 \uac04\ub2e8\ud558\uac8c  \uc18c\uac1c\ud558\uba74 \uadf8\ub0e5 Gateway \uc5ed\ud560\uc744 \ud55c\ub2e4.\\n\\n\uc6b0\ub9ac\uc758 \uc704\ud0a4\uc5d0\ub294 Gateway\ub97c \uc124\uba85 \uc798\ud574\ub1a8\ub294\ub370, **\uac8c\uc774\ud2b8\uc6e8\uc774**\ub294 \ucef4\ud4e8\ud130 \ub2e4\ub978 \ub124\ud2b8\uc6cc\ud06c\ub85c \ub4e4\uc5b4\uac00\ub294 \uc785\uad6c \uc5ed\ud560\uc744 \ud558\ub294 \ub124\ud2b8\uc6cc\ud06c \ud3ec\uc778\ud2b8\uc774\ub2e4. \ub113\uc740 \uc758\ubbf8\ub85c\ub294 \uc885\ub958\uac00 \ub2e4\ub978 \ub124\ud2b8\uc6cc\ud06c \uac04\uc758 \ud1b5\ub85c\uc758 \uc5ed\ud560\uc744 \ud558\ub294 \uc7a5\uce58\uc774\ub2e4. \uc27d\uac8c \uc608\ub97c \ub4e4\uc790\uba74 \ud574\uc678\uc5ec\ud589\uc744 \ub4e4 \uc218 \uc788\ub294\ub370 \ud574\uc678\ub85c \ub098\uac00\uae30 \uc704\ud574\uc11c \uaf2d \ud1b5\uacfc\ud574\uc57c \ud558\ub294 \uacf5\ud56d\uc774 \uac8c\uc774\ud2b8\uc6e8\uc774\uc640 \uac19\uc740 \uac1c\ub150\uc774\ub2e4. MSA\ud658\uacbd\uc5d0\uc11c \uc815\ub9d0 \ube7c\ub193\uc744 \uc218 \uc5c6\ub294 \uad6c\ud604\ud574\uc57c \ud560 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uc911 \ud558\ub098\uc774\ub2e4.\\n\\n\ub300\ud45c\uc801\uc778 \uae30\ub2a5\uc73c\ub85c \uc5ec\ub7ec \uac00\uc9c0\uac00 \uc788\uc9c0\ub9cc \ub0b4\uac00 \uc0ac\uc6a9\ud558\ub294 \uae30\ub2a5\ub4e4\ub9cc \ucd94\ub9ac\uba74  \\n- Router \uc5ed\ud560\\n- \uac01\uc885 Filter\\n- LB \uae30\ub2a5\\n- Security\\n\\n\ub4f1\ub4f1 \uc9c4\uc9dc \uc218\ub9ce\uc740 \uae30\ub2a5\uc744 \uc81c\uacf5\ud558\uace0 \uc788\uc73c\ub2c8 \uc54c\uc544\ubcf4\uba74 \ub098\uc911\uc5d0 \ud55c \ubc88\uc529 \uc368\uba39\uac8c\ub41c\ub2e4. \\n\\n\uadf8 \uc911 Gateway Filter \uc911\uc5d0 RequestRateLimiter \ub77c\ub294 \ub140\uc11d\uc774 \uc788\ub294\ub370 \uc774 \ub140\uc11d\uc744 \uc798 \uc368\uba39\uc73c\uba74 \uc190 \ud55c \ubc88 \uae4c\ub531\uc73c\ub85c Api Limiter\uac00 \uc9dc\ub780 \uad6c\ud604\uc774\ub41c\ub2e4.\\n\\n## Spring Gateway Limiter\\n\\n\uae30\ubcf8\uc801\uc73c\ub85c Spring Gateway\ub294 RateLimite\ub97c Redis\uc640 lua\ub97c \uc0ac\uc6a9\ud558\uc5ec \uad6c\ud604\uc744\ud574\ub1a8\ub294\ub370 \uc6b0\ub9ac\ub294 \uc774\uac78\ub85c \uc0ac\uc6a9\ud558\uae30\ub9cc \ud558\uba74 \ub41c\ub2e4. \\n\\n```groovy title=\\"build.gradle\\"\\next {\\n    set(\'springCloudVersion\', \\"2020.0.5\\")\\n}\\n\\ndependencies {\\n    implementation \'org.springframework.cloud:spring-cloud-starter-gateway\'\\n    implementation \'org.springframework.boot:spring-boot-starter-data-redis-reactive\'\\n    runtimeOnly \'com.h2database:h2\'\\n\\n    testImplementation \'org.springframework.boot:spring-boot-starter-test\'\\n    testImplementation \'org.junit.jupiter:junit-jupiter:5.7.1\'\\n}\\n\\ndependencyManagement {\\n    imports {\\n        mavenBom \\"org.springframework.cloud:spring-cloud-dependencies:${springCloudVersion}\\"\\n    }\\n}\\n\\ntasks.named(\'test\') {\\n    useJUnitPlatform()\\n}\\n```\\n\\n<br/>\\n\\n### \uae30\ubcf8 \uad6c\ud604\\n\\n```java\\n@Configuration\\npublic class CustomUserKeyResolver() {\\n\\t@Bean\\n\\tKeyResolver userKeyResolver() {\\n\\t\\treturn exchange -> Mono.just(exchange.getRequest().getQueryParams().getFirst(\\"userId\\"));\\t\\n\\t}\\n}\\n```\\n\\nkeyResolver\ub97c \uc138\ud305\uc744 \uba3c\uc800 \ud574\uc900\ub2e4.  \\nreturn\ud574\uc8fc\ub294 key\ub97c \uac00\uc9c0\uace0 \ub4a4\uc5d0\uc11c \uad6c\ubd84\uc744 \ud558\ubbc0\ub85c \ud544\uc218\uc801\uc73c\ub85c \uad6c\ud604\uc744 \ud574\uc57c \ud55c\ub2e4.  \\ngetParameter\ub85c userId\uac00 \ub4e4\uc5b4\uc628\ub2e4\ub294 \uac00\uc815\ud558\uc5d0 \uad6c\ud604\ud558\uc600\ub2e4.\\n\\n\\n\\n```yaml title=\\"application.yml\\"\\nspring:\\n  cloud:\\n    gateway:\\n      routes:\\n      - id: rate_limiter_route\\n        uri: http://localhost:19000\\n        filters:\\n        - name: RequestRateLimiter\\n          args:\\n            key-resolver: \\"#{@userKeyResolver}\\"\\n            redis-rate-limiter.replenishRate: 1\\n            redis-rate-limiter.burstCapacity: 10\\n            redis-rate-limiter.requestedTokens: 1\\n```\\n\\n`key-resolver` \uc6b0\ub9ac\uac00 \uc120\uc5b8\ud55c bean\uc774\ub984\uc744 \uc8fc\uc785 \ud574 \uc900\ub2e4.  \\n`requestedTokens` \uc694\uccad\uc2dc\uc5d0 \uc18c\ubaa8\ub418\ub294 \ud1a0\ud070\uc758 \uac1c\uc218  \\n`burstCapacity` \ubc84\ud0b7\uc758 \ub2f4\uaca8\uc838\uc788\ub294 \ucd5c\ub300\ub7c9  \\n`replenishRate` \ucd08\ub2f9 \ubc84\ud0b7 \ud68c\ubcf5\ub7c9   \\n\\n<br/>\\n\\n:::noteRateLimiter \uc54c\uace0\ub9ac\uc998\\n  `[Token bucket` \uc54c\uace0\ub9ac\uc998\uc744](https://dev.to/satrobit/rate-limiting-using-the-token-bucket-algorithm-3cjh) \ub530\ub978\ub2e4.\\n:::note\\n\\n<br/>\\n\\n\uc124\uc815\uc744 \ub2e4 \ud588\uc73c\ub2c8 \ud55c \ubc88 \uc694\uccad\uc744 \ud574\ubcf4\uba74\\n\\n![Untitled](./2022-05-01/spring-cloud-gateway/Untitled%201.png)\\n\\n\uc124\uc815\ud55c burstCapacity 10 \uc5d0\uc11c -1 \uc774 \ub41c 9\uac00 remain\uc73c\ub85c header\uc5d0 \uc751\ub2f5\uc774 \uc624\uac8c \ub41c\ub2e4.  \\n\ub3cc\uc544\uc624\ub294 \uc751\ub2f5 \ud5e4\ub354\uac00 \uad81\uae08\ud558\uba74 `RedisRateLimiter` \uc5d0 \uc120\uc5b8\ub418\uc5b4\uc788\ub294 Header\uc5d0\uc11c \ucd94\uac00\ub85c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.\\n\\n![Untitled](./2022-05-01/spring-cloud-gateway/Untitled%202.png)\\n<br/>\\n\\n### \uadf8\ub807\ub2e4\uba74 \ub808\ub514\uc2a4\uc5d0 \uc800\uc7a5\uc740 \uc5b4\ub5bb\uac8c\ub420\uae4c\u2753\\n\\n\uc77c\ub2e8 \ub808\ub514\uc2a4\uc5d0 \uc800\uc7a5\ub418\ub294 \ub370\uc774\ud130 \uc14b\uc744 \ubcf8\ub2e4\uba74  \\n![redis data](./2022-05-01/spring-cloud-gateway/Untitled%203.png)\\n\\n\uc65c \uc774\ub807\uac8c \uc800\uc7a5\ub418\ub294\uc9c0\ub294 `RedisRateLimiter.java`\uc5d0 `getKeys`\ub77c\ub294 \uba54\uc18c\ub4dc\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\ub294\ub370 \\n\\n![Untitled](./2022-05-01/spring-cloud-gateway/Untitled%204.png)\\n<br/><br/><br/>\\n\\n\uc774\uc0c1\uc73c\ub85c \uc6b0\ub9ac\uc758 \ub808\ub514\uc2a4\ub97c \ud65c\uc6a9\ud55c ~~\uc6b0\uc544\ud558\uace0 \uae54\ub054\ud55c~~ **RateLimiter**\uac00 \uc644\uc131\ub410\ub2e4!  \\n<br/>\\n\\n\\n![Untitled](./2022-05-01/spring-cloud-gateway/Untitled%205.png)   \\n<br/><br/><br/>\\n<br/><br/><br/>\\n\\n\\n\uc0ac\uc2e4 \uc694\uae30\uae4c\uc9c0\ub9cc\ud574\ub3c4 \uadf8\ub0e5 \uc4f0\uae30\uc5d0\ub3c4 \ub098\uc058\uc9c0 \uc54a\uc9c0\ub9cc \uc870\uae08 \uc544\uc27d\ub2e4.  \\n\uadf8\ub7ec\ub098 \uc6b0\ub9ac\uc758 \uae30\ud68d\uc790\ub098 \ube44\uc9c0\ub2c8\uc2a4 \uc694\uad6c\uc0ac\ud56d\uc740 \uc774\ub807\uac8c \uac04\ub2e8\ud558\uc9c0 \uc54a\ub2e4. \\n\\n\uc608\ub97c \ub4e4\uc5b4,  \\n1. \ud2b9\uc815 \uc0ac\uc6a9\uc790\uc758 \uc8fc\uc2dd \uc870\ud68c \uc694\uccad\uc744 \ubd84\ub2f9 1\ubc88\uc73c\ub85c \uc124\uc815\uc744 \ud558\uace0 \uc8fc\uc2dd \uc8fc\ubb38\uc744 \ucd08\ub2f9 1\ubc88\ub9cc \uac00\ub2a5\ud558\ub2e4\ub358\uc9c0 \\n2. \uc18d\ub3c4 \ubb38\uc81c\ub85c \ubcf5\uc7a1\ud558\uace0 \ub9ac\uc18c\uc2a4\uac00 \ub9ce\uc774 \ub4dc\ub294 \uc694\uccad\uc77c \uacbd\uc6b0 \ubd84\ub2f9 1\ubc88\ub9cc \uc694\uccad\ud558\uac8c \ud55c\ub2e4\ub358\uc9c0 \\n3. \uc9c0\uae08 redis\uc5d0\ub294 timestamp\uc640 tokenKey 2\uac1c\ub9cc \ub4e4\uc5b4\uac00 \uc788\ub294\ub370 \ub2e4\ub978 \ucd94\uac00\uc801\uc778 \uc815\ubcf4\ub3c4 \ub123\uace0 \uc2f6\ub2e4\ub4e0\uc9c0\\n4. Redis TTL\uc744 \ub354 \uae38\uac8c \uc7a1\ub294\ub2e4\ub4e0\uc9c0\\n5. User \ubcc4\ub85c \uc694\uccad\ub7c9\uc744 \ub2e4\ub974\uac8c \ud558\uace0 \uc2f6\ub2e4\ub4e0\uc9c0 \\n\\n\ub0c9\ud639\ud55c \ube44\uc988\ub2c8\uc2a4 \uc138\uacc4\uc5d0\uc11c\ub294 \uc774\uac83\ubcf4\ub2e4\ub3c4 \ub354 \ub9ce\uc740 **Limiter**\ub85c\uc368\uc758 \ub354 \ub9ce\uc740 **\uc5ed\ud560**\uacfc **\ucc45\uc784** \uc744 \uc694\uad6c\ud558\uac8c \ub418\ub294\ub370, \uae30\ubcf8\uc801\uc73c\ub85c \uc81c\uacf5\ud558\ub294 `RateLimiter`\ub85c\ub294 \uc791\uc5c5\uc774 \uc5b4\ub835\ub2e4. \uadf8\ub798\uc11c \uc870\uae08\uc758 \ucee4\uc2a4\ud140\uc744 \ud574\uc57c \ud560 \ud544\uc694\uac00 \uc788\ub2e4. \\n\\n\\n[Request Rate Limiter\ub97c \ub9cc\ub4e4\uc5b4\ubcf4\uc790! 2\ud3b8](https://sk1737030.github.io/RateLimiter2)"}]}')}}]);